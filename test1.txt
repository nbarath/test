14-Jun-2018
-----------
WP-681 - 1h - T1h
This is promoted to PrePro and Production well before 4AM EST. 
Later, I copied geozones of district 15 to district 46. 
Tested in production as Manasa is on leave. It is working fine.
Geozones can not have same geozone ID in db table as per database condition. And, arrival reports works based on school number. We need to check how the arrivals are reported for district 46 in district 15 report.

WP-688 - 1h - T1h
I worked with Anubhav on setting up the new district in staging, prepro & production.

WP-689 Import New Tiger State Data - Arkansas (AR) 
I will look into this tomorrow.
This time, first I will import data in tiger2 server in your off business hours. Then, I will try import this in tiger1 server.

WP-683 - 1h - T1h
Had discussion with Ramesh.

WP-682 - 2h - T3h - When running the All Schools arrival reports (both versions) - the last columns shakes when hovering over this
I have just started looking into this issue. I spent less time on this.

15-Jun-2018
-----------
WP-689 - 6h - T6h
This is done in both Tiger1 and Tiger2 servers.
I followed the document for tiger data import as well as the instruction provided by DBA during last TN data import.
AR tiger data is imported in both the Tiger servers and I tested it for some random locations. It is working fine.
Importing multiple state data will work but, it will take more time and we may end up with completing multiple state data in Tiger1 server. This will not be useful unless it is done in Tiger2 server. So, I worked on AR data to complete in both the tiger servers.

WP-682 - 2h - T1h
I working on this.
I am not able to reproduce the issue in the production. I tried in local, it is working. Please recreate this in the call.

WP-681
Arrival report is working based on geozone ID and school numbers. We are using school numbers to find the assignments. Since, we have same school number in district 20, we are seeing assignments in district 15 report. As we have not copied the geozones to district 20, it is not reporting the arrivals.
In district 46, we have copied the geozones, hopefully arrival report should work. Report for this district needs to be tested.

Client call - 1h


18-Jun-2018
-----------
WP-691 - 6h  Import New Tiger State Data - Missouri (MO)
I worked on this task.

This is done in both Tiger1 and Tiger2 Servers.

I followed tiger data import document as well as the instruction provided by DBA.

MO tiger data is now available in both the Tiger servers and I tested it for some random locations. 

This is working fine.

WP-483 - 1h
I have just started looking into this. I spent less time on this.


19-Jun-2018
-----------
WP-636 Mobile Student Signup Not working apostrophe in last name
I reviewed the code with Anubhav and no comments.

WP-682 When running the All Schools arrival reports (both versions) - the last columns shakes when hovering over this
I worked on this task.
When we have less number of records in tooltip, it is not flickering on hover. 
When there are more number of records to display in tooltip, browser brings the vertical scrol to show the tooltip content on hover, 
and this causes the shaking issue. 
I need UI developer help as it is more on UI issue.

WP-695 VeoNow Password Reset Requests are being sent from WTB
I am working on this.
I checked coding for reset password. Emails are sent using support@wheresthebus.com. Email for veonow is not originally implemented there.
Clarification:
We are sending emails noticiation to wheresthebus@trigent.com, ryan.hill@wheresthebus.com, joe.winkler@hotmail.com as well, Which email it has to use if it is from veonow.com?
Note: I am not able to open the attachment in my laptop.

20-Jun-2018
-----------
WP-682 - 3h
I worked on this task with Adhiyamaan(UI developer).
This is fixed and available in staging.

WP-695 - 3.5
1. It is configured for VeoNow. Now, password reset emails will be sent from VeoNow email for VeoNow. 
Currently, I am testing this functionality, will update you soon. And then, Manasa can start testing this ticket.
2. This is not modified. Notifications will be sent to those email ids from WTB email as it works currently.
3. I am using Thunderbird email client in Window 10. It is not compatible.

Nonbillable PreSales - IDEA - 1hr

21-Jun-2018
-----------
WP-695 - 30m
Worked with Manasa on testing.

WP-483
I worked on this task.
I checked the code and functionalities in realtime page and also observed the browser console status.
I don't see any other changes can help to reduce the the page speed.

Summary :
1. Master icon file resizing stuff and reverted from production as it did not help via www.wheresthebus.com
2. Minifying javascript file size, it did not help here.
3. Excluding route master icon files in page load. It helped only when route number option is not selected in 'Display' button

22-Jun-2018
-----------
WP-682 - 2h
I checked the wrapping issue. This is happening only in "All Schools (all bus arrivals)" report and not in "All Schools (assigned buses)" report.
I have addressed this issue in "All Schools (all bus arrivals)" and this is available in staging. 
Now, there is a cut on right side of the tooltip pop up. 
 !screenshot-3.png|thumbnail! 
I will have UI developer Adhiyamaan to fix the issue.

WP-698 - 30m
#1 I checked, I don't see issues with this. 

WP-695 - 2h
I worked on this ticket.

#1 I have created a sub task WP-704. This is different issue and not because of the update we are working here for Veonow.
#2 I checked this issues. This is working fine for me. I am able to receive the Veonow email in inbox

WP-704 - 2h
I have started looking into this.

25-Jun-2018
-----------
WP-682 - 2h -  T2h
I worked with UI developer on this ticket.
UI developer spend some time today on addressing the pop up cut issue. Looks like, the plugin used to show the tooltip content, is causing the issue.
I will work with him to address the issue.


WP-704 - 5h - T7h
I am working on this issue.
It is little chalenging to find exactly what factor is causing the issue. We are correctly using email credential & smtp based on WTB or Veonow.
I created a sample test email and sent it from application. They are also marked as spam. 
Need to find what is causing the isse and then solution.

26-Jun-2018
-----------
WP-682 - 2h - T2h
I worked with UI developer Adhiyamaan.
We tried possibilities to remove the right side cut. None of them did not work out.
We tried customizing the tooltip plugin then tried showing the tooltip popup on left side later arrival count(link), we got the flickering issue again.
So we reverted todays update.

WP-704 - 4h - T5h
I worked on this issue.
I tried running test mail script in production for both wheresthebus.com and veonow.com.
Looks like, we don't have to do anything with this issue. Even a test email from application using WTB/Veono SMTP creadentials, are marked as spam by Gmail.
I had discussed this issue with Vijendra. Suresh asked Vijendra to raise a ticket with Gmail. Vijendra is working on this.

WP-674 - 1h - T2h
I worked on this issue.
I checked required permission to create new bus icons in image folder, we are missing again. I have given the permission.
I am not sure what server activity removed the given permission.
Once, we move to AWS with php 7 updates, there image folder will be in Amazon S3 and we will not get the permission issue 
that we are currently facing in php7 server

27-Jun-2018
-----------
WP-654 - 6h - 8h
I worked on this task.
Manasa reported two issues, those are addressed and available in php7 server.
1. We were getting errors during new user sign up, existing user update and validating user in user details page.
This is addressed.
2. We did not receive new user registration emails from php7 server, but it is working fine in php5. 
Debugged this issue and found that php7 server is configured to send new user registration emails only to 
'anubhav_j@trigent.com,ryan.hill@wheresthebus.com'. I modified this 'wheresthebus@trigent.com,ryan.hill@wheresthebus.com,nbarathmca@gmail.com'
Now, it is working.

client call - 1h

28-Jun-2018
-----------
WP-483 - 6h - 9h
I am working on this task.
1. Keep alive
By enabling keep alive, browser can be get multiple resouces using single connection to server. 
This is very important thing to be done. I believe, this change can help in reducing the initial page load time.
https://blog.stackpath.com/glossary/keep-alive/
I checked this keep alive setting in app.wheresthebus.com & php.wheresthebus.com, it is active. It is not active only for wheresthebus.com & veonow.com
wheresthebus.com
<screen shot>
app.wheresthebus.com
<screen shot>
I remember there was a conversation on keep alive property with Vijendra & Suresh. I could not get those email threads due to hard disc crash. Please check
2.Defer Parsing of Javascript
Most of Javascript files are required for initial page load. There can be few javascript files, which can be loaded separately. 
This might help little in page load. We can give a try.
3. Minify Javascript
We have already tried this for the custom javascript files created by developers. We can try minify the library javascript files. This might help little in page load.
Note : 
We can do #2 & #3 changes and test only in the production as wheresthebus.com takes time than other environment. I can create a debugging file for the existing bus realtime page. 
So that customers will not have any impact.

28-Jun-2018
-----------
WP-483 - 2 h - 2
I worked on this item.
Reported issues are addressed and available in php7 server for testing.
I have also addressed this issue in heartbeat & data viewer pages for version 3 messaging tablet districts as well.

02-July-2018
-----------
WP-682 - 30m - 
This is promoted to Production.
manasa_r, please check.

WP-483 - 1h - 
I had discussion with Vijendra. He found the following support ticket that we raised with Linode.
https://manager.linode.com/support/ticket/7742216
It is not possible to enable KeepAlive with current Linode Balance settings. He believes KeepAlive would work fine with AWS. 
He has sent an email on this discussion. Email Ref. Subject: keep-alive header. Dated : July 02, 2018.

WP-628 - 1
I have started looking into this.

03-July-2018
------------
WP-695 - 30m
This is release to production. Manasa please test.

WP-704 - 1h
I worked with Vijendra on testing email. Emails are still marked as spam in Gmail. Vijendra suspects there could be an issue in php code. 
Need to debug and figure out exactly what is causing the issue.

WP-717 - 5h 30m
I have implemented the validation to control accepting end data is less than start date. This is fixed in #1, #3, #4.
#2 has already got this validation. @Manasa, please clear the parameter in URL and check the validation.

04-July-2018
------------
WP-704 - 5h
I am working on this.

I created yahoo account to test the how it behaves in other emails. It is not marking WTB emails as spam, but, sometime, it marks the veonow emails as spam.

I created separate php script to debug the issue as per Vijendra's instruction. And, tested with that.

Is this only marked as spam in Gmail? Are other email clients fine?
-- WTB emails are marked as spam only in  Gmail. I created a yahoo mail account, there WTB mails are not marked as spam.

If it was in the code, I would suspect it would affect all email clients. 
-- I am checking this.

Could it be due to them being sent from Gmail and Gmail is flagging them somehow? 
-- I don't think. Becuase, the WTB email sent from Gmail, is not marked as spam in yahoo mail.

I assume the VeoNow emails are not being marked as spam is this correct? 
-- This is not consistent. Sometime, mails are received marked as spam in Gmail and Yahoo mail.

Tomorrow, I will work with Vijendra to fix the issue.

WP-717 - 1h 30m
#3 is addressed and availble in staging. Please check.

05-July-2018
------------
WP-725 - 4h
I worked on this ticket.
#1 and #2 are fixed and available in php7.1 server for testing.

WP-726 - 1.5h
I am working on this issue.

Scrum - 1h
AWS - 1h

06-July-2018
------------
WP-726 - 5h
I worked on this.
#1 and #2 are fixed and availbale in php7.1 server.

WP-704 1.5h
I spent less time on this. I could not spend time with Vijendra as I was addressing on php 7.1 issues.




10-July-2018
------------
WP-717 - 30m 1
Promoted to Production. And tested, it is working fine.

WP-704 - 5 6
I worked on this.
I debugged the spam issue in production and staging environments of wheresthebus.com & veonow.com in browser. And, also checked on emails sent from linux console.
It is working fine, emails are not marked as spam. I have not made any code change for this.
And, also checked the forgot password functionality for both wheresthebus.com and veonow.com. It works fine.
I discussed the working status of email with Vijendra. He suspects our mail id should have been marked as spam due mass emails sent from tablet server while setting up email(Suresh) a few weeks back
and now gmail would have white listed it.
Let's put this ticket 'On Hold' and observe the emails.

WP-733 - 1h 2
I am working on this.
I checked the scripts and their inputs to back up GPS data and table structure.
I did a trial run. It worked fine. Tomorrow, I will execute the scripts to back up 2017 GPS data ie 01/01/2017 to 12/31/2017.


11-July-2018
------------
WP-733 - 6h
Yes Ryan, I am following your order list. And, during last archieve also, I followed same order.
I am working on this task. 
I am executing the script for 2017. I am randomly checking the backup data.
Backup script execution was suddenly stopped in the server while processing district 22 data. I checked the server load, disc space, error logs. I could not find what caused backup script termination.
I modified the script coding to start with district 22 again. It is running in the server.
I have created an excel from log to track number records backed up for each district in 2017. I will share the excel once the backup process is completed.
Do you want to track the number of records of district for each month in 2017?

12-July-2018
------------
WP-733 - 5.5 7.5
I worked on this task.
I randomly verified GPS data backss.
I worked with Anubhav. I copied the GPS data backup file and meta data file to Amazon S3 from linode DB Server. 
And, I verified the copied files in Amazon S3, it is fine. Please check from your end.
Attaching an excel that has information about district and its number of records for 2017.
Weekly backups are available in below location(DB Server) and they are not copied to Amazon S3.
/home/wtbuser/wtb_backup/mysql_db_backup

WP-739 - 1h 1.5
I have just started looking into this. I spent less time on this.

13-July-2018
------------
WP-743 - 5.5
This is completed. This is promoted to staging, prepro and production. UDP servers & Consumers were restarted before 4AM.
I need promote this to php 7.1 server and I need to copy the geozones.
All the geozones of district 32 are copied to new district 48.
This task is promoted to new php7.1 server and it is working fine.

WP-733 - 1h
I am working on this.

#1 "Complete DB Backup 11-11-2017" is being copied into "Complete DB Backups". We can delete the "Complete DB Backup 11-11-2017" from original path once copy is done.
#2 I have copied last weekend backup of wtb_live_database to "Complete DB Backup 07-07-2018" folder.
#3 Yes. As we are going to delete 2017 GPS data from wtb_vehicle db, it is better to copy last weekend back up of wtb_vehicle db as well. This is currently being copied to "Complete DB Backup 07-07-2018" folder in Amazon S3.

Will update the ticket once it is done.


16-July-2018
------------
WP-739 - 6 -- 8
I am working on this.
#1 Driver images will be stored in image folder.
I am planning to create a new table driver_images and additional column ImageID in driver_details table. 
This addition column holds the ImageId column value from driver_images
include excel
This excel gives us better control over uploaded images.
a. When the image was uploaded.
b. Who uploaded the image.
c. Gives historical details of driver image uploads. 
ImageID value of last uploaded image will be available in driver_details.
Image path is predefined in configuration file.
#2 These images will be named with ImageID column of driver_images table. 
#3 I dicussed with Prakash about driver_details table and additional column(ImageID) in the table. He has no concerns. 
Also discussed about driver time card report. I need to check with Shilpa on tablets 


17-July-2018
------------
WP-733 5.5 -- 6.5
I worked on this task.
I delelted the GPS data(daily_events_XX table) before 1/1/2018. 
I checked GPS db back up files availbility in S3 before deleting old data from eaching daily_events_XX table.
District 11 has 2016 data and looks like that was restored by Anubhav from GPS db backup file. 
So, I did not delete 2016 data and deleted only 2017 data for district 11. Please confirm.

WP-739 1.5 -- 2.5
As discussed in yesterday' call, we are going to have an additional column for driver image path in driver_details table.  And, driver ID will be the name of driver images. Existing driver image will be overwritten when new driver image is uploaded for same driver ID.
Driver images will be stored in a predefined location of php application server when the images are read from bulk upload folder and updated in driver_details table. It is assumed that driver ID is used as image file name in initial bulk upload folder.
I discussed with Shilpa on showing these driver images in tablets.  Shilpa has to copy driver image from predefined location using image path column value (driver_details table)
Next, I will create a php script to read images for a district from bulk upload folder and to saves in predefined location, it will also upadate the image path in driver_details table.
Please upload the bulk image folder when it is ready.

18-July-2018
------------
WP-733 - 1.5 -- 2
I have deleted 2016 data for district 11. And, verified the same for other districts.

WP-739 - 5.5 -- 6
I am working on this.
I have added a new column driver_image in driver_details table.
I created a new php script to copy driver images from bulk upload folder to predefined location, then it updates driver_image column in driver_details table.
Updates are in my local. I need to test this.
driver images are uploaded in : /home/wtbuser/Barath/driver_images/district_XX/
Driver images are saved in /var/www/wheresthebus.com/code/public/resources/images/driver_images/district_XX/
Yesterday, I discussed with Shilpa about updates on images. We need to figure out that. I have an idea of adding a new column is_image_sync to driver_details
table. When there is an update in php side on driver image, the column will be set to 0, once Shilpa copies the image, then she can set it to 1. 
So that, in next sync, she can ignore images have is_image_sync as 0. I will discuss this will Shipla tomorrow.


19-July-2018
------------
WP-739 - 4h -- 5
I worked on this.
I tested the script in local. That is promoted to staging and tested with sample images. 
It saved the driver images from uploaded location to predefined location of php application server and updated driver_image column in driver_details table. Please check
I believe this should work in php7.1, will test this script in php 7.1 server once the staging environment is setup.

I had discussion with Shilpa and Prena about image sync on update. We need to figure out a way. We will discuss with Vijendra tomorrow if he is available.

WP-754 - 3h -- 4
I have started looking into this.
Time and Mileage Report:
I checked the issue and found that time_milege_report table in wtb_app_staging db , does not have required data. I will copy the time_milege_report db table from linode to AWS and i will check.
I checked Bubble Report, Deadhead Report and By Tier Report. Required db data is missing there. I have to copy following tables from linode mysql to aws mysql. Then, I will check the reports.
1.geozones
2.slack_time_report
3.deadheads
4.school_arrivals

20-July-2018
------------
WP-760 - 2h -- 2h
I discussed with Vijendra and team, clean up needs to be done before we move the production data to AWS over this weekend.
1. GPS db backup files are deleted from DB Server.
2. 07/07/2018 and 06/30/2018 weekly backup files are deleted from DB Server. 07/14/2018 backup is still there in server.

WP-750 - 4h -- 5h
I am working on this.
I could not see the console error.
We don't have staging/prepro for php7.1, we have only production version. It is little difficult to debug the issue.

WP-705 - 1h -- 1h
Had discussion with team.


23-July-2018
------------
WP-705 30m - 1h
Worked with Manas on testing

WP-754 2.5h - 3h
I am working on this.
Checked above reports in aws.
#1 Time and Mileage Report : working fine.
#2 Bubble report : working fine.
#3 Deadhead Report : working fine.
#4 By Tier Report : Not working. It is giving fatal error. I am looking into this.
<screen shot>

WP-739 - 1h - 1h
Today, Shilpa and Prena are not available. I could not disscuss with them.
I had a discussion with DBA Karthi on imaging sync from php end. I will discuss with Shilpa, Prena along with DBA Karthi when they are back.

WP-750 - 2 - 2h
I spent sometime on debugging this issue. Yet to figure out the cause.

WP-655 - 1h - 1h
Synovia - sometime

24-July-2018
------------
WP-739 - 1.5h - 2.5h
I had discussion with Shilpa, Vijendra and Karthi. Vijendra suggested new approach. <Shilpa> has mentioned the approach in WM-268. 
We need to have a new column to track modified date and time of driver images in driver_details table.
We have a few questions from discussion,
#1 Sample images are in jpg format. All original images will be in same format or some can have jpg and other can have differnt image format. 
#2 What would be the maximum size of image file.
#3 After initial bulk upload of driver image, when we upload drive image again in future, will that contains delta driver images. 
For example, initially we upload images for 400 driver of district 31. Later, 50 driver images get changed, 
that case, only 50 driver images(delta) will be uploaded or all 400 driver images including 50 driver images will be uploaded.

WP-655 - 1.5h - 2h
Today, [~manasa_r] reported bus icons are not correctly appearing in linode's wheresthebus.com. And, I found master icon cron did not run correctly by itself in new app server. I worked with Anuhav and rerun the cron. It started working fine.

WP-763 - 3h - 4.5h
I worked on this ticket.
This is addressed in aws.wheresthebus.com
#1 This is because the s3 mounted images was not working properly from the application. This is corrected and working fine.
#2 This is permission issue. Required permission is missing to create a new bus icon from UI(bus manager). This is corrected and working fine.
I took Anubhav's help on this.

25-July-2018
------------
WP-655 - 1h - 1.5

WP-767 - 5h - 6.5h
I am looking into the issue.
We are using pear-soap package for Synovia API. I installed it in php 7 server. I is giving error and it supports for php 4 & 5 versions.
We need to figure out solution. I am working on this. 
Anubhav is helping here.


26-July-2018
------------
WP-767 - 6hrs

I worked with Anubhav.
I am working on required application code changes for Synovia in linode new app server.
Tomorrow, once I am done with the changes, I will push Synovia fix to AWS and test.
Outstanding Issue :
We could not set up new customer(like ICSB & LBW) with the new 7.1 update. I will try to fix this tomorrow, else we can fix it later.

27-July-2018
------------
WP-767 - 6hrs
I have completed the synovia update and tested it in linode 7.1 app server. It worked fine.
Then, I pushed updates to AWS app server and tested. It is working fine.
I have informed manasa to check Synovia in AWS.
Outstanding Issue:
We still have issue with setting up new synovia customer in php 7.1. We can address this separately.

28-July-2018
------------
WP-739 - 1h
I started working on new update. I spent less time on this.

WP-705 - 5h
Worked on testing and updated google sheet.

30-July-2018
------------
WP-777 4h - 4.5h
I checked this issue. The icons are loaded individually because master icon cron did not run correctly.
I checked the master icon process. No issues with master icon cron. We have issues with S3 images mounting in app server.
Cron is not able to create master icon files in mounted S3 image folder.
Sometime, it is taking very long to read individual bus icons from image folder.
Same happens when it tries to write resultant master icon files to image folder.
Suresh / Vijendra has to work on S3 images mounting and slowness issue in app server.

WP-739 3h - 3.5h
I worked on this ticket.
new table image_modified_date is added and its getting updated correctly.
Update are in my local. 

31-July-2018
------------
WP-777 2h - 3h
#1 This will be addressed in WP-780 Assigned .
#2 I will work on this once #1 is fixed.
I checked above issues. #1 is not fully fixed. We still have permission issues to read/write images.
Because of this, today's master icon cron did not run well in app server.
<screen shot>
As temporary fix, we have to set icons to load individually instead from maseter file.

WP-739 3h - 4h
I have tested this in my local. It is working fine. 
I will push this to staging and test once it is staging is set up in AWS.

WP-780
We still have permission issue with images. wtbuser & apache users should be able to read/write/delete images.
<screen shot>

WP-751 - 2h - 2h
I have started looking into this.
The list has got backup files and test files. I will exclude those files.

01-Aug-2018
-----------
WP-739 - 3.5h - 4h
I pushed my updates to AWS staging and ran the script to upload sample driver images into application. Driver image are uploaded and modified date are updated correctly. 
It is working fine.
Staging S3 image bucket is not configured as part of staging environment setup. So, sample driver images are not saved in S3 bucket.
As discussed with Shilpa, I uploaded staging driver images to production S3 image bucket, so Prena can continue her work using production S3 images. 
Once, S3 image bucket for staging is set up, Shilpa & Prena will use staging S3 driver images.

WP-777 - 1h - 1.5h
I checked master icon cron. It ran correctly today as required permissions are given to master files in WP-780. I also checked the bus realtime, I dont see bus icons missing like yesterday.

WP-780 - 1h - 1.5h
Yesterday, I and Anubhav worked with Vijendra. Vijendra had given the permissions required for master icon files. And, today master cron ran correctly.
Need to check the icon creation from Bus Manager.
I checked bus icon creation from Bus Manager. Bus Icon got created. It is working fine.
Note :
As discussed in the call, need to observe image mounting and user permissions after restarting app server.

WP-751 - 1h - 1h
Today, I spent less time on this

02-Aug-2018
-----------
WP-777  2h - 2h
I checked master icon cron. It ran well. It took 58 mins to complete. As I discussed yesterday, I assume this delay is because of the images are coming from S3. I will discuss this slowness issue with Vijendra.
I worked on this task.
I had a discussion with Vijendra. The slowness of master icon cron is because of reading images from S3 takes long time.
Reading an individual bus icon is an API call to S3. When we read bus icons to create master icon file, it takes more time.
Vijendra told, when the master icon cron starts, instead of reading bus icons from S3, we can create them on fly and store them into a temporary image folder and once master icon files are created then the temporary image folder will be deleted. This is a temporary fix and it requires code change in master icon file logic.
Vijendra also suggested, we would go for some alternate approach to show bus numbers(like icon) over map than using bus icon images / master icon images. He will look more into that.

WP-786 - 3.5h - 4.5h 
I worked on this task.
This is completed and promoted to staging.

WP-751 - 1.5h - 2.5h
I am working on this. I could not spend much on this.

03-Aug-2018
-----------
WP-786 - 30m - 30m
This is promoted to Production.
manasa_r, please check.

WP-788 - 4h - 5h
This is completed and promoted to Production.
Emails are sent from new veonow email credentials and properly received in Inbox, I checked in gmail and yahoo mail as well. I have created a sample php script to test the emails. I checked both WTB and Veonow emails using test script.
manasa_r, please check.

WP-751 - 2h - 2.5h
I am working on this. 
Staging code and reposistory code are differenct as staging code is used for development. I am working on both reposistory and staging code for modification.

*****************************

06-Aug-2018
-----------
WP-777  5h - 6h
I worked on this task.
I have created a new php script to create all the bus icons for both bus and route number. I ran the script in staging, it took less than a minute to create all the bus icons. 

WP-751 2h - 2h
I spent some time on this task.

07-Aug-2018
-----------
WP-777 6h - 9h
I worked on this task.
I have made required changes in master icon cron. Updates are in my local.
I need to test this in local then in staging.

08-Aug-2018
-----------
WP-739 2h - 2
This is promoted to production. I tested the php script in the production using sample driver images. It saved the driver images in application and also it correctly updated the db table columns driver_image and image_modified_date in driver_details table.
Next, we need to upload the actual driver images when it is ready.
Note : Need to clear driver_image and image_modified_date columns in production before uploading actual driver images.

WP-777 4h - 5
I worked on this
I have tested the master icon cron in my local then promoted to  staging and tested. It is working fine.
While creating each bus icon, code refers icon templates (blank icon) from S3, I modified the logic to copy those files to the tmp folder as part of master conr as it is an additional call to S3 for each bus icon creation on fly.

WP-790 1h - 1
I have just started looking into this.

09-Aug-2018
-----------
WP-777 2h - 3h
I worked with Manasa on testing.
Yesterday, icons were displaying correctly in realtime page when I tested. 
After that, S3 image folder was mounted to staging and it has permissions issues. So icons are not working properly in staging now.
I will check with [~anubhav_j].

As discussed with Anubhav, giving permissions to all the images, might take very long time (in days). 
To continue with the testing, we removed S3 image link from staging application code. Once the testing is done, then we will link S3 image folder again to staging application code with required permissions.
I reran the master cron in staging. Now, it is working fine.
 !screenshot-5.png|thumbnail! 
[~manasa_r], please check.

WP-790 5h - 6h
I worked on this task.
In staging db, I cleared all the existing school geozones of district 20 and copied the school geozones for district 15. All other geozones of district 20 remains same.
Past school arrivals are not avaialble for district 20 as district 20 got new school geozones ids. 
I fixed the code issues for district 20 in arrival report. We can test the report for district 20 once we get new school arrivals.
Shall I promote to production tomorrow?


10-Aug-2018
-----------
WP-790 4h
This is promoted to Production.
Backup of geozones and school_arrival tables are taken in production db. District 15 school geozones are copied to district 20. Old schools geozones and arrivals are cleared from db table. Fix for district 20 "All Schools (assigned buses)" also promoted to production.
manasa_r, please check.
Regarding Manasa's Observation, I discussed with Manasa & [~prakash_p], there is a nightly cron which updates the bus numbers in geozone table.

WP-777 2.5h
No, the updates done in the staging, did not affect the production.

It looks like master icon cron did not run well in the production. While processing route master files, cron had some issues. I checked the master icon cron log, but I could not find the reason. I have set to load icon individually and not from master icon file due to cron issue.

14-Aug-2018
-----------
WP-777 - 1h - 1.5h
This was promoted to production around 3.15AM EST and informed Manasa.
In production, I checked around 5.50AM EST and found icons via have master file, having cut issue in realtime page. So, I set to load icons individually and not from master file. I is working now.
 !screenshot-6.png|thumbnail! 
I am not sure, is this master icon cron issue or something impacted from the S3 images mounting stuff done by Vijendra.
I will check the master cron tomorrow in off time.

WP-815 - 5h - 6.5h
Yes, I worked on this task today. Now, it is working fine.
I checked email application functionality using email test script that I created for WP-788 testing. Using SMTP debugging mode, I found that the emails are being blocked by google when they are sent from the application. Google blocks the email based on "Allow less secure apps" setting. This setting was turned off for veonow.com.  Veonow emails were working fine when we promoted WP-788 on 08/03. I am not aware when the setting was modified and who modified it.
I discussed with Vijendra and he turned on this setting as it requires admin privilege to change the settings.
[~manasa_r] tested it, veonow emails are working fine.
No promotion to production as there is not code changes involves here. I discussed with Vijendra and he modified Gmail setting "Allow less secure apps" only for support@veonow.com. This was done around 5.30AM EST.

WP-739 - 30m -1h
[~prena_m], As we discussed, I have uploaded driver id 100008 of district 31 with a sample image. This is available in staging db and production S3 bucket.
Note : Sample images will be deleted from production S3 bucket when Ryan provides actual driver images.

16-Aug-2018
-----------
WP-777 - 0h - 1h
[~manasa_r], please check this updage in production today.
Note : Images are not read from S3 as Vijendra copied S3 images to PHP server and mounted PHP server images to APP server. So, time taken by cron can be considered only when images are mounted from S3 again.

WP-812 - 6h - 8h
I worked on this issue.
We are making API calls to Synovia every minute. Usually, Synovia sends the response quickly, but now a days, it takes very long time to respond, sometime it doesnt send response at all.
Due to this, Synovia GPS data import process in our application got stuck. 
I have identified additional parameter to handle the issue and added to API.
Update is available in Produciton. We will observe this for couple of days.


17-Aug-2018
-----------
WP-822 - 4h - 5h
I worked on this task.
1. New district 50 is setup and promoted to Staging, Prepro and Production.
2. District 46 from "Go Riteway (WI)" to "Milwaukee North (Riteway)" and promoted to Staging, Prepro and Production.
3. Next, I will start copying the geozones of 46 to 50.
Shilpa Jayaram has restarted UDP for new district setup.
manasa_r please check #1, #2.
#3. Geozones of district 46 are copied to distict 50. This is first done in staging db then in production db.
[~manasa_r], please check #3.

WP-739 - 1h - 1.5h
Worked with Mobility team on testing.

WP-797 - 1h - 1.5h
I have just started looking into this issue.

20-Aug-2018
-----------
WP-812 - 7 - 8h
I worked on this.
I checked the log file which I added while working on 08/16 fix. This helped to find an new solution.
I have defined a waiting time for Synovia response. If we don't get synovia response in 4 mins, then the new API call will be placed and old call will be written into log file. 
In this way, Synovia service will be up and running even if there is an issue on Synovia end with freezed API service calls.
Update is in staging. I need to test the update in Staging first.

21-Aug-2018
-----------
WP-812 - 1h - 1.5h
I have restarted Synovia service as API response freezed. 
New update is promoted to production. Lets observe the new fix in production. 

WP-739 - 1h - 1.5h
I had a discussion with Vijendra. S3 would not be mounted back to AWS app / php server. We need to write driver images to the S3 using S3 services. Need to check the services and implement here.

WP-797 - 4.5h - 6h
I worked on this task.
I discussed with Anubhav and turned off Zonar import for Riteway in district 15.
I cleared district 15 Riteway zonar buses from vehicle_ids table. And, district 15 Riteway admin unit buses are replaced by district 46 buses. Now, district 15 realtime page shows GPS data of district 46.
Updates are available in staging.

22-Aug-2018
-----------
WP-812 - 1h - 1h
I checked Synovia data import in produciton. It is working fine. Yesterday's fix works fine in production as expected. 
The notification emails are from Zonar data import. I will check with [~anubhav_j].

WP-797 - 1.5h - 2.5h
This can not be promoted to PrePro as it would impact production. It is promoted to Production and PrePro together. Please check.
I have done the same stuff in production as I did in staging yesterday. I have taken backup of required db tables in produciton.
I have turned off Zonar import for Riteway with Anubhav help.
I have added all the buses from district 46 to district 15's Riteway admin unit as part of production release.
I am not sure why the buses are missing here. I need to check.

WP-832 - 4h - 4.5h
I am working on this ticket.
I compared the district 20 buses against district 15' SCT unit. Realtime page shows 43 buses in district 20 and 41 buses in district 15(SCT unit). 
Those two missing buses are 0086SC & 0087SC. I have copied production data to staging db. These two buses are missing in district 20 realtime page as well.
I am able to recreate this issue in PrePro. I am looking into this.

23-Aug-2018
-----------
WP-844 3.5 - 4.5h
I discussed with Anubhav and he has above questions.
I worked on #1. I merged the district 37 to district 24. I created a new admin unit 'Odyssey Charter School' 
and copied all the buses from 'New Odyssey Buses' admin unit of district 31. Now, district 24 shows district 37 gbs buses.
Updates are in staging.
As discussed, #2 will be handled by Anubhav in in WP-850.

WP-846 3 - 3.5h
I have started looking into the issue.

WP-739 - 1h - 1h
Helped Mobility team on testing.

24-Aug-2018
-----------
WP-844 - 1h - 1h
This is released to production.
manasa_r, please check in producton.

WP-846 - 5.5h - 7h
I am working on this issue.
I checked the implemention of the arrival report. It works based on the admin unit selection. 
Similar thing is observed by Manasa in WP-564, please refer 04/19 & 04/20 comments.
In district 15, when we selects SCT admin unit, it consideres only SCT routes and reports in the UI 
and when we select 'All', it consideres all the routes and reports in UI. 
Similarly, in district 20, 'All' option is selected, so it reports all the routes.
I checked buses_assigned_to_schools table which is managed by update_school_bus_assignments cron, district 20 has all the routes and buses of district 15. 
That's why, we are seeing  all the routes of district 15.
We will discuss in the call.

28-Aug-2018
-----------
WP-860 - 30m - 1h
I had a discussion with DBA Karthi on this task.

WP-846 - 5h - 6h
I worked on this issue.
I checked https://wheresthebus.com/admin/tablet_student_summary.php?district=20 report. It uses bus company dropdown and not admin unit. We could not follow this one. I checked other arrival reports like "All Schools (all buses arrivals)", "Depot Arrivals". No admin unit is there in drop down.  Those reports work with 'All' option in dropdown. So, I modified this arrival report logic to work with 'All' option in dropdown for district 20.
Update is available in prepro. Please check. I can see some numbers mismatch between district 15's SCT unit report and district 20 'All' report.
Regarding, district 46, we have already two admin units there. Need to discuss this one.

WP-862 - 1.5h - 2h
I worked on the issue.
Bus number 29B1313FS icon is not created because the bus number length. I checked this in Add Bus page of Bus Manager. 
A bus number length can be maximum 8 when it contains alphabets and numbers. This rule is applicable in icon creation as well. 
That's why, bus number 29B1313FS icon is not created. I suspect this bus number should be created by a cron and not from Bus manager.
 !screenshot-1.png|thumbnail! 

29-Aug-2018
-----------
WP-846 - 5h - 6h
I worked on this issue.
As we discussed, 'Milwaukee South' admin unit will be deleted from district 46 and admin unit 'Milwaukee North' is equivalant to 'Riteway' in district 15.
I have worked for district 46 updates and it is available in prepro. I can see some numbers mismatch for district 46 like district 20. I will look into this.

WP-870 1h - 2h
I have just started looking into this. Will update here once it is done

30-Aug-2018 
----------- 
WP-870 - 2h - 3h
I have checked the fucntionality of both the crons. check_udp_server functionality is given below.
1. Don't perform heartbeat checkup between Saturday 9 PM - Sunday 1 AM.
2. Check the heartbeat cron is active. Skip the process if it is paused.
3. Check the previous heartbeat cron is still running. If it is running, then send mail notification and skip the process.
		Subject : "Alert: UDP Server - Heartbeat check up cancelled.";
		Message : "Since the previous heartbeat check up cron is still running, the current heartbeat check up has been cancelled for UDP Server at <<DateTime>>";
4. If previous heartbeat cron is NOT running then,
	A. Log the cron start time.
	B. Get the last heartbeat time of the UDP Server using sql SELECT update_time FROM heartbeat WHERE ident='wtb_udpserver'
	C. If we are NOT able to get the heartbeat time value, then send mail notification on DB error.
			Subject : "Alert: Database error - unable to fetch heartbeat value for UDP Server";
			Message : "Heartbeat check up for UDP Server - unable to fetch heartbeat value from DB table 'heartbeat' at <<DateTime>>";
	D. If we are able to get the heartbeat time value then,
		i. Find the time difference between last heartbeat time and current time.
		ii. If the time difference is greater than 300 seconds(ie. 5 mins) then, send mail notification UDP server outage and restart UDP Server  using script /srv/scripts/restart_udp_server.sh
				Subject : "Alert: UDP Server outage";
				Message with date & time, duration and link to pause & activate the cron. Please refer email screen shot for more details.
	E. Log the cron end time.
check_udp_server2 follows same logic except few changes. 
1. In all mail notificaitons, it uses "UDP Server 2" instead of "UDP Server'.
2. In 4.B, it uses "wtb_udpserver2" to fetch last heartbeat time.
3. In 4.D.ii, it uses script /srv/scripts/restart_udp_server2.sh to restart UDP Server 2.

WP-846 - 4.5 - 6h
I am working on this issue.
I checked the issue with number of assigned route buses diference between district 15's 'SCT' admin unit Vs district 20 'All' as well as district 15's Riteway Vs district 46 'All'. There is a missing school geozone. 
School #167 is there in district 15 and it is not there in district 20 and 46. So, we are missing those assigned routes buses and it impacts the total route buses number.
 !screenshot-2.png|thumbnail! 
And, I also noticed some school geozone type of district 20 & 46 are different from district 15.
District 20 school geozone type MS
 !screenshot-3.png|thumbnail! 
District 15 school geozone type ES
 !screenshot-4.png|thumbnail! 
The school geozones and its type of district 20 & 46 should be same as in district 15. Looks like, those got modified after we copied school geozones of district 15 to district 20 and district 46.

31-Aug-2018 
-----------
WP-846 - 4h - 5h
I worked on this task.
I inserted the missing School #167  in district 20 and district 46. I checked the report in prepro, it is showing correct assigned route buses.
I discussed with DBA Karthi regarding geozone data update. We found following db table columns of many geozones from district 20 & 46, 
are not matching with district 15. 
1.geozone_name
2.school_type
3.center_point
4.poly_points_spatial
5.am_trip_routes
6.pm_trip_routes
7.begin_time
8.end_time
I think we can update the above columns excluding am_trip_route and pm_trip_route.
He found some of the schools are available in district 15 and not in district 20 & 46.
select * from geozones where district_id = 15 and geozone_type =1
 AND geozone_name NOT IN (select geozone_name from geozones where district_id = 20 and geozone_type =1)
order by geozone_name;
<screen shot>
And, some of the schools are available in distrirct 20 & 46 and not in district 15.
select * from geozones where district_id = 20 and geozone_type =1
 AND geozone_name NOT IN (select geozone_name from geozones where district_id = 15 and geozone_type =1)
order by geozone_name;
<screen shot>
I will take DBA help for the db activities.

WP-751 - 2h - 3h
i spent some time on this task.


03-Sep-2018 
-----------
WP-751 - 6.30h - 8h
I worked on this task.
I have identified the files that need updates from the above bunch of files. Some of the files are hard coded only in staging, I corrected those in staging environment. And, some of files are hard coded and checked-in to SVN repository. I have corrected them in my local.  Need to release those files to PrePro for testing before releasing them to the production.

05-Sep-2018 
-----------
WP-846 - 1h - 1.5h
Worked with Manasa on testing.

WP-882 - 5.5h - 6.5h
I am working on this issue.
Timeout and unresponsive issue with student search is not consistently happening. Sometime it is reponsive and sometime it is unresponsive.
 !screenshot-2.png|thumbnail! 
 !screenshot-3.png|thumbnail! 
Timeout and unresponsive issue without student search is not happening when I tried to reproduce the issuse.
 !screenshot-4.png|thumbnail! 
I am debugging the issues. Unresponsive state(grey screen) is an UI work. I will take UI developer's help if required.


06-Sep-2018 
-----------
WP-846 - 6h - 8h
I am working on this task.
I have addressed the issue in difference between 'All' and 'Milwaukee North' results. There was an issue in filtering data from planned_activities table. This update is available in prepro. 
As we discussed in yesterday's call, selecting 'Oak Creek' admin unit in filter, will show same results like 'Milwaukee North'. This is working. I have not made any code changes for 'Oak Creek'.
[~manasa_r] please check the report excluding export to excel.
Started working on export to excel update. Will update the ticket once it is done. 

WP-751 - 30m - 1h
As specified in the ticket description, staging files that use 'wtb_app_live', are corrected to use db from the configuration file. This is done in staging.
While working on the ticket, I found below list of files, were hard coded to use 'wtb_app_live' in queries instead of referring from the configuration file. And, these files were checked into the SVN repository with hard coded db name. I have corrected these files to use db from configuration file and no logical or functional changes are done here. We need to check-in these files to save the db configuration update into SVN repository. 

includes/classes/ActualAndPlannedActivities.php
includes/classes/MacroCronHistory.php
includes/classes/SubBusAssignment.php
public/district/BusActivityDetails2.php
public/admin/all_school_arrival_report_excel.php
public/admin/driver_timecard_detail_report.php
public/admin/student_scaned_report.php
includes/classes/MockEventQueue.php
includes/classes/SlackTimeReport.php

07-Sep-2018 
-----------
WP-885 - 2h - 3h
I worked with anubhav_j on this task. We ran the cron manually in the staging. We got only 'Dairyland Bus' buses in synovia_asset_mapping stating db. And also, after running the cron, we could not find bus 1990 in synovia mapping table.
If we run the cron in production, then we may loose other buses LN, LS and WC. How did you find 1990 bus is missing, this will help us to find the missing buses.

WP-882 - 4h - 5h
I worked on this ticket. 
This is addressed and update is in my local, I will promote the update  to staging and prepro after the call.
I took UI developer help here. He spent around 2 hours.

08-Sep-2018 
-----------
WP-882 - 1.5h - 2h
I was just testing the update in staging. Other popups are working fine and no conflicts with timeout popup. 
I observed emergency popup is sometime causing issue with timeout popup in realtime page. Created new ticket WP-889 to address this issue.

WP-889 - 4.5h - 7h
I worked on this ticket.
This is handled. Now, emergency check will not happen in the background when we get 'Session Timeout'. This is working fine. 
Updates are available in staging and prepro. 

10-Sep-2018
-----------
WP-882 - 30m - 30m
Production Release.

WP-889 - 30m - 30m
Production Release.

WP-846 - 30m - 30m
Production Release.

WP-885 - 30m - 1.5h
Bus icons are created for DB, LN, LS and WC buses in production.

WP-883 - 4h - 6h
I worked on this task.

#1 I could not able to reproduce it. I tried multiple time and page is loading in 10 seconds. I will try to reduce the page load time.
<screen shot>

#2 This page is taking long time. And, sometimes sql query takes more than a minute to complete. I checked the query and indexes are there. 
I will have DBA karthi to review the sql query for further indexing and optimizations. When I dicuss with DBA on #2, I will discuss #1 sql as well.
<screen shot>

11-Sep-2018 
-----------
WP-882 - 1h - 2h
I checked the issue. Some of the CSS code were modified as part of UI designer work. Looks like, the CSS file is cached on the user browser. Please clear the browser cache and check, it worked well.

KT on gearman - 1.5h - 2h

WP-883 - 3.5h - 5h
I worked with DBA Karthi and reviewed both tablet data viewer and tablet manager queries. Additional indexes will not help here much. 
Both the queries need to be rewritten. I will work with DBA on this.

12-Sep-2018 
-----------
WP-897 - 2.5h - 3h
I worked on this task.
I discussed with Anubhav.
I added macro crons groups macro_report_group45, macro_report_group48 and macro_report_group49 for district 45, 48 and 49 respectively.
District 5 macro cron has been already running in macro_report_group2. I have not added any macro cron group for district 5.
Today, we have an issue in accessing AWS servers(except App Server) using AWS user credentials. I released the update only to APP Server as crons run there.
Need to release the update to PHP Server once the access issue is sorted out by Suresh.

WP-883 - 2h - 3h
I worked with DBA Karthi. Tablet manager sql query is rewritten and now sql query takes less than half a second to run. Next, I need to integrate the table manager sql query to the application.
Karthi started optimizing tablet data viewer sql query.

WP-896 - 2h - 2h
KT on zonar asset mapping.

17-Sep-2018 
-----------
WP-897 - 2h - 2h
I checked the issue.
I released my files to production on 09/12. The cron did not run due to some other code conflicts.
I corrected it now and I expect these cron will run tonight.

WP-883 - 3h - 4h
I worked on this task.
I got tuned query for tablet manager page from DBA Karthi and integrated it to the tablet manager page. Update is available in prepro. 
It is taking less few seconds to load the page. Please check.
I discussed with Karthi on tablet data viewer page. He is working on that.

WP-896 - 2h - 2h
KT on Synovia asset mapping

18-Sep-2018 
-----------
WP-896 - 2h - 3h
KT on Zonar GPS download

WP-751 - 30m - 1h
Production release

WP-883 - 3.5h - 6h
I worked on this task.
I worked with DBA Karthi for tablet data viewer query. I received the query and implemented into application. Update is available in prepro. 
It is taking few seconds to load the page. Please check.
<screen shot>

19-Sep-2018 
-----------
WP-883 - 30m - 1h
This is release to production.
manasa_r, please check.

WP-896 - 30m - 1h
KT on Stop assignments

WP-795 - 5h - 6h
I am working on this.
I analyzed above URL's custom overlay popup approach. It is a 'div' element based approach. It means, for each bus icon we need to create a div element in the page and that div will be plotted over the map. This will not be good when we have to plot hundreds of buses over the map.
I am trying to figure out a way to achieve the same without creating a div.
I will also discuss with Vinod on this.

24-Sep-2018 
-----------
WP-885 - 3h - 4h
Anubhav's KT is completed on Synovia asset mapping. I am working on this. I will take Anubhav's help if required. 

KT is a process where Anubhav explained what he has done.
After KT, I need to go throug the code to understand the implementaion. After that I can 
Today, I have gone the code, this is required before we make any code changes. Currently, I am debugging the code using logs and db tables.

WP-896 - 2h - 3h
KT on Macro history.

WP-795 - 1h - 1h
I spend less time on this. I did not get chance to discuss with Vinod.

25-Sep-2018 
-----------
WP-885 - 4h - 6h
I am working on this task.
I had discussion with Anubhav.
I am working on the code optimization in local. I will have Anubhav to review the code once it is done.

WP-896 - 2h - 3h
KT on Trackers.

26-Sep-2018 
-----------
WP-885 - 4h - 5h
I optimized the code which was added by Anubhav to fix the missing buses issue. This is promoted to staging and I tested it is working fine. Next, Anubhav has to review the code, then we can promote to production.

WP-795 - 2h - 3h
I spent sometime on this task. I am figuring out the alternate option to 'div' based approach from above URL. 

Vinod is not available today.

27-Sep-2018 
-----------
WP-885 - 3h - 3h
Worked with Manasa on testing. I will look into the observations.

WP-795 - 2h - 4h
I had discussion with Vinod and Vijendra. They said, it would be better to have hundreds of 'div's in realtime page html (browser) instead of downloading bus icon images from the server. Hence, I will move forward with 'div' based approach in POC, that is, creating a 'div' foreach bus icon and render over the map.

WP-906 - 1h - 2h
I had a discussion with Anubhav on this. 

28-Sep-2018 
-----------
WP-896 - 2h - 3h
Today, I worked with Anubhav on testing the Zonar in staging environment.

WP-885 - 3h - 4h
I am looking into the observations.
Before doing the production release yesterday,  I had taken back up for vehicle_ids, admin_bus_units, synovia_vehicle_mapping and current_position tables.
I checked the backup vehicle_ids, admin_bus_units tables for the missing buses, we are missing the buses there as well. 
<screen shot>
<screen shot>
This is an existing issue. And, I am debugging this in staging.

WP-795 - 0h - 1h
Okay. Today, I did not get much time to look into the POC as I was working with Anubhav on testing zonar in staging environment as part of KT.
Next, I will work on updating the  sample code to load more number of markers over the map, then will work to load markers in thousands.




01-Oct-2018 
-----------
WP-922 - 3h - 4h
I worked on this task.
I checked log file for First Student - Plymouth Meeting contractor. I don't see any error messages over there.
I ran the zonar restart script again today. Actually, the script is not restarting zonar processes, because I saw the same process ids after the zonar restart.
So, I killed the zonar processes and started them. Now zonar processes are up and running, application is making API calls First Student - Plymouth Meeting 
contractor.But, no data found in the response, hence record counts show 0 in db.
Note : Every 5 mins email alert for zonar/synovia data check, has been enabled again.

WP-885 - 4h - 4h
I am working on this task.
The reason for missing bus numbers, is duplicate mobile ids in vehicle_table. The mobile ids of these missing bus numbers are there 
in vehicle ids table for other bus numbers. 
select district_id, MobileID , BusNumber from vehicle_ids where MobileID in ('4831001469','4842038335', '4842038369', '4842039158','4842038203', '4842039476','4831001581','4842039293','4831001568','4831001570')
order by MobileID asc;
<screen shot>
And, I also checked vehicle_ids table's bus numbers with duplicate mobile ids in synovia_vehicle_mapping table, there are no buses.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.224&username=wtbuser&db=wtb_app_staging&select=synovia_vehicle_mapping&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=bus_number&where%5B0%5D%5Bop%5D=IN&where%5B0%5D%5Bval%5D=%270670LN%27%2C%270674LN%27%2C%270865LN%27%2C%270866LN%27%2C%270002LN%27%2C%270992LN%27%2C%270878LN%27%2C%270864LN%27%2C%270668LN%27%2C%270003LN%27&where%5B2%5D%5Bcol%5D=&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=&order%5B0%5D=gps_id&order%5B1%5D=&limit=50&text_length=100
<screen shot>
We need to identify all the mismatching buses from vehicle_ids table and correct it based on synovia mapping table.
Need to figure out the solution to prevent it in future.

04-Oct-2018 
-----------
WP-885 - 4h
I found the missing buses from vehicle_ids table and manually corrected it. Manasa please check.
So far, no log is enabled for this cron. I have enabled the log now. It will help for better debugging and permanent fix. 
I will create ticket based on log when it happens again.

WP-927 - 3h
I worked on this issue.
Tracking issue with CRsp1 can be debugged only when CRsp1 runs. Today, it did not run.
As we discussed, Hsp1 having same issue like CRsp1.
I checked tracked_vehicle_status table for Hsp1. It has data.
<screen shot>
But, rider page was still showing 'No bus info currently available' message in banner.
https://wheresthebus.com/rider.php?refresh=1&bid=35&uid=77412e83-a700-11e8-9ca4-0a58b35fe338&child_id=703324&debug=1&admin=1
<screen shot>
Need to check further.

WP-795 - 2h
I spent less time on this. Tomorrow, I will show loading more images in staging.

05-Oct-2018 
-----------
WP-932 - 4h - 5h
I am working on this.
Currently we are handling following buses in First Student William Penn.
'070 - 100947','3037-230376','512 - 130275','723-90733','728-90761','729-90727','731 - 103334','734 - 103335','749-90729','771-90731','782-152226','785 - 142587','800-90737','802-90724','803-090723','725 - 103332','776-103342','722 - 103346'
In staging, I downloaded all the buses into temp table zonar_vehicle_mapping_First_Student___William_Penn. 
I dont see requested new buses in zonar response, that is new buses are not there in fleet_number column of temp table.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.224&username=wtbuser&db=wtb_app_staging&select=zonar_vehicle_mapping_First_Student___William_Penn&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B2%5D%5Bcol%5D=fleet_number&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=R-1783&where%5B21%5D%5Bcol%5D=&where%5B21%5D%5Bop%5D=%3D&where%5B21%5D%5Bval%5D=&order%5B0%5D=&limit=500&text_length=100
And also, for existing bus numbers, we have logic to format the bus numbers, that is, 512 - 130275 becomes 512FS. How should we handle the new buses.
https://fir1645.zonarsystems.net/interface.php?username=apaul&password=welcome1&action=showopen&operation=showassets&format=xml

WP-927 - 2h - 3h
I am looking into Hsp1 as it is currently running.

08-Oct-2018 
-----------
WP-932 3h - 4h
I am working on this.
Today, I tried to get the requested zonar buses. I received 60 bus in full name 60-085594. This is formatted as 60FS as per current bus number logic for First Student William Penn. We already have 804FS (full name 804-90717).
We are still missing R-1783. How this bus number should be formatted once we get this?

WP-927 3h - 3h
I worked on this.
My observation :
Bus Hsp1 is a sub bus for bus 35. 
 !screenshot-4.png|thumbnail! 
Tracked status table is getting updated only for bus Hsp1.
 !screenshot-5.png|thumbnail! 
And, no tracking status details for bus 35.
 !screenshot-6.png|thumbnail! <screen shot>
I checked the rider status page wheresthebus.com/admin/rider_status.php?district=49 it is fetching tracking status data for bus 35. And, we are getting 'no info' message as there is no tracking data available for 35 in db table.
I believe same logic is followed in rider page.
As discussed, tracking data for Hsp1 and no tracking data for 35, is correct.
In rider page, 'no info' message is displayed when all the bellow conditions are met.
1.If FitTime has value 
2.If difference between FitTime value and current time value, is greater than 600 seconds(10 mins) 
3.If last_event_timestamp(from tracked_vehicle_status table) has no value 
I checked rider page, same conditions are there, but need to confirm when bus is running.

WP-795 - 30m - 1h
Ryan, I had a discussion with Pritha on this.
Pritha, as we discussed, I have moved the code to staging which loads 2500 bus icons. Please check that and proceed further.  
http://staging.wheresthebus.com/BusIconPOC.php

09-Oct-2018 
-----------
WP-932 - 2h - 2h
This is released to production to show bus numbers 60 and 804. These two buses are added to the db tables by zonar nightly import cron. I checked these two buses are there in zonar_mapping, vehicle_ids, admin_bus_units and current_positions tables.
This is also showing in Realtime page. Please check.

WP-739 - 2h - 3h
I am working this.

Driver images are not promoted to production due to duplicate driver id issue with customer provided pictures. 

Driver ids are expected to be unique across the district. We have got two different images for same driver id. 
I have identified such duplicate driver pictures with image extensions. We will discuss more on the skype call.

Durham 
50020	jpg, png
50042	jpg, png

Philly Trans
80027	jpg, png
80035	jpg, jpeg

First Student
120006	jpg, jpeg
120010	jpg, png
120011	jpg, jpeg
120039	jpg, jpeg
120056	jpg, jpeg

Total Transportation
230002	jpg, jpeg
230007	jpg, jpeg
230015	jpg, jpeg
230033	jpg, jpeg
230037	jpg, jpeg
230044	jpg, png
230060	jpg, jpeg
230063	jpg, jpeg
230074	jpg, jpeg
230077	jpg, jpeg
230078	jpg, jpeg
230082	jpg, jpeg
230088	jpg, jpeg
230093	jpg, jpeg
230097	jpg, jpeg
230104	jpg, jpeg
230110	jpg, jpeg
230222	jpg, jpeg
230228	jpg, jpeg
230231	jpg, jpeg
230232	jpg, jpeg
230238	jpg, jpeg
230242	jpg, jpeg
230243	jpg, jpeg

WP-927 - 3h - 4h
I checked the rider page. All the above three conditions are met, that's why it is showing red banner with "No bus info currently available.". Rider page gets tracker info for bus 35.
Note : FitTime represents regular pull out time from depot. This comes from fit_time column of tracked_vehicle_status table.

10-Oct-2018 
-----------
WP-739 - 5h - 6h
I cleaned up the driver images. I deleted old one and retained the new one based on image date. After clean up, we have 750 driver images.
Images are saved in app server and updated db using script. Out of 750 driver images, only 423 images are saved as rest of the driver do not have record in driver_details table. So, they are ignored.
I will check with Vijendra to sync these images to S3.
Vijendra is not available today. So, I worked with Suresh to upload the driver images to S3. Driver images are available in S3 for tablets.
Ryan, I think something is not correct with WP-938 Done update and driver image details are lost in driver_details table . After production release, 432 drivers had images and now only 34 driver have images in driver details table.
All the driver images are saved again in the database. Again, Suresh helped to upload driver images to S3.
As we lost some of the driver pictures that we saved in our db initailly, are restored again.
Now, totally we have pictures for 569 drivers.
<screen shot>
Please find excel that has list of driver pictures that dont have record in driver details table. Some of the pictures are not valid as they have driver name as file name.

WP-927 - 2h - 2h
I am working on this.
For working sub bus like 39 from district 1, the tracking data goes to bus 11 in tracked_vehicle_status table. This is not happening in for sub bus Hsp1.
I am looking into the issue.

11-Oct-2018 
-----------
WP-739 - 4h - 7h
I worked on this.
I added leading zero to the file names except the files with text as tile file name.
All the driver images are saved in application and db tables. Now, totally 727 drivers have pictures.
screenshot-2.png
I will take Vijendra's help to get new driver images to S3.
Only driver pictures that have text as file name, are left.
Class One _Eugene_sullivan.png
Corestaff_Aaron_ShearerJr.jpeg
Corestaff_Alexis_Pointdexter.jpeg
Corestaff_Aniya_Freeman.jpeg
Corestaff_Atiya_Jones.jpeg
Corestaff_Erika_Hamilton.jpeg
Corestaff_Haleemah_Ketter.jpeg
Corestaff_Jonathan_Joseph.jpeg
Corestaff_June_Grant.jpeg
Corestaff__Lisa_Timms.jpeg
Corestaff_Nya_Rawls.jpeg
Corestaff_Sharnira_Townsend.jpeg
Corestaff_Shayana_Cleveland.jpeg
Corestaff_Tyanna_Akers.jpeg
Delta-T_Alexus_Figueroa.jpeg
Delta-T_Christine_Smith.jpeg
Delta-T_Dazsa_Allen-Green.jpeg
Delta T_Hattie Holloway.jpeg
Delta-T_Nicole_Bruce.jpeg
Delta T_Prenesia Barrett.jpeg
Delta T_Sandra Darko.jpeg
Delta-T_Shykia_Fullurd.jpeg

WP-795 - 1h - 2h
I had a discussion with Pritha on realtime page. I discussed about realtime data lookup from server and loading realtime bus data(icons) over map and left side table.

12-Oct-2018
-----------
WP-927 - 6h - 8h
Yesterday, I spent very less time, so I did not update the ticket.
I worked on this today.
I am analysing the tracker coding related to route bus and sub bus.
And, I am also parallelly checking functionality for working sub bus with debugging message and produciton logs while buses are driving.

15-Oct-2018
-----------
WP-927 - 6h - 8h
I worked on this.
There is an sql query that finds sub bus assignments. This query runs fine for working sub bus 39 in district 1.
screen shot
And, it is not working for sub bus Hsp1 in district 49. The result set is empty.
screen shot
Based the sql result, assigning tracking data of sub bus to the bus(not runing) is decided.
I will check with Prakash on the above sub bus sql query.

16-Oct-2018
-----------
WP-927 - 3h - 4.5h
I discussed with Prakash. And, I also checked similar sub bus scenarios in other parts of application and I modified the sub bus query in tracker.
<screen shot>
Prakash, Can you please review the update?
We can release this to production tomorrow.

WP-906 - 3h - 4.5h
I have started looking into this.

17-Oct-2018
-----------
WP-927 - 2.5h - 3h
This is promoted to production. I will test when buses are driving.
I have tested this it is working fine. Please check.
Rider page:
 !screenshot-15.png|thumbnail! 
DB table tracked_vehicle_status:
 !screenshot-16.png|thumbnail! 

WP-949 - 2h - 2h
I did not stop the email alerts. I restarted zonar process. I checked zonar response, and found authorization error.
Datto is from district 26.

Ticket Summary : Zonar credential issue with Datto
Description : Zonar credentials are not working for Datto. We are getting authorization error with zonar response. Need to correct this.
https://dat1154.zonarsystems.net//interface.php?username=datt0583&password=welcome1&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1539735355&endtime=1539735386
This credentials issue was while checking the email alerts for Dattco.

WP-906 - 3h - 3h
I worked on this
Memcache is working fine. I don't see any issue with Memcache. I checked its functionality for vehicle_ids table data as well as for other table data with different expiry times. It works fine.
I created a script to test the functionality. First time, when the script runs, it fetches the data from db and saves it in Memcache. Next time, when it runs, it will check for data in Memcahe, if it is available, then it uses from Memcache else it will fetch the data from DB.
Fetches data from db:
Fetches data from Memcache:
Both, DB data and Memcache data are same. And, Memcache data will get updated with DB data when the cache expires.

18-Oct-2018
-----------
WP-949 - 2h - 3h
I have shut down the zonar for District 26 - Dattco contractor. 
I restarted zonar process. I tested the database, zonar is not working for this contractor and it is working for other contractors.

WP-906 - 4h - 5h
I worked on this.
I checked the Memcache implementation of bus data from vehicle_ids db table. This is fine. But, I observed the Memcache key used here, has been used in a common php script as well. It is expected to be unique. So, I have changed the cache key in automatic model creation class file. This might be the reason for not getting the updated bus data.
And, also Memcache is disabled here as part of WP-905. I have enabled it again. 
Updates are in my local.

WP-948 - 1h - 1h
I have just started looking into this.

23-Oct-2018
-----------
WP-948 - 6h - 9h
I am working on this.
I have few clarifications.
1. Individual school arrival report - school_arrival_report.php, is based on buses arrived. If no arrival is reported then UI table will be blank. 
New report is based on assigned route numbers, we need to show the assigned routes and buses even if there is no arrival. 
Shall I display the assigned routes as first column in UI table.
2. How to show routes that is assigned with multiple buses? We are showing comma seperated buses in "All Schools (assigned buses)" report.
<screen shot>
DBA worked on "All Schools (assigned buses)" report SQL queries. I will take his help if required.
Once the report works well then I move on to Last export to excel.

24-Oct-2018
-----------
WP-906 - 30m - 1h
Automatic model creation's Memcache update is promoted to Production. Production release was delayed due to AM and PM Automatic model crons running.
Please test in production.

WP-948 - 5.5h - 7h
I am working on this. This is in progress.
I worked on getting routes & bus assigned to given school and their arrivals.
Currently, I am working on building required data structure to present the data.
As we discussed yesterday, I am creating two rows for same route but different bus number.

25-Oct-2018
-----------
WP-948 - 6h - 9h
I am working on this. 
I have completed showing assigned routes & buses and their arrivals for selected school. 
I have moved development code to PrePro as we have data in production db to check the report.
http://prepro.wheresthebus.com/admin/school_assigned_buses_arrival_report.php?district=7&school=452&startDate=10%2F18%2F2018&endDate=10%2F19%2F2018&adminUnits=&day_part=AM&action=Submit
I am working on average calculations.

26-Oct-2018
-----------
WP-948 - 6h - 8h
I am working on this.
I added arrival filter to the report.
I completed average calculations for each bus.
Updates are available in prepro.
I am working on totals(average calculation). I will promote this after the call.
Clarification :
In all school assigned buses report, routes that has no buses assigned also reported.
http://prepro.wheresthebus.com/admin/all_school_assigned_buses_arrival_report.php?district=15&startDate=10%2F18%2F2018&endDate=10%2F19%2F2018&action=Submit&daypart=AM&adminUnits=&timeWindow=45&earlylateHid=0&early=30&optimal=20&marginal=10
screenshot-3.png
In new report, routes that associated with a bus number are reported.
http://prepro.wheresthebus.com/admin/school_assigned_buses_arrival_report.php?district=15&school=910&startDate=10%2F18%2F2018&endDate=10%2F19%2F2018&adminUnits=&day_part=AM&action=Submit
screenshot-2.png
Should we show routes that has no buses here?

27-Oct-2018
-----------
WP-948 - 5h - 7h
I worked on this.
I have completed total and average calculations.
I have added logic to show routes with no buses in the report.
Updates are available in PrePro.
Tester can test this report in PrePro.
Export to excel is the outstanding here. I will work on this.

WP-932 - 1h - 2h
Bus 801 is added and it is promoted to staging. It appears in realtime page. Please check.
It is full form is 801-90762 and its GPS ID is 8177418.

29-Oct-2018
-----------
WP-932 - 1h - 1.5h
Bus 801 is added to production. This bus appears in realtime page and also in 'FS - William Penn' admin unit.
Please check.

WP-948 - 5h - 6.5h
I worked on this.
This is added to reports section. It appears in both reports.php as well as reports popup in Realtime page.
I added School name ad search feature to the report.
In "All Schools (assigned buses)", we implemented rounding the minute in time. In this new individual school report, I have followed the same way of rounding the minutes in time. But, in exiting individual school report(school_arrival_report.php), rounding the minute in time, is handled. That's why, there is a difference in arrival, departure & average minutes.

30-Oct-2018
-----------
WP-969 - 1.5h - 1.5h
UDP Servers and workers are restarted for this update. It is done with Shilpa's help.
I will check the message time in daily events table after heart beat time.
I checked this in production. GPS messages including heart beats, are received in the central time as expected.

WP- 935 - 45m - 1h
Worked with manasa on testing zonar/synovia data feed email notificaiton test in staging.

WP-966 - 3h - 3.5h
I worked on this.
This bus does not have entry in the current_positions table. That's why, it is not appearing in the Realtime page. I have added an entry for this bus in current_position table. Now, it is working fine.

WP-967 - 2h - 3h
I worked on this.
New district is created and promoted to staging.
Need to copy all the geozones of district 48 to this new district. I will do this first in staging and then production.

31-Oct-2018
-----------
WP-963 - 5.5h - 8h
I am working on this.
New state tiger import is not done in tiger2. I discussed with DBA Kathi and found we are missing tiger configuration in AWS.
We need few postgres extensions to get new tiger state data. These extensions are just installed in AWS tiger servers and not configured. Because of that, tiger import did not happen. I have identified the configurations that need to be done in tiger machine to get new tiger state data.
Version of postgres extensions installed in AWS tiger servers, are higher than what we had in Linode. AWS postgres extensions comes with 2015 tiger data by default. Currently we have 2013 tiger data for all the downloaded states. We need to update AWS postgres extension to download 2013 tiger data.
I had a discussion with Vijendra, he suggested to updated all the present tiger data to lastet tiger data and proceed with the lastest one for new states. He will discuss with you more on this.

WP-967 - 30m - 1h
All the geozones of district 48 are copied to district 52 in Staging

02-Nov-2018
-----------
WP-967 - 1h - 1h
This is promoted to production. All the geozones of district 48 are copied to district 52

WP-963 - 4h - 5h
I have done the configuration for tiger extensions in Tiger2 machine.
Getting 2015 data for new state would be better than updating the tiger extensions to get 2013 data.  I discussed with DBA Karthi and started import process with 2015 data for new state MT.
But, AWS tiger import did not run correctly as expected. I am debugging the issue and looking into log for more details.
I will discuss with Vijendra as well
By checking log file, I found two things are not working correctly. 
1. Executing Postgres statements from import script.
2. Converting tiger source data into Postrgres statements.
I discussed with Vijendra and he helped.
#1. Found solution. It is working.
#2. Need to work with Vijendra to fix the issue.
Need to fix the issues to try MT tiger data importing again in Tiger2.

WP-948 - 2h - 3h
I spent less time on this task.
#3. This fixed. 
#5. This is fixed. 

07-Nov-2018
-----------
WP-963 - 4h
I worked on this. I discussed with Vijendra.
#2 This is fixed. 
I started tiger data import for MT. It took long time as the business hour started. I stopped the process and will run again tomorrow in off time.

WP-980 - 3h
I am working on this.
First bus 0807 runs for PM trip. I am not able to debug it.
Second bus 1439 runs in AM tip as well. I checked the db entry and rider page. It seems working correclty.


12-Nov-2018
-----------
WP-983 - 6h - 8h
I am working on this.
I am checking this in staging.
I ran the synovia asset mapping cron. Imported only Wisconsin Central buses. Currently, We are getting 85 buses from Synovia API for Wisconsin Central. I can see buses got new esn got. 
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.224&username=wtbuser&db=wtb_app_staging&select=synovia_vehicle_mapping_temp_12Nov2018&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=&order%5B0%5D=&limit=100&text_length=100
WC buses are there in vehicle_ids table with old esn. And, they appear in realtime page as well.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=vehicle_ids&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=BusNumber&where%5B0%5D%5Bop%5D=LIKE+%25%25&where%5B0%5D%5Bval%5D=WC&where%5B1%5D%5Bcol%5D=district_id&where%5B1%5D%5Bop%5D=%3D&where%5B1%5D%5Bval%5D=15&where%5B3%5D%5Bcol%5D=&where%5B3%5D%5Bop%5D=%3D&where%5B3%5D%5Bval%5D=&order%5B0%5D=BusNumber&order%5B1%5D=&limit=100&text_length=100
Loos like, managing new esn for the buses, is not handled in existing synovia mapping cron.
I suspect, esn update causing the issue in bus tracking.

I checked the raw GPS message, Synovia does not send GPS number. But, it send the GUID of vehicle that we have in mobile_id column of synovia mapping table.
Screen shot GPS
GPS ids start with 48 is the latest id from Synovia API.
screen shot new ESN
So I updated the latest gps ids in db only for those buses refers old gps id. I have done this only for WC buses. 
After the update, GPS data started updating for WC buses.
Please check.

13-Nov-2018
-----------
WP-983 - 4h - 5h
I worked on this.
1)I checked vehicle info for LN, LS and DB bus companies in vehicle_ids table. I compared the GPS id of vehicle table with mapping table.
GPS ids of vehicle_ids table match with mapping table for LN, LS and DB buses. So, GPS id is not updated in vehicle_ids table.
I observed one thing. Only for WC, Synovia asset mapping API sends all buses with ESN starts 48. In other bus companies LN, LS and DB, Synovia API still sends ESN with 48 and 43 as well. 
LS API reponse with 43
screen shot
LS API reponse with 48
screen shot
2)Need to work on cron logic.

WP-980 - 3h - 4h
I am looking into this issue. 
I am facing bit challenge with this issue as it can be effectively debugged during the bus drive and bus is driving in afternoon.

14-Nov-2018
-----------
WP-906 - 3h - 4h
I looked into this.
Memcache is not causing issue here. In this class file, only bus numbers are stored in memcache. 
Most of these bus number are modified on 28th & 29th of Oct. 
https://www.wheresthebus.com/admin/past_gps_assignments.php?district=50
And, updated bus numbers are available in memcache.
Looks like, there could be an issue with functionality of automatic model creation for the missing models.
I discussed with Ramesh.

WP-980 - 3h - 4h
I am working on this.
I am checking the logs. I can see the last_event_timestamp (last gps message time) was correctly set in tracked_vehicle_status table. 
Sql query from log for Bus 0501(0807).
UPDATE tracked_vehicle_status SET
lat="30.3246858",
lon="-97.6873345",
model_time_offset="2",
fit_distance="229.67961558479",
confidence="1",
last_event_timestamp="1542152761",
last_tracker_refresh_time="1542156363",
on_track="1",
status_data='{"completed_stop_ids":[17917025,17917024,17917023,17917021,17917020,17917019,17917018,17917016,17917015,17917013,17917012,17917011],"last_event":{"id":"254287036","MobileID":"4841028386","BusNumber":"0807","SequenceNumber":"1224","UpdateTime":"1542152761","Latitude":"303227526","Longitude":"-976864936","Heading":"347","Speed":"0","IgnitionOn":"1","RedsOn":"0","EventCode":"182","Accumulator0":"153272","Accumulator1":"13801","stamp":"2018-11-13 19:46:03","district_id":"16","inputs":"1000001","route":"0807","gps":"1101","comm":"1111","geozone_id":"1079","in_geozone":"1079","geozone_type":"0"},"at_stops":null}',
cur_model_index="601",
paused="0",
in_geozone="Nelson Bus Terminal",
fit_time="0",
on_track_rate="86",
confidence_rate="88"
WHERE district=16 AND
vehicle_id="0807"

Do we still have issue with PM trip for above buses?


15-Nov-2018
-----------
WP-906 - 4h - 5h
I am working on this.
I have never worked on automatic model stuff. I need time to understand the functionality and implementations, required to address this issue. I am looking into this.

WP-980 - 3h - 4h
I am working on this.
I was checking the logs. It has update sql for 0807 only in AM trip. And, there is no update sql for PM trip. I am looking into this.

16-Nov-2018
-----------
WP-980 - 4h - 5h
I am looking into this.
I checked the logs and based on it, I was looking into the coding. I have added additional log to help debugging.

WP-906 - 3h - 3h
I spent less time on this. 
I started checking the required functionality and its implementations.

19-Nov-2018
-----------
WP-970 - 30m - 1h
I discussed with Swarnim and given him the inputs to work.

WP-980 - 3h - 3h
I am looking into this.
I checked the logs for 11/16. I can see the tracker update queries for complete PM trips. 
UPDATE tracked_vehicle_status SET
lat="30.2482273",
lon="-97.7361828",
model_time_offset="362",
fit_distance="45.980649440235",
confidence="1",
last_event_timestamp="1542400241",
last_tracker_refresh_time="1542403844",
on_track="1",
status_data='{"completed_stop_ids":[17917025,17917024],"last_event":{"id":"255526764","MobileID":"4841028386","BusNumber":"0807","SequenceNumber":"828","UpdateTime":"1542400241","Latitude":"302480953","Longitude":"-977357293","Heading":"284","Speed":"52","IgnitionOn":"1","RedsOn":"0","EventCode":"231","Accumulator0":"90170","Accumulator1":"13740","stamp":"2018-11-16 16:30:44","district_id":"16","inputs":"1000001","route":"0807","gps":"1111","comm":"1111","geozone_id":null},"at_stops":null}',
cur_model_index="144",
paused="0",
in_geozone="",
fit_time="0",
on_track_rate="100",
confidence_rate="100"
WHERE district=16 AND
vehicle_id="0807"
As per the log, tracking details for the 0501(0807) is correctly getting updated in tracked_vehicle_status table.
Can you please check the issue with this bus or anyother bus having similar issue?
I checked the log from 5pm to 6pm estern time. Tracker's update sql queries are fine. I have given sql for 5.30pm eastern time.
UPDATE tracked_vehicle_status SET
lat="30.2615196",
lon="-97.6943056",
model_time_offset="318",
fit_distance="52.616614786341",
confidence="1",
last_event_timestamp="1542403810",
last_tracker_refresh_time="1542407413",
on_track="1",
status_data='{"completed_stop_ids":[17917025,17917024,17917026,17917020,17917019,17917018],"last_event":{"id":"255587247","MobileID":"4841028386","BusNumber":"0807","SequenceNumber":"1011","UpdateTime":"1542403810","Latitude":"302619628","Longitude":"-976944971","Heading":"166","Speed":"44","IgnitionOn":"1","RedsOn":"0","EventCode":"231","Accumulator0":"109825","Accumulator1":"13740","stamp":"2018-11-16 17:30:12","district_id":"16","inputs":"1000001","route":"0807","gps":"1111","comm":"1111","geozone_id":null},"at_stops":null}',
cur_model_index="297",
paused="0",
in_geozone="",
fit_time="0",
on_track_rate="98",
confidence_rate="100"
WHERE district=16 AND
vehicle_id="0807"
Also please check, the no bus info stays in the screen or disappear after sometime.

WP-948 - 3h - 4h
I am working on this.
#1 This is addressed and available in Prepro.
#2 I have started working on this.


20-Nov-2018
-----------
WP-948 - 2h - 3h
I am working on this.
1.I had discussion with Ramesh and DBA Karthi on showing plan time in the new report.
Clarifcation:
When a bus has multiple plan times, then how to show that in report. Example, your's yesterday(11/19) comment on WP-984. Bus 324 has three plan times.
1. 8:50 A.M.
2. 8:47 A.M.
3. 11:50 A.M.

This new report is created as the Individual School Arrival report version of All Schools (assigned buses) report. It uses school bell time for arrivals.
As we discussed in Skype call today, this new report needs to be modified to find the arrivals based on plan time of each bus. 
This report would be the Individual School Arrival report version of New All School Arrival Report based on Planned Arrival time WP-984.
We will continue working on this ticket after WP-984 gets completed as we can use some of the logic and implementations from there.

WP-993 - 2h - 2h
This is completed and promoted to staging.

WP-994 - 2h - 2h
This is completed and promoted to staging.

WP-995 - 2h - 2h
This is completed and promoted to staging.


21-Nov-2018
-----------
WP-993 - 2h - 2h
I looked into the issue.
New districts are not reflected in the server side caching. This is working now after clearing the cache. No other thing required here.
<screen shot>

WP-994 - 0h
This is working after clearing the cache. No other thing required here.

WP-995 - 0h
This is working after clearing the cache. No other thing required here.

WP-983 - 4h - 6h
I have started looking into updates required in synovia_asset_mapping cron logic.


22-Nov-2018
-----------
WP-993 - 1h - 1h
This is promoted to production. It is working fine.

WP-994 - 0h
This is promoted to production. It is working fine.

WP-995 - 0h
This is promoted to production. It is working fine.

WP-997 - 6h - 8h
I am working on this.
I discussed with the team about this issue. 
I checked the SVN logs as well as checked with the team, there is no recent release that can impact realtime page.
I am looking into existing code. Master icon files are not issue. I removed master icon files and checked the realtime page performance, it did not improve.
And, student search data(student button) is not issue. I removed student data loading in realtime page, performacne did not improve.
I am checking other parts of realtime page.
I discussed with Vijendra about the realtime page issue. His observations/suggestions are given below.
1. CPU and Memory are normal when we run realtime page for large customers.
2. We can try accessing the images directly from S3. Need to check the php work involved for this change.
3. Ajax calls need to be reviewed for late start buses, unassigned buses.
4. Need to find the total memory taken for the realtime page by the browser.

22-Nov-2018
-----------
WP-997 - 6.5 - 8h

I am working on this.
I removed late start buses and unassigned buses ajax calls and tested, it is not causing the performance issue.
Also checked geozones in realtime page, it is not causing the performance issue.
I tried calling the images directly from S3. These images includes bus icons, other tiny UI images. It did not help to resolve the performance issue we are currently facing with realtime page.
Looks like the handling/processing the background data(15 secs realtime data) in client side(web browser) is causing the performance issue like click actions when we load all the buses of large customers. And, left side bus table and map data are based on this background data. 
Need to check this code/implementation for any quick fix can be given.

27-Nov-2018
----------- 
WP-1002 - 3h - 3h
I restarted the Zonar process. Zonar api calls are working correctly for all contractors including the above 5 contractors. I checked in db and logs as well.

WP-997 - 6h - 6h
I am working on this.
I looked into the implementation of processing background data(15 secs realtime data) where left bus table and right map updates are happening.
We have two issues in performance. 
1. Large delays between a button click and its response(freezing state for sometime).
2. Page is loading for forever.
#1 Based on the debugging, it is happening from updating bus table and map data. And, major contribution is from updating bus table data. I have started looking into optimizing the bus table data update.
#2 This is not consistently happens. I am checking this as well.
 !screenshot-1.png|thumbnail! 
Tomorrow, I will discuss with Vijendra both #1 & #2.

28-Nov-2018
-----------
WP-1003 - 2.5h - 3h
Both App and Php servers are restarted in AWS. Following things are tested and working fine.
1. Apache server
2. Memcache
3. Image mounting
4. Zonar process
Note: AM and PM automatic crons were stopped for server restart and then started two crons again. 
Suhas confirmed application in app & php servers are working.
I checked the processes running in App Server. Zonar processes were on top in process list. It can down after sometime.

WP-1002 - 0h
Zonar process need to be restarted manually.
Since, zonar restart is listed in server restart check-list items, team should aware of this. I will check with them once.

WP-997 - 5h - 5h
I discussed with Vijendra. He has given some inputs to tune the client side code. I am looking into this.


29-Nov-2018
-----------
WP-997 - 1h - 2h
Found one more update that can help to improve the preformance of realtime page. This is point number 4 and is given below.
4. Bus table data update and map data update are implemented in one block. Split it into two logical blocks one for updating 
bus table data and another one for updating  map data.
Mapping Updates Vs Subtasks
#1 WP-1007
#2 WP-1008
#3 WP-1006
#4 WP-1009
As of now, only #4 update is there in Prepro.

WP-1007 - 3h - 3.5h
This is completed and code is in my local.

WP-1009 - 3h - 3.5h
This is completed and available in Prepro. Please check.

30-Nov-2018
-----------
WP-1009 - 3h - 4h
This is released to Production around 2AM EST and asked Suhas to test after the release.
I tested the realtime page. It is working fine.

WP-980 - 2.5h - 3h
I spent sometime on looking into the issue. 

WP-999 - 30m - 1h
I checked this new district in staging and production. This is working fine.
Earlier, there was a confusion on UDP restart from java team end, whether restart is required or not while setting up a new district. Hence, we used to restart the UDP as a standard practice(document), when we set up a new district.
Looks like, UDP restart is not required going forward. We can remove UDP restart point from document.

03-Dec-2018
-----------
WP-983 - 7h - 8h
I am working on this.  
I am updating the required cron logic.

WP-1007 - 0h
Promoted to Prepro.

04-Dec-2018
-----------
WP-983 - 5h - 6h
I am working on this.
I have completed the cron updates in my local. Need to promote this staging and check the cron.

WP-980 - 2h - 2.5h
I am looking into this. I spent less time here.
0955(0764):
I checked the log. I don't see tracker update sql query for 0764 PM trip on 12/03. It has sql query for only for AM trip.
0616:
This bus ran only for PM trip on 12/03 and no tracker sql query found in log.

WP-1008 - 30m - 30m
Code updated for this ticket, is reviewed along with Ramesh.

WP-1006 - 0
Code updated for this ticket, is reviewed along with Ramesh.

05-Dec-2018
-----------
WP-983 - 6h - 6h
I worked on this.
I promoted the cron update to staging and tested the cron.
I found an issue in updating bus details in vehicle_ids table, this is addressed and available in staging.

WP-980 - 2h - 2h
I am going to start looking into this.
I spent less time on this. I will continue working on this tomorrow.

06-Dec-2018
-----------
WP-980 - 7.5h - 9h
I am working on this task.
I checked some of the tracker code required here. And, I have added additional logs based on that. I hope this will help in debugging the issue.

07-Dec-2018
-----------
WP-1016 7.5h - 8h
I am working on this.
I have updated zonar asset mapping cron logic for this new update. And, I need to check this in staging.

10-Dec-2018
-----------
WP-1016 - 7.5h - 8h
I worked on this task.
It is working fine. First Student 55(F5) buses are added to First Student West(FW). Last characters of all the buses end with FW.
I can see the buses in realtime page. please check.

11-Dec-2018
-----------
WP-1016 - 1.5h - 2h
I worked with Susha on testing.

WP-1023 - 4.5h - 5h
I am going to look into this.
I don't have access to S3 db backup. I will check with Vijay / Suresh.
Thanks for sharing December 2017 db backup file of district 22.
This is done. I have imported December 2017 data into daily_events_22 table in production DB. Please check.
It is working fine. I checked in Data viewer page and History page.
 !screenshot-1.png|thumbnail! 
 !screenshot-2.png|thumbnail! 

WP-980 - 1h  - 2h
I could not spend much time on this.

12-Dec-2018
-----------
WP-1016 - 1h - 1h
This is promoted to production. And, checked the cron. It is working fine.
Suhas Shetty please check.

WP-980 - 7h - 7h
I am working on this. 
This is taking more time and very challenging to find the root cause of this issue. I can work towards the fix once we find what is causing the issue.

13-Dec-2018
-----------
WP-983 - 1h - 1.5h
Worked with Sushas on testing.

WP-980 - 7h - 7.5h
I am working on this.
I was checking 12/12 logs. 0616 ran only for PM trip and there are no entries in the log file.
There is a logic for bus numbers to be tracked. I need to look into this logic and this could help to proceed further here.
I will continue working on this tomorrow.


14-Dec-2018
-----------
WP-980 - 7.3h - 8h
I am working on this.
I looked into the logic for bus numbers to be tracked. Looks, like the reported bus numbers are not in tractable bus list and we are missing the tracking data those buses.
There are 5 trackers for District 16. Other districts don't have this kind of trackers. Will discuss more on the call.
Tracked bus lists are stored in tracker_run_details db table during tracking hours. I noticed this db table data gets cleared unexpectedly. Need to look into this.

15-Dec-2018
-----------
WP-980 - 2h - not logged in jira - 3h
I am working on this. I spent less time on this.

I am looking into tracker_run_details db table data clearance issue. This is expected to be cleared when the district tracker hours ends.

WP-1028 - 3h - not logged in jira - 3h
I worked on this.
This is completed and available in staging. Suhas, please test.

WP-1029 - 3h - not logged in jira - 3h
I worked on this.
This is completed and available in staging. Suhas, please test.

17-Dec-2018
-----------
WP-1028 - 1h
This is promoted to production. UDP is restarted as part of new district setup in production.
I will test and update the ticket.

WP-1029 - 30m
This is promoted to production. UDP is restarted as part of new district setup in production.
I will test and update the ticket.
Tested in production. New district is working fine. It appears in realtime page district dropdown and other php pages as well.

WP-983 - 2h
This is promoted to production.
I will test and update the ticket.
Tested in production. This is working fine.
I checked bus number & GPS id from synovia mapping table, are matching with Bus number & Mobile id in vehicle ids table. This is working fine. I have also verified bus number in admin units.  and verified buses in realtime page & bus manager as well.
I have done code review with Pritha.

WP-980 - 4h - 4.5
I worked on this.
I worked on the issue in clearing the bus list from tracker_run_details before the tracker actually ends. This is done in my local.

18-Dec-2018
-----------
WP-980 - 3h
tracker_run_details fix is promoted to production, prepro and staging.
I will check the trackers when it runs.
So far, tracker are working fine with the new update. I will continue monitoring it.

WP-983 - 30m - 1h
Today, I checked synovia asset mapping cron in production. It is working fine with new updates.

WP-1031 - 4h - 5h
I worked on this.
I have completed update in my local. 
I have not tested it. I need to run and check the update in staging.

19-Dec-2018
-----------
WP-1031 - 4h
I worked on this.
I promoted the updates to staging. And, ran the cron and checked the functionality. It is working fine. 
Please check.

WP-1034 - 1h

20-Dec-2018
----------- 
WP-1031 - 3h (release+testing+review)
This is promoted to Production.
I will test and update the ticket.
I checked the new update after the zonar asset mapping cron. It is working fine.
1. "School Vehicle Division" location buses are added to zonar mapping, vehicle ids, admin unit and current position db tables.
2. New icons for the buses were created correctly.
3. New buses appear in the realtime page and I can see realtime data started (SV009PT).

WP-1034 - 8h
I am working on this.
I worked on district 55 to zonar setup. I have done the coding updates in my local and need to check the functionality in staging. 
Zonar credentials of district 26 are not wroking currently. I could not use it for district 55. We need to fix this in order to proceed further.
Credentials used in application for district 26 :
weburl =>https://dat1154.zonarsystems.net/
username =>datt0583
password =>welcome1
URL to get buses:
https://dat1154.zonarsystems.net/interface.php?username=datt0583&password=welcome1&action=showopen&operation=showassets&format=xml
And, I also observed zonar import for district 26 is disabled in our applicaiton.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_vehicle&select=zonar_data_information&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=file_location&where%5B0%5D%5Bop%5D=LIKE+%25%25&where%5B0%5D%5Bval%5D=dist_id%3A26&where%5B2%5D%5Bcol%5D=&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=&order%5B0%5D=id&desc%5B0%5D=1&order%5B1%5D=&limit=50&text_length=100

21-Dec-2018
-----------
WP-1034 - 8h
I am working on this.
Credentials are working now for district 26 and district 55.
I have enabled zonar for district 26 as well.
Promoted zonar asset mapping updates to Staging and checked. It is working fine. Currently, we have only one contractor "Dattco" for District 26. 
And, we have 47 buses under "New Canaan" location, same 47 buses got into district 55 with leading 0 in gps id.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.224&username=wtbuser&db=wtb_app_staging&select=zonar_vehicle_mapping&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=26&where%5B1%5D%5Bcol%5D=gps_id&where%5B1%5D%5Bop%5D=%21%3D&where%5B1%5D%5Bval%5D=&where%5B2%5D%5Bcol%5D=location&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=New+Canaan&where%5B4%5D%5Bcol%5D=contractor_name&where%5B4%5D%5Bop%5D=%3D&where%5B4%5D%5Bval%5D=Dattco&where%5B41%5D%5Bcol%5D=&where%5B41%5D%5Bop%5D=%3D&where%5B41%5D%5Bval%5D=&order%5B0%5D=contractor_name&desc%5B0%5D=1&order%5B1%5D=&limit=500&text_length=100
I have updated zonar GPS data import process for district 55.
I need to check the functionality in staging.

26-Dec-2018
-----------
WP-1034 - 8h
I am working on this.
I have updated latest zonar gps functionality code to staging environment. It was very old earlier.
I have promoted the zonar gps updates for district 55 to staging and testing it .
I will update the ticket after the call.

Admin unit is changed to "Dattco".
District 55 zonar is working fine in Staging. 
I could not see the realtime data in realtime page as Dattco buses are not running. Dattco buses are not moving in district 26 as well.
Please check the updates in staging.

27-Dec-2018
-----------
WP-1034 - 4h - 4h
This is promoted to Production. 
District 55 zonar setup done in production and District 26 zonar is enabled.
I need run the zonar cron and check the functionality in producton.

Dattco admin unit is added to district 55.
I ran the zonar asset mapping cron in production. It is working fine. Dattco buses are not driving, so no data in realitme page. 
Bus icons were created successfully. Icons will be plotted in realtime page map when we start getting GPS data.
District 26's zonar API calls started resuming. We got few email notifications on zonar data feed import. Emails stopped automatically once the release is settled in producton.

WP-1045 - 3h - 4h
I discussed with Vijendra on this issue and no connection time out parameter is set for zonar api calls. Added CURLOPT_CONNECTTIMEOUT parameter with Vijendara's help.
As discussed with Ryan, timeout parameter is set to 30 seconds. We will change this value in future if the request is taking more time.

28-Dec-2018
-----------
WP-1045 - 6h
I will look into this issue.
I will discuss with Vijendra on this.

I worked on this. 
Yesterday, we set timeout value as 30 seconds. So, our application will be waiting for 30 seconds when zonar system is down. This can cause the CPU load.
I checked for timeout options. CURLOPT_CONNECTTIMEOUT is a timeout for connection establishment means connection phase and not for data transfer.
https://curl.haxx.se/libcurl/c/CURLOPT_CONNECTTIMEOUT.html
So, we can set this timeout value minimal. I set this value t0 3 seconds in production and confirmed with Vijendra. 
This will fix the CPU load issue when zonar system is down.
Tested zonar import with current timeout settings. It is working fine. We need to monitor when buses are driving.

WP-1043 - 1h
I have just started looking into this.

02-Jan-2019
-----------
WP-1043 - 6h
I worked on this
I have setup the macro crons for the given districts.
Next, we can promote this to production.

WP-1050 - 2h
I am working on this. Will update the ticket once it is done.
I checked with the team and deleted backup tables  from production db.
After clearing the above backup tables, I found some additional backup tables in production db and deleted those tables as well.
I can see backup db tables in staging db as well. I will delete them as well.
Following tables are cleared from staging db.

03-Jan-2019
-----------
WP-1043 - 1h (release + review)
This is released to production.
New macro group crons are setup in production. Please check.

WP-1050 - 1h
Found and deleted few more tables from production db.
admin_bus_units_test
current_positions_test
synovia_vehicle_mapping_test
vehicle_ids_beforecleaningRouts
Nothing left here for now. we can close the ticket.

WP-1049 - 6h - 7h
I am working on this issue
Following Dairyland buses are not in vehicle_ids and admin units tables. When we filter by Dairyland admin unit, these buses will not be listed.
0566 = 1952
0569 = 1955
1762 = 803
I need to check whether we are getting above three buses from synovia api.
Except above three buses, we have records for other buses in vehicle_ids table, but they don't have record in bus_route_info table for the 12/20. 
Bus number for the route, is fectched from the bus_route_info table and it is managed in bus_route_info_AM & bus_route_info_PM crons. 
@Prakash can you please check why we are missing records in bus_route_info table for 12/20.

04-Jan-2019
-----------
WP-1043 - 2h - 2h
I worked on this.
I checked the macro cron run for given districts. It ran well.

WP-1049 - 5h - 6h
I am working on this.
1) I checked the missing buses from vehicle_ids table. They are missing in synovia mapping table as well. 
I ran the synovia import manually in staging for testing. We are not getting these buses from Synovia API. Import data from temp table.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.224&username=wtbuser&db=wtb_app_staging&select=synovia_vehicle_mapping_temp&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=contractor_name&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=DBI&where%5B1%5D%5Bcol%5D=&where%5B1%5D%5Bop%5D=%21%3D&where%5B1%5D%5Bval%5D=&where%5B3%5D%5Bcol%5D=&where%5B3%5D%5Bop%5D=%3D&where%5B3%5D%5Bval%5D=&order%5B0%5D=vehicle_name&order%5B1%5D=&limit=500&text_length=100
And, I also used a soap utility tool to get XML response from Synovia API. These buses are missing in Synovia XML response as well.
'0568' is expected route number for 1753DB bus. And, bus_route_info table has '568' as route number, leading zero is missing here. It has to be same like '0649' previous record in sql result.

07-Jan-2019
-----------
WP-1049 - 3h
I am working on this.
I checked the daily events data for the buses.
Following buses don't have data in daily evetns tabls.
0557 = 1675
0566 = 1952
0569 = 1955
1762 = 803
Following two routes has data.
0561 = 1684/1685
	1684DB - No data in daily_events table and and no record in bus_route_info table.
	1685DB - Data available in daily_events table and has record in bus_route_info table without leading 0 in route column.
1731 = 1210/1533
	1210DB - Data available in daily_events table and has record in bus_route_info table.
	1533DB - No data in daily_events table and no record in bus_route_info table.

WP-963 - 4h
I worked on this.
Cleared partial db table that we got in last run in tiger2 server. Generated shell script there and verified to import the data.
Next, we can start importing the data in your off time.

WP-555 - 0h
This ticket is created for DBA suggestion. That is, the sql query should not be executed in loop instead it should be one single query to 
fetch the arrival results. His idea/suggestion is going to be implemented in WP-952.

08-Jan-2019
-----------
WP-963 - 6h
I worked on this.
Montana (MT) is setup in tiger2 aws server with 2015(default) tiger data. This is working fine.
I checked reverse geocoding for some locations in Montana state. It worked fine.
And, I also checked the existing tiger states(2013 data). It is working fine.
I checked reverse geocoding from php script(staging server), it is working fine.
[~shilpa_j], can you please confirm that tiger2 server continues working fine from your end.

WP-991 - 2h
I have just started looking into this.
I have never worked in automatic model stuff. I need to time to understand the functionality and implementations, they are required to address this issue.
Can I use the same dates given in ticekt description for checking in the production? Please provide date if I should I use different date.

09-Jan-2019
-----------
WP-991 - 7h
I am working on this.
Staging UI is not working like production as php7.1 fixes are not moved to staging.
 !screenshot-3.png|thumbnail! 
 !screenshot-4.png|thumbnail! 
Need to update staging code to fix errors and then, will find and pull required data from production db to test this in staging.
I am checking the required logic and functionalities.

WP-963 - 1h
Had discussion with Shilpa.

10-Jan-2019
------------
WP-963 - 6h
I worked on this ticket.
I worked on tiger1 server and I installed missing postgres tiger plugin and configured extensions.
I tested the setup with sample data. It is working fine.
I have generated shell script and verified to import the data. 
Next, we can import tiger data in tiger1 server in your off time.

WP-991 - 1.5h
I could not spend much time on this. I will look into this.

11-Jan-2019
------------
WP-963 - 6.5h

I worked on this.
Montana (MT) is setup in Tiger1 AWS server with 2015(default) tiger data. This is working fine.
I checked reverse geocoding for some of the locations in Montana state. It is working fine.
And, I also checked the existing states tiger data(2013). It is working fine.
I checked reverse geocoding from php script(app, php, staging & prepro), it is working fine.

WP-991 - 1.5h
I spend less time on this. I am working on this.
I addressed php7.1 upgrade errors for this module.
Need to find and setup the production data to test this.


16-Jan-2019
------------
WP-1063 - 8h
Driver images are saved in db tables on 10/11/2018 using a php script from WP-739. Images are saved correctly for given drivers with thier driver ids. No issues from this. 
 After that we did not run this script to save the driver images.
I can see driver images are getting updated from other two sources.
1. UI : https://www.wheresthebus.com/admin/employee_info.php?district=31
2. Employee import cron.
I am looking into this.
Found list of drivers having incorrect images(duplicate pictures) in produciton db table. And, those driver pictures are removed from db table. Hence incorrect pictures would not appear after next tablet sync. 
Next, I need to find any of these drivers having their picture in driver image folder.
If it is available, then I need to assign the picture to them in db table.

17-Jan-2019
-----------
WP-1063 - 6h
Yesterday, I set null values to both driver_image and image_modified_date db table columns for affected drivers. Today, I updated the image_modified_date with correct timestamp. 
I had a discussion with Shilpa on removing pictures for affected drivers from tablets. Setting null value in driver_image and updated value in image_modified_date, will not remove incorrect driver pictures from tablets during sync. So, we decided to set default driver picture in driver_image column and updated time value in image_modified_date, will help here. Default driver picture is an image shown on the tablet when no picture is assigned to the driver. 
I have modified driver_image & image_modified_date for this. And, checked with Prena, she confirmed default driver picture is displayed on the tables for the affected drivers.
And, also I checked the affected drivers have their pictures on the application server. Only one driver has image on the server. It is assigned to him in db. 
Driver details are given below.
stud_id : 230364
Last name : Hitch
First name : Leonard

WP-1065 - 1h
I spent sometime with Ramesh on this ticket.

WP-991 - 1h
I spent less time on this.

18-Jan-2019
------------
WP-991 - 7.30
I am looking into this.

I have identified the db tables used in here.
macro_models
routes
model_routes
settings
stops
daily_events
geozones
districts
admin_bus_units

I am checking the required logical parts and will copy the required production data.

21-Jan-2019
-----------
WP-1065 - 6h
I worked on this.
While updating a driver profile with different job description, driver image should not be updated when a driver do not have picture. This is addressed and update is available in staging.
I checked the functionality in staging. It is working fine.
@Susha, please test.

WP-991 - 1.5h
I could not spend much time on this today.
I am working on this.

22-Jan-2019
-----------
WP-1065 - 1h
This is promoted to PrePro. Suhas Shetty, please check.
Worked with Suhas on testing.

WP-991 - 6h
I am working on this.
I am checking this in staging. I tried seting the models for the AM for 11/13 and for the PM for 11/9. It sets the model.
http://staging.wheresthebus.com/admin/route_admin.php?&district=50 


23-Jan-2019
-----------
WP-991 - 5h
I worked on this.
I checked setting model dates multiple times in staging. It worked. Since, model date is setting in staging, I compared staging code for related files against to production code and there is no difference. 
Need to debug this in production. Please share the district and model date.

WP-1072 - 3h
I am looking into this.
I checked the logs. I don't find any errors / warnings over there.
Find what else contractors were not running at that time.


24-Jan-2019
-----------
WP-1065 - 3h
This is released to production. Suhas, please check.
I looked into the issue reported in production.
Editing a driver is not working correctly as expected in production. Since, this is working correctly in staging, there could be a environmental issue like permission. It might take sometime to find and fix. Hence, I reverted today's production release.
I have started looking into production issue.

WP-1074 - 5h
Add/remove zonar buses for contractors are handled in code. Since, we don't want these two zonar buses get imported, it needs to be handled in the code. 
The code update is done in staging and currently testing it. We can promote to production once it is fine there.
This needs to be handled in zonar asset mapping cron logic. It marks two buses as deleted, removes entries from vehicle_ids table, and also updates admin units table.
This cron uses 'deleted' column to mark it as removed. I think, manually_removed should be other purpose.
screenshot-3.png
I checked new update in staging. It is working fine.
Two buses do not appear in realtime page. And, also they also removed from vehicle_ids and admin units.
screenshot-1.png
screenshot-2.png
Since, we get District 55 buses from District 26, these two buses are there in District 26. Should we consider removing them from district 26 as well?

25-Jan-2019
-----------
WP-1074 - 1h
This is released to production. It is working fine.
Suhas Shetty, please check.

WP-1065 - 4h
I have fixed the production issue. 
It is promoted production.
[~suhas_s], please check.

WP-991 - 3h
I am working on this.
I am trying to debugging this in production. But, it sets the given model date for the district 50. Please check.


Duplicate url :
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=driver_details&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=rfid&columns%5B1%5D%5Bfun%5D=&columns%5B1%5D%5Bcol%5D=stud_id&columns%5B2%5D%5Bfun%5D=&columns%5B2%5D%5Bcol%5D=first_name&columns%5B3%5D%5Bfun%5D=&columns%5B3%5D%5Bcol%5D=last_name&columns%5B4%5D%5Bfun%5D=&columns%5B4%5D%5Bcol%5D=job_description&columns%5B5%5D%5Bfun%5D=&columns%5B5%5D%5Bcol%5D=driver_image&columns%5B6%5D%5Bfun%5D=&columns%5B6%5D%5Bcol%5D=image_modified_date&columns%5B7%5D%5Bfun%5D=&columns%5B7%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=driver_image&where%5B0%5D%5Bop%5D=LIKE+%25%25&where%5B0%5D%5Bval%5D=%25230364%25&where%5B2%5D%5Bcol%5D=&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=&order%5B0%5D=&limit=50&text_length=100

29-Jan-2019
-----------
WP-1065 - 0.5h
Today, I checked in production db. There is no duplicate driver images.

WP-1066 - 30m
I had a discussion with Prakash.

WP-991 - 6h 
I am working on this. 
This is not consistently working as expected. I am finding the root cause of this.

30-Jan-2019
-----------
WP-1066 - 7.5h
I am working on this.
#1. This is completed and available in prepro.
#2. This is in progress. In current report, X mark is being displayed when a driver submitted the Pre-Trip report whether it has any problem items or not. Now, we will show whole cell red with X mark when at least an item marked as a problem reports.
For example:
Bus:154, Driver ID 172776. Pre-Trip report is submitted with no problem. It remains as it is.
screenshot-1.png
Bus:182, Driver ID 163195. Pre-Trip report is submitted with an item marked as problem. This will be displayed as with red cell.
screenshot-2.png

WP-1065 - 0.5h
Today, I checked in production db. There is no duplicate driver images.

31-Jan-2019
-----------
WP-1065 - 0.5h
Today, I checked in production db. There is no duplicate driver images.

WP-1066 - 5h
I worked on this ticket.
#2 This is completed and it is implemented in export to excel as well. Please check.

WP-1081 - 2h
I have started looking into this.

02-Feb-2019
-----------
WP-1081 - 5h
I worked on this.
This is completed and update is available in staging. New bus appeares in realtime page and it also added to the admin unit. Please check.
Realtimepage :
Admin units:

WP-1084 - 3h
I am working on this.
I checked the import process. We can get back these buses. We need to set both manually_removed and inserted_vehicle_ids to 0 
and run the zonar import bus process.


04-Feb-2019
-----------
WP-1081 - 1.5h
This is promoted to Production.
New bus is added to production using zonar process. It is working fine.
Realtime:
screenshot-3.png
Scholl admin:
screenshot-4.png

WP-1084 - 1h
I checked the missing Durham buses in production. These buses are added back to the realtime page by zonar import process and they are added to Durham admin units as well. It is working fine.
Result of vehicle_mapping table (URL taken from task description)
Realtime page:
Admin unit:

WP-555 - 0h
This is same as WP-952. 
This ticket gives the idea/suggestion of DBA on school arrival query execution. And, it is being implemented in WP-952.
We can close this ticket.

WP-1066 - 4h
I am working on this ticket.
Currently, looking into #3.

05-Feb-2019
-----------
WP-1066 - 4h
I worked on this.
#3 is completed and availabe in prepro. Please check.

WP-1072 - 4h
I am looking into this issue.
I am trying to figure out what caused the issue and  it is little difficult to find as there are no errors, warning in the log.

06-Feb-2019
-----------
WP-1066 - 3h
I worked on this.
Yes, this can be done.  
I have added sorting to AM and PM columns and update is available in PrePro. Please check.

WP-1072 - 5h
I worked on this.
I could not find the issue from the past incident. Next, I need to enable additional log, that might help to find the issue.

ZONAR TO DO ::
- Add & in macroworker php file --
- Restart macroworker --
- Restart zonar process --
- Check &>> is there zonar log file from zonar process list --
- Understand flow and what exactly happens when 'wating for 30 seconds' message 
- Add required log to catch the issue
- Understand how the Gearman parallel processing works in zonar

07-Feb-2019
-----------
WP-1072 - 6h
I worked on this.
I checked the logical parts and added the required logging messages in production.
I believe this will help to identify the issue and fix when it happens in future.

WP-991 - 1.5h
I have started to look into this again.

08-Feb-2019
-----------
WP-1090 - 6h
I worked on this.
I checked the zonar import process. We are missing these buses in realtime page due to missing "-" fleet_number.
I ran the zonar import process manually and checked. But, these buses did not appear in realtime page.
Hence, I manually updated column (manually_removed, inserted_vehicle_ids) then, ran the zonar import process again. 
14 Out of 16 buses appear in realtime page as we receive fleet number with dash. 
Two fleet numbers "3161 152055" & "3171 152056" still don't have dash. So they two dont appear in realtime page.
manually_removed and inserted_vehicle_ids were set to 0 like we did earlier for district 31 - Durham.
We need to think of doing this in program if it happens frequently.

WP-991 - 3h
I am working on this. I could not spend much time.

11-Feb-2019
-----------
WP-1091 - 5h - 5.5h
Ryan Hill, I am working on the missing buses updates.
As a quick fix, I added all the buses of district 46 to Riteway admin unit of district 15. Now, all the buses from Milwaukee North & Oak Creek units are displayed in district 15 realtime page. I compared both are same.
District 15:
screenshot-1.png
District 46:
screenshot-2.png
I am working for new admin units update in district 15.
Update on bus admin units :
I have renamed district 15's "Riteway"  to "Riteway North" and mapped district 46's "Milwaukee North" buses to it. And, created new admin unit "Riteway Oak Creek" in district 15 and mapped "Oak Creek" buses from district 46. 
Updates are available in staging and checked it is working fine. We can promote to production once it is tested.

WP-1066 - 2h - 2.5h
I have started looking into the issues.

12-Feb-2019
-----------
WP-1066 - 5h - 6h
I worked on this.
#1. This is addressed.
#3. This is addressed.
Updates are available in PrePro.

WP-991 - 3h - 3h
I am looking into the issue.

13-Feb-2019
-----------
WP-1066 - 1.5h - 2h
Sushas, issue with Bus number filter is addressed. And, the fix is available in prepro. Please check.

WP-991 - 5h - 6h
I am working on this.
We have internal calls to some common functions which involves in model creations. There, it is not consistently working with www in url.
I am looking into issue.

19-Feb-2019
-----------
WP-1091 - 5h
Bus admin unit updates are done in production.
I have renamed district15's "Riteway" to "Riteway North" and mapped district 46's "Milwaukee North" buses to it. And, created new admin unit "Riteway Oak Creek" in district 15 and mapped "Oak Creek" buses from district 46.
I need to test the updates in production. I will update the ticket.
Prakash P, please do tablet updates in production.
I checked this in produciton. District 15 realtime page shows the buses correctly.
District 15 Realtime page:
screenshot-5.png
District 15 Riteway adminunit
screenshot-7.png
Worked on route assignment issue in production.

WP-1066 - 30m
This is promoted to production.
[~suhas_s]  please test.

WP-991 - 2.5h
I could not spend much time here.


20-Feb-2019
-----------
WP-1091 - 5h
I worked on route info issue.
I tried updating sql query. But, we are still missing some buses and data. So, I handled this issue in php code. In this new update, we are ignoring the duplicate buses with null value in login time.
Update is promoted to Production and PrePro. It is working file. Please check.

WP-1072 - 3h
I checked the logs. I could not see error message.
I am checking the log messages that we recently added.

21-Feb-2019
-----------
WP-1072 - 6h 
I checked log messages that we recently added.
Zonar process fetches the data for a time frame. If the time frame is less than 30 seconds, then it will get into a wait state for 30 seconds. Once the wait state is over, then it will start pulling the zonar data. This is the existing process and it is working correctly. 
Based on the log messages, it is stuck in wait state for some reason. Need to find what is causing issue during wait state.
I created a test script and ran it with wait state and I could not recreate the issue.

WP-1106 - 1h
I worked on this.
I have deleted following tables.

25-Feb-2019
-----------
WP-1106 - 2h
wtb_app_live::
user_child_buses_district40

wtb_vehicle::
daily_events_test_15
daily_events_test_16
daily_events_test_26
temp_geozones

wtb_staging::
admin_bus_units_res
bus_speed_debug
current_positions_res
school_tablet_events_dummy
tablet_events_dummy
synovia_vehicle_mapping_temp
vehicle_ids_res
vehicle_ids_test

truncate table emergency_events_test;
truncate table synovia_data_information_test;
truncate table zonar_data_information_test;

WP-1072 - 6h
I worked on this.
It is difficult to find the issue causing in the wait state from the current log. And, also could not able to reproduce it using test script.
I added php system error loging here. Hope this will help us to find the issue causing in the wait state.
Will look into the logs when zonar issue happens next time.


26-Feb-2019
-----------
WP-1115  - 4h - 5
I and Ramesh worked on this.
Ran the export_employee_scans cron for 2/22. and created Manatee Punch Filed. It is available in backup folder.
s3://wtbftpfiles/customerfiles/manatee/manatee/Backup/PUNCHED_TIME_22-Feb-2019.csv
PUNCHED_TIME_22-Feb-2019.csv
Verified employees check in & out data and they are correct.
Please check.

WP-146 - 3h -4
I worked into this ticket.
We fixed this issue in staging earlier. And, this is not currently working in staging as we are missing a db update.
I have done the db update again in staging. I checked and it is working fine now, we are able to add the deleted tablet in staging.
[~suhas_s] can do a round of testing.
This needs to be promoted to PrePro and Produciton at same time.

27-Feb-2019
-----------
WP-1118 - 4h 
I worked on this.

I checked the current logic used in the report.

We are considering the tablet messages received in heartbeat table between 12AM and 5AM with sequence number 1 or 2 to find realtime/delayed heartbeat. 
If the time difference between created_date and log_date is less 240 seconds, then it is considered as realtime heartbeats (Real-Time), 
else it is considered as delayed heartbeat(Delayed ). 
Other tablets are marked as no heartbeat (Not Received).

Sql query used to find realtime / delyaed heartbeat:
SELECT ti.tablet_info_id, ti.bus_number, thb.latitude, thb.longitude, 
CASE WHEN (UNIX_TIMESTAMP(thb.created_date) - UNIX_TIMESTAMP(thb.log_date)) < 240 THEN 'Realtime' ELSE 'Delayed' END AS heartbeat_status
FROM wtb_app_live.tablet_heart_beat thb
LEFT JOIN wtb_app_live.tablet_session ts ON thb.tablet_session_id = ts.id
LEFT JOIN wtb_app_live.tablet_info ti ON ti.tablet_info_id = ts.tablet_info_id 
WHERE ti.district_id = '15'
AND ti.bus_company_id = '2'
AND ti.is_deleted != 1
AND FROM_UNIXTIME(UNIX_TIMESTAMP(thb.log_date) + (-3600)) >= '2019-02-26 00:00:00'
AND FROM_UNIXTIME(UNIX_TIMESTAMP(thb.log_date) + (-3600)) <= '2019-02-26 05:00:00'
AND (thb.sequence_no = 1 OR thb.sequence_no = 2)
ORDER BY ti.tablet_info_id ASC, thb.sequence_no DESC

I dont know to find realtime/delayed/no hearbeat counts from tablet manager. Will dicuss.
screen shot

WP-1090 - 3h 
I checked for 2 other buses 3161 & 3171 those we are still missing in realtime page.
These buses are still missing dash in bus number from zonar api response.

WP-948 - 1h
I have looking into this.

28-Feb-2019
-----------
WP-1120 - 6h - 6.5
I worked on this.
Yesterday, synovia systems were down till 1.45pm. So, we did not get response from synovia.
Our application started collecting data automatically when synovia was up without restarting.
We did not get PM data for WC buses from Synovia. But, we get data for other contractors in daily_events table.
DB - 56,219 records
LN - 95,426 records
LS - 17,352 records
We have not received PM data for 2891WC bus. Last message received 2/27/2019 7:16:05 AM.
We will check today when buses are running.
We faced issue with Synovia GPS api service today as well. We had issue with both LBW & ICSB customers.
We are getting success message with no data in response.
<app screen shot>
I validated this from a third party utility (out of WTB application). We are getting same response.
<utility screen shot>
I checked synovia document, it says parameter 'Code = 1' means it is success and no data returned from synovia system.
<doc>
Synovia's vehilce asset api service is working fine. Looks like issue with GPS api service.
<asset>

WP-948 - 2h - 2.5
I spent less time on this.

01-Mar-2019
-----------
WP-1120 - 5h - 5.5
68B564C6-2322-41EC-808E-6306DCD83E85 is not API key, this is GUID represents customer account, this should be unique and not supposed to change.
This new GUID belongs to ICSB.
 !screenshot-6.png|thumbnail! <customer_new>
Still current GIUD works with ICSB.
 !screenshot-7.png|thumbnail! 
I checked vehicle asset of ICSB with new and current GUID. Both response are same.
New:
 !screenshot-8.png|thumbnail! 
Current:
 !screenshot-9.png|thumbnail! 
New GUIDs for ICSB is not pulling data from Synovia.
 !screenshot-10.png|thumbnail! 
I checked, customer GUID is used in synovia_vehicle_mapping and also in import table synovia_data_information.
If they confirm only new GUIDs will be used in future, then need to think about current data update in mapping table and work on it. I need to do this first in staging.  
Looks like, synovia is still working on their api services. I think, we can wait till synovia system becomes stable.

WP-948 - 3h - 3.5
I am working this.
I am checking the current implementation of this report and all school plan time report, so that I can rewrite the php logics.
I will work with DBA Karthi for sql updates

04-Mar-2019
-----------
WP-948 - 7h
I am working on this.
I need to discuss with DBA on SQL part, and also check with Ramesh on all school plan time report.
Just to confirm, we need to show the avg plan time of a school in table header instead of bell time correct?
Need to modify the structure as same route and bus number can be repeated in a table with different plan time.
I am working on updates.

05-Mar-2019
-----------
WP-948 - 7h
I am working on this.
I discussed wtih DBA. He is working on SP updates. I am working on php code assuming the SQL results.
I am working on rewriting logical parts.
I will work on export to excel once everything is done and tested.

06-Mar-2019
-----------
WP-1120 - 8h
I am working on this.
We are using wsdl file for calling api services, which Vijendra generated earlier. I discussed with Vijendra and requested for updated wsdl file. 
He has provided the updated wdsl file, I need to test this file from application.
Since we are going to use new api s0113 for gps data. This requires code change . I need to do this first in staging and test.
Need to check s0113 response with old s0105, need to handle that if there is different.
it will need addition code update in result parsing logic if it is different.
I worked on this.
I checked synovia old and new documentations for s0105 & s0113. It should work fine with s0113.
I checked the new wsdl file in utility and then from application. It is working fine.
I have done required code changes and moved to updates to staging. I ran the synovia import manually in staging as we dont have cron configurations for wtbuser.
I checked import is working fine in staging.
<screen shot>
I ran synovia vehicle asset import process in staging, I don't see any error/warnings, seems like it is works fine.
I tested in staging for gps data with new s0113 API. We are getting 01/01/2019 data from synovia when we request for latest data.
<screen shot>
Sometime, Synovia does not reply for LBW contractor.
<screen shot>
Note: I tried passing last id result of s0105 to s0113, it is pulling latest data in staging.
As discussed in skype, I have released the synovia update to production to use s0113 for GPS data collection. And, it will start collected data based on last id returned from s0105. 
I checked the update in production. It works fine. 
We are getting latest data for LBW contractor. But, synovia sends delayed gps data(3hrs) for ICSB contractor.

07-Mar-2019
-----------
WP-1120 - 9h
I am working on this.
I checked the new guid with utility, it is working.
<screen shot>
And, also verifed vehicle asset api response. It is working and matches with old guid.
<screen shot>
Guid is mapped in synovia vehilce mapping table for vehicle asset. Need to hadle them and test in staging.
Working on this in staging. Later, I will do the updates in production.
I have done requirest updates in staging. And, tested it worked fine.
I promoted the updates to production. Update is working fine. We are collecting gps data for ICSB with new guid. As of now, we are getting realtime data only for 2 WC buses. Need to monitor.
<screen shot>
As we discussed over skype, I added fleet guid parameter to s0113 only for ICSB contractor. The code updates are first done in staging and tested then promoted to 
production. Now, we are able to get the realtime data for ICSB contractor from Synovia.

08-Mar-2019
-----------
WP-1072 - 4h
I worked on this.
I checked the usual log files. I don't see any errors/warnings there.
Then, I tried to check the recently added log file(25/feb comment). But, this log file is missing in it location. I had the log file in below location.
/var/www/wheresthebus.com/logs/zonar_error.log
I had a discussion with Vijendra on this. This log file is deleted by the clean up job. I have given new location to this log file as per his suggestion.
/tmp_permanent/zonar_error.log

WP-948 - 4h
I spent some time on this report.
I received SP updates from DBA. I am working on this.

09-Mar-2019
-----------
WP-1126 - 8h
I worked on this and updates are available in staging.
Zonar for district 60 is set up in staging.
Fleet numbers are assigned to bus number those got GPS ids and single quote ' is removed from the bus number. please check zonar_vehicle_mapping table.
Please check bus table in staging realtime page. Please let me know if we want to filter any buses from zonar response. Bus icons will appear when we get GPS message.
screenshot-1.png
I have few questions.
What is the contractor name of this district?
    I have used SJ County for now.
    What is the admin unit name?
    I have used SJ County for now.
I tried running the zonar gps data manually for multiple time in staging. But, no GPS data response from zonar system for district 60 buses.

11-Mar-2019
-----------
WP-1126 - 4h
New update is done.
Zonar is set up for the new district 60 in production. I tested this in the production and it is working fine.
Realtime page:
screenshot-2.png
Current position:
Started pulling realtime data.
screenshot-3.png

WP-948 - 4h
I am working on this. 
I have integrated SP and working on report logic.

12-Mar-2019
-----------
WP-1134 - 5h
I worked on this.
I have done bus assignments in production as per Joe's instruction.
I was able to save the bus information using edit icon from Bus Manager in Realtime page. I updated a few buses using Bus Manager and other buses in Database.
screenshot-1.png
I ran the master icon cron manually after the updates as route number are updated.

WP-948 - 3h
I spent some time on this report.
I am working on this report.


13-Mar-2019
-----------
WP-948  - 7h
I worked on this.
I completed most of the functionalities. Need to work on average calculations and do some testing before passing it for Suhas testing.

14-Mar-2019
-----------
WP-948 - 7.5h
I worked on this.
I have completed the functionalities of the report. And, also finished the average calculations.
I faced some issues in report UI.
 !screenshot-12.png|thumbnail! 
And, I addressed them. 
 !screenshot-13.png|thumbnail! 
Updates are available in PrePro. Suhas can start testing this report except export to excel.
http://prepro.wheresthebus.com/admin/school_assigned_buses_arrival_report.php?district=24&school=97677&startDate=03%2F07%2F2019&endDate=03%2F13%2F2019&adminUnits=&day_part=AM&arrDept=45&action=Submit
Export to excel option is yet to be done. I will work on based on testing result.

15-Mar-2019
-----------
WP-948 - 7h
I worked on this.
I worked on an outstanding item export to excel. And, this is completed now.
Updates are available in PrePro.
[~suhas_s], please test the report in PrePro.

19-Mar-2019
-----------
WP-1136 - 6h
I worked on this.
I have created macro cron for district 60. I have the updates in my local.
We can promote this to production tomorrow and see how it runs in nightly cron.
And also, I checked the districts recently setup and missing macro cron. We don't have macro for district 59. Please confirm do we need to set up macro for district 59.

WP-1116 - 1h
Had discussion with Ramesh.
District 43 is a zonar district.
I checked zonar process. There is no logic to save route assignment value in 'route' column of daily_events_XX table. This is not implemented.

20-Mar-2019
-----------
WP-1136 - 3hrs
Macro setup for district 59 is done. Both district 59 and 60 updates are promoted to production. 

WP-1140 - 5h - no jira
I had a discussion with Shilpa. Below query is used in UDP to fetch the route number of a bus and then saves route number in daily_events table.
SELECT MobileID, BusNumber, route, district_id FROM vehicle_ids where non_udp_data = 0
I have started working on the updates required for zonar import process.

21-Mar-2019
-----------
WM-423 - 2h

WP-1140 - 6h
I worked on this.
I have completed the required updates in my local.
I will promote the updates to staging and check tomorrow.
Then, I will check and confirm the synovia part.

22-Mar-2019
-----------
WP-1140 - 7h - no jira
I worked on this.
I pushed the updates to staging and checked it for a few districts.
There was an issue with updating routes number for some buses. It is addressed. It is working fine.
 !screenshot-1.png|thumbnail! 
I checked the Synovia. It is not saving the route number like zonar.
We don't have route number in vehicle_ids table for Synovia buses.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=vehicle_ids&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=district_id&columns%5B01%5D%5Bfun%5D=&columns%5B01%5D%5Bcol%5D=BusNumber&columns%5B011%5D%5Bfun%5D=&columns%5B011%5D%5Bcol%5D=route&columns%5B0111%5D%5Bfun%5D=&columns%5B0111%5D%5Bcol%5D=assigned_route&columns%5B01111%5D%5Bfun%5D=&columns%5B01111%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=15&where%5B01%5D%5Bcol%5D=BusNumber&where%5B01%5D%5Bop%5D=LIKE+%25%25&where%5B01%5D%5Bval%5D=LN&where%5B1%5D%5Bcol%5D=&where%5B1%5D%5Bop%5D=%3D&where%5B1%5D%5Bval%5D=&order%5B0%5D=&limit=50&text_length=100
<screen shot>
I have a clarification. In realtime page, Synovia buses has multiple routes like MID IN, MID OUT, PM & AM. Will need to discuss on this.

25-Mar-2019
-----------
WP-1140 - 2h
I have promoted zonar route number updates to production. I tested it for district 31 and it is working fine.
I will observe it when district 43 buses are running.

WM-423 - 1.5h
KT on UDP

WP-991 - 4h 
I could not spend much time on this today as I had zonar release and UDP KT session.
Based on testing, It seems like it is not working correctly when the url points to app server.

WP-1090 - 30m
Created a new ticket WP-1149 Assigned to avoid manual work in the future.

WP-1072 - 30m
Restarted zonar.

26-Mar-2019
-----------
WP-1072 - 7h
I worked on this.
I checked regular logs and new log. No errors were found.
'First Student - Plymouth Meeting' zonar was crashed due to some error. We need error message to find what caused.
Error messages are not logged when a script runs as background process. Zonar is a background process which is always up and running for latest GPS message. 
I am working in staging to log the error message using a sample script.

27-Mar-2019
-----------
WP-1072 - 4h 
I am working on this ticket.
I am working in staging for erro logs. The errors are not getting logged.
I will discuss with Vijendra on this.

WP-1107 - 3h
I worked on this.
I checked, this is working as expected. 
We can close this ticket.

28-Mar-2019 
-----------
WP-1103 - 7h
I worked on this.
I have completed the updates required in Route Login by Contractor. And, it is available in prepro.
I am looking into MDT Student Report.

29-Mar-2019 
-----------
WP-1103 - 2h
I am working on this.
Required updates are completed in MDT Student Report and updates is available in prepro.

WP-1163 - 6h
I am working on this.
I will update before I leave for the day.

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/staging.zonar_assetmapping.log

01-Apr-2019 
-----------
WP-1163 - 2h
This is promoted to production.
I ran the zonar import process and tested. It is working fine.
Realtime page:
Admi  units:

WP-991 - 5.5h
I worked on this today
I checked model creation(UI) separately in both app and php servers with and without www in url.
> App Server : It is NOT working with www in url and it is working fine without www in url.
> PHP Server : It is NOT working in both the cases (www & 'no www').
I found, it is hard coded to use 'http' in coding, but we are supposed to use 'https' in production. I have addressed this issue in production. And, current status is,
> APP Server : It is working with www in url and NOT working without www in url.
> PHP Server : It is working fine in both the cases (www & 'no www').
Screen shots for working php server status:
WWW:
screenshot-8.png
screenshot-9.png
Without WWW:
screenshot-10.png
screenshot-11.png
Need to check why url without www, is not working in app server.

02-Apr-2019 
-----------
WP-1103 - 7.5h
I worked on this.
I have completed the requrired updates in MDT Student Summary report.
Below two MDT reports do not have bus company dropdown in report UI and also they are not working for district 46.
1. MDT Driver Login Summary Report
2. MDT Student Summary by Contractor Report
#1 I have updated report code and now it is working fine for district 46.
#2 I have started looking into this report.
Updates are available in prepro.

03-Apr-2019 
-----------
WP-1103 - 6h
I worked on this.
#2 I have completed the required updates here. Update is available in PrePro.
We have updated following MDT report.
1. Route Login by Contractor
2. MDT Student Report
3. MDT Student Summary
4. MDT Driver Login Summary Report
5. MDT Student Summary by Contractor Report
Suhas can start testing these report in PrePro.

WP-948 - 2h
I looked into the observations.
1. Bus numbers are not sorted in the right order
This is not an issue. Records are sorted based on average arrival column. This new individual schools arrival Report (Assigned Buses) is based on individual schools arrival Report.
http://prepro.wheresthebus.com/admin/school_arrival_report.php?district=24&school=274&startDate=02%2F04%2F2019&endDate=02%2F04%2F2019&adminUnits=&day_part=AM&arrDept=45&noOfVisits=0&action=Submit
2. School name is not being displayed in Excel
This is addressed. And also, we were missing school type (ES,HS,etc) in UI. This is also addressed.
3. In school_assigned_buses_arrival_report in excel the sheet & File name is being displayed as 'Arrival Time Performances'
Since this new report follows individual school arrival style, same name is used in excel. Now, I have changes the excel file name to "School Arrival Times Report".
Is the new file name okay? Please confirm.

04-Apr-2019 
-----------
WP-1168 - 5.5h 
I worked on this
Yesterday, I tried to setup this in staging after the call. Buses were not added to new admin unit and vehicle_ids table.
Today I checked the zonar import process. I have done required code update(config) in staging and ran the import process. Buses are added and appeared in realtime page.
This is done in production. I ran the import process. It is working fine.

WP-1149 - 3.5h
I have started looking into this.

05-Apr-2019 
-----------
WP-1149 - 7.5h
This is in progress.
I am working zonar import process logic update.

08-Apr-2019 
-----------
WP-991 - 7.5h
I worked on this.
I debugged in app server to find why this is not working without www for the app server. I could not find.
I have a suggestion, since it was working earlier (01/26 comments) in app server without wwww, we can use that only when it is app server and there is no www in url.
I have tried this. It worked well. I need to implement and test. 

09-Apr-2019 
-----------
WP-991 - 5.5h
I worked on this.

I implemented the fix. And, I tested this in app & php servers with & without www in urls. It is working fine all the cases. 
App server :
Php server :
Please check.

WP-1149 - 2h
I spent some time on this task.

10-Apr-2019 
-----------
WP-948 - 2h
I worked on this.
These changes are done in realtime page menu. And, also changed in admin's header reports page. 
Updates are available in prepro.

WP-1149 - 5.5h
I wokred on this.
I have updated zonar vehicle import process logic.
I need to run and check this in staging.

11-Apr-2019 
-----------
WP-948 - 2h
This is promoted to Production.
I checked both new individual school planned buses arrival and All Schools planned buses arrival reports are working.
Suhas Shetty, please test in production.

WP-1149 - 5.5h
I worked on this task.
I ran the zonar import process manually and tested the functionality in staging environment using test data.
It is working fine.

12-Apr-2019 
-----------
WP-1072 - 4h
I spend some time on this task. 
Working in staging, to capture the error message in log.

WP-1046 - 2h
I have just started looking into this.

WP-1149 - 1h 
Worked with Suhas on testing.

WP-1104 - 30m
Had discussion with Prakash and Naveen and explained the archiving process done for GPS data (daily_events_XX tables) and also described the folder/file structure. 

13-Apr-2019 
-----------
WP-1177 - 5.5h
I worked on this.
There was a restriction for version 2 messaging district to access new tablet data viwer. I have relaxed this for district 15. 
Now, new tablet viewer is accessible for district 15.
<screen shot>
You can directly use the new tablet datavier URL. Updates are in prepro.
Like tablet data viwer, we have new version of tablet heart beat page. Do you want to see District 15 in new tablet heart beat page?

WP-1072 - 1.5h
I spent less time on this ticket.
As we discussed, today i will work on this. And,  I will resume work once I am back next week.

15-Apr-2019 
-----------
WP-1177 - 4h
Like new tablet data viewer, we have new version of tablet heart beat page. It reads heartbeat message from tablet_events table.
I have updated new tablet heart beat page for district 15.
Update is available in prepro.
Suhas please test now.

WP-1104 - 30m
Had discussion with Naveen and explained the logical steps involved in GPS archiving script used for daily_events_xx.

WP-1046 - 3h
I am working on this.
I have taken a zonar api call.
https://joh1218.zonarsystems.net//interface.php?username=RLenz&password=trap123&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1555327478&endtime=1555327515
<json screen shot>
Replaced 'json' by 'csv' in url parameter and compared the output.
<csv screen shot>
We are missing following output values in csv when compared to json.
1.odometer
2.loadts
3.fuel_counter
4.status
5.accel
I am checking zonar documentation to get these misssing output values.

23-Apr-2019
-----------
WP-1149 - 2.5h
I ran the zonar cron manually and tested. It is working fine.
Bus numbers  3161FW & 3171FW were missing in realtime page because of dash in fleet number. Now, zonar send these two bus number with dash.
<screen shot>
And, these buses are now added to realtime page using zonar import cron and without any manualy work in db.
<screen shot>

WP-1103 - 1h
This is promoted to Production. This looks good.
Suhas Shetty, please test.

WP-1162 - 1h
I checked this zonar update in production. 
It is working fine. we can close the ticket.

WP-1046 - 2h
I spent some time here. I am working on this.

24-Apr-2019
-----------
WP-1046 - 6h
I am working on this.
I checked the zonar documentations regarding missing output values. Log version 3.7 supports missing response values except 'loadts'.
'loadts' value represent the time the gps message received in zonar system. This value is stored as 'Stamp' value of GPS message in our application. Zonar system api does not support 'loadts' value in CSV format. It supports only message time this is similar to UpdateTime in our application.
https://support.zonarsystems.net/hc/en-us/articles/360016205232-Export-a-Path
Since, we are missing 'loadts' in CSV format, shall we can consider the current time that we store the message in db like our GPS message?
CSV formate Heading & Reasons are need to be mapped to json as they are different.
screenshot-3.png
screenshot-4.png
And also, We have data structure in JSON format, we are receiving the events in a logical group. that is,all the events of a bus, are grouped under that bus. And, all the buses are grouped under assets. Zonar data processing logic is coded on this data structure.
screenshot-5.png
CSV doesn't support data structure. We need to modify the zonar processing logic for CSV format.

WP-1149 - 1hr
I checked this in production today. It is working correctly. We can close the ticket.

25-Apr-2019
-----------
WP-1189 - 7h
I am working on this new report.
I will work with DBA on sql queries.
I will discuss with Mobility team regarding sticker number.

26-Apr-2019
-----------
WP-1189 - 4h
I am working on this.
I discussed wtih DBA Naveen on sql queries and provided him the details. He will work on that.
I discuss with Prena and Kathika regarding sticker number. We have clarification. 
Does the sticker number need to be stored to db from php UI or from mobility api?
I have created new report page with data available.
http://prepro.wheresthebus.com/admin/school_tablet_status_report.php?district=31

WP-1188 - 3.5h
I have started looking into this.
I have a clarification. In data viewer page, user selected date in UI, is compared against 'UpdateTime' column of daily_events table. In given sql queries, I can see the user selected date is compared against 'stamp' column. Please confirm.

1. school_tablet_info
2. geozones
3. school_tablet_events_31
4. school_tablet_session

02-May-2019
-----------
WP-1177 - 4.5h
I worked on this.
Old heartbeat page:
I checked this for given URL. This is working correctly. It is pointing Milwaukee state. 
https://wheresthebus.com/admin/tablet_heartbeat.php?bus_company=2&date=04/29/2019&district=15
<screen shot>
I also checked this for today's date. I am not able to reproduce this.
<screen shot>
New heartbeat page:
This is pointing to ocean. I checked the db data. we have zeors in lat & long for heartbeat events, that why it is pointing to ocean.
SQL query for given day:
SELECT ti.tablet_info_id, te.bus_number, te.latitude, te.longitude, 
CASE WHEN (UNIX_TIMESTAMP(te.created_on) - UNIX_TIMESTAMP(te.log_date)) < 240 THEN 'Realtime' ELSE 'Delayed' END AS heartbeat_status
             FROM wtb_app_live.tablet_events_15 te 
            LEFT JOIN wtb_app_live.tablet_info ti ON ti.tablet_info_id = te.tablet_info_id
            WHERE ti.is_deleted != 1 AND ti.bus_company_id = 2 AND te.event_code = 2    
            AND DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(te.log_date) + (-3600))) = '2019-04-29' 
            ORDER BY te.bus_number asc
<screen shot>			
Check for a bus 100. It has zero in lat & lng for all the days.
<screen shot>

WP-1195 - 3.5h
I am working on this.
This needs to be handled in Add/Edit tablet page as well.

03-May-2019
-----------
WP-1177 - 1h
tablet_heartbeat.php update is promoted to production. I checked this in produciton and it is working fine.
<screen shot>
Ealier, we worked on two file new tablet data viewer and new tablet heart beat for district 15. 
New tablet data viewer update was promoted to production while promoting WP-1179 by Swarnim.
New tablet heart beat is left, so I promoted this file today.
<screen shot>

WP-1195 - 5h
I worked on this. 
Tablet manager updates are completed and available in prepro.
I checked add/edit tablet page. I need to discuss this with Ramesh as he worked on WP-956.

WP-1190 - 2h
I checked this issue. Synovia is working correctly.
Synovia API system was down on 04/27 early monring. So, we got notification emails during that time as there is no data feed. 
And, Synovia API was up from 7.30AM eastern time.
We can ignore this issue.

06-May-2019
-----------
WP-991 - 0h
I checked this updates. It is already released to production. Please check comments 04/09.
This issue is debugged and fixed in production.

WP-1195 - 6.5h
I worked on this.
Filter issue after editing a record, is addressed.
<screen shot>
In edit tablet page, it shows all the bus comapanies, instead of show only Riteway bus companies. I am working on this.
<screen shot>

WP-1189 - 1h
Today, DBA Naveen is off. I am working on UI updates.

07-May-2019
-----------
WP-1195 - 7.5h
This is promoted to PrePro an Production. I tested once it is working fine.
Suhas Shetty, please check.
I am looking into the issue.
We have handled in Tablet manager, Add/Edit tablet pages. 
Need to work for Data Viewer and Heart Beat pages. I will work on these pages as well. 
I addressed the filter issue with deleting a tablet.
<screen shot>
I worked on tablet data viewer and tablet heartbeat pages for district 46 updates. This is completed.
<screen shot>
<screen shot>
Updates are in Staging and PrePro.
@suhas, please check.

08-May-2019
-----------
WP-1195 - 30m
This is released to produciton.

WP-1189 - 7h
I worked on this report.
I have updated the new report like other reports.
http://prepro.wheresthebus.com/admin/school_tablet_status_report.php?district=31
I have added date filters for 'Last Report Date', 'Last Attendant Scan' and 'Last Manual Entry' in UI. These filter will be functional once DBA Naveen provide sql. I need to add check box filter for sticket number filter to report on tablets that have sticker numbers
I worked with DBA.
DBA Naveen update:
DBA has finished the SQL query and he needs to test it. After that, it can be integrated with php script. He has added sticker_number column to school_tablet_info table in local db.

09-May-2019
-----------
WP-1189 - 6.5h
I worked on this task.
I have completed the php work required for the report.
I received sql query from DBA Naveen. And, I integrated the query to the report in local. And, I identified some updates required in sql.  I discussed with DBA Naveen on that. He will give updated query by tomorrow.
I have updated sticker numbers in staging db. Tablet's imei matching with excel are updated in staging db.
I need to check with @Prena to ensure sticket number is not causing any issues in school tablet functionality.

WP-1072 - 1h
I looked into this.
Zonar import was down. I restarted zonar process. It is working fine now.
I checked the logs, no error message found.
Need to think through what next can be done here.

10-May-2019
-----------
WP-1188 - 4.5h
I am working on this.
I worked on sql queries. I have updated 'b' & 'c' queryies. I need DBA help to work on 'a' query.
Updated queries 'b':
SELECT SequenceNumber,Latitude, Longitude
FROM `daily_events_59` 
WHERE BusNumber = '81' AND UpdateTime BETWEEN UNIX_TIMESTAMP('2019-04-22 00:00:00') AND UNIX_TIMESTAMP('2019-04-23 23:59:59') 
AND (UNIX_TIMESTAMP(stamp) - UpdateTime) > 60
Updated queries 'c':
SELECT SequenceNumber, Latitude, Longitude
FROM `daily_events_59` 
WHERE BusNumber = '81' AND UpdateTime BETWEEN UNIX_TIMESTAMP('2019-04-22 00:00:00') AND UNIX_TIMESTAMP('2019-04-23 23:59:59') and EventCode = 33
I have started looking into the new page like data viewer.

WP-1189 - 3h
I worked on this.
I checked with Prena. School tablet app is working fine after adding sticker number value.
I worked with DBA and got the updated sql query. I have integrated it to the php code. Update is available in staging. 
We need to add sticker number to produciton db and assign the values for testing the report in PrePro. Please confirm.
Next, I need to work on export to excel.

13-May-2019
-----------
WP-1189 - 3.5h
I worked on this today.
I added sticker number to production db. And, I assigned sticker number values from excel.
District 31 has 180 school tablets production and 131 tablet's imei numbers matching with excel, got sticker number values in production db.
I have promoted latest sql changes to prepro environment and did some testing from my end. Data looks good.
 !screenshot-2.png|thumbnail! 
Export to excel is outstanding one.
Where this new report would be linked fro navigation?

I checked 25 missing assignments. Last digit of imei_number is truncated for these tablet in spreadsheet. I am using WPS Spreadsheet.
<screen shot>

WP-1188 - 4h
I worked on this.
I had discussed with DBA Karthick regarding 'a' query. He will look into that. And, he will also check 'b' & 'c' queries against big districts. 
I am working new page functionality.

14-May-2019
-----------
WP-1188 - 2h
I had discussion with DBA Karthi. 
Current 'a' query gives duplication in resultset. Please check sequence number 1085.
<screen shot>
Dataviewer:
<screen shot>
Which record should be fetched from db? 

I worked with DBA Karthik.
Update from DBA Karthik:
Query is tuned,now the results are returned in less than Milli seconds from 10minutes earlier. In case of duplicate sequence number the query will return the first record based on the id, irrespective of latitude and longitude.
For example : consider we have duplicate sequence number with different latitude and longitude as below
id seqno latitude longitude
91 101 373967316 -791711180
92 101 373967317 -791711182
93 101 373967318 -791711182
94 104 373967319 -791711183
In this case query will return the first record, (91 101 373967316 -791711180)
is this fine Ryan Hill ?

WP-1189 - 6h
I worked on this.
I have assigned sticker numbers for above 25 tablets in production db.
District 31 has got totally 180 tablets. In that, 17 were deleted and we have 163 tablets active.
We have assigned sticker for 156 tablets so for. 5 are in deleted state, so we have 151 active tablets with sticker number.
 !screenshot-4.png|thumbnail! 
I worked on sql query to find the missing tablets. We were missing around 20 tablets those never sent event code 9 / event code 12 / no last report. This is because of filter values in sql. I have corrected it as we discussed over skype. Now, those missing tablet are reported with empty value in datetime columns. Now, it is reporting all 151 tablets.
 !screenshot-5.png|thumbnail! 
I have also added to show number of records at bottom of table.
This new report is linking to MDT REPORTS section of reports page. The Attendant Log and Route Based Attendance reports are shown to the districts enabled with 'Has School Tablets' option and also show to school realtime users. Same conditions are applied to this new report.

15-May-2019
-----------
WP-1189 - 6h
I am working on this.
I noticed there is slowness in sql execution. That leads page loading performance. We can have DBA to take another look to optimize the query.
<screen shot>
We can pass it for Suhas testing after query optimization.
I am working export to excel functionality.
I worked on export to excel. It is completed and available in PrePro.

WP-1188 - 2h
I spent some time on this task.
DBA Karthik has rewritten the query 'a'. I received the query.
SELECT SequenceNumber,Latitude,Longitude
   FROM ( 
SELECT B.SequenceNumber,B.Latitude,B.Longitude,replace(if(@tmp =-1, 0, @tmp-B.SequenceNumber),'-','') difference,@tmp:=B.SequenceNumber as dummy 
  FROM daily_events_59 B,(SELECT @tmp := -1) a 
 WHERE B.BusNumber = '81' 
   AND UpdateTime BETWEEN UNIX_TIMESTAMP('2019-04-22 00:00:00') AND UNIX_TIMESTAMP('2019-04-22 23:59:59') 
ORDER BY B.sequenceNumber desc,id asc
    ) seq
   WHERE difference >2
order by 1 ;
screenshot-3.png
I need to integrate 'a', 'b' & 'c' queries in php script.
I will continue working on functionality.

16-May-2019
-----------
WP-1188 - 8h
I worked on this.
I have integrated queries to php script.
I have completed the page functionalities. 
http://prepro.wheresthebus.com/admin/network_coverage_issues.php?bus=81&date=04/22/2019&district=59
I have plotted red bubbles on the map like tablet hearbeat. I need to check the red circle icon in new bus realtime page then I will implement here. 
Updates are available in PrePro.

20-May-2019
-----------
WP-1188 - 7.5h
I am working on this.
I have added all buses option and a,b & c filters to UI. I need to implement them in sql and php logic. I am working on this.
'b' = Yes we can have 60 seconds as parameter to be changed.
screenshot-6.png
Just to confirm, we have show results of a query only when its filter is selected in UI. Eg. We will show 'a' & 'b' queries results when 'a' & 'b' filter are checked.
I will work on red circle implementation after the functional updates.

21-May-2019
-----------
WP-1213 - 8h
I worked on this.
As we discussed, 1775LN bus is manually added to production db . And, now it appear in realtime page.
<screen shot>
we have two different issue here. And, these issue were there for long time (based on svn log).
1. Missing new buses.
2. Removing existing bus when it is no longer available.
#1 is completed and buses are correctly recorded in below tables. Update is available in staging.
vehicle_ids
synovia_vehicle_mapping
admin_bus_units
current_positions
#2 I need work on cron logic to automat this.

22-May-2019
-----------
WP-1213 - 7hr
I worked on this.
#2 This is completed and updated the cron logic. I ran the synovia import cron manually in staging. It is working fine. Please check.
Another example, issue with 9191 like 1775. Earlier, it was with DBI and now, it is moved to Lakeside North. GPS ID 4842023639.
I looked into 1200 bus missig issue. It is assigned to Lankeside North and appears in realtime page. Seems like, it is resolved.
<screen shot>

WP-1189 - 1hr
I received the tuned sql query from DBA Naveen. I am working on integration.
It needs index creation in production db, that I will do tomorrow morning.
I have integrated optimized query and promoted to prepro.
Next, I will create index in production db tomorrow, then Suhas can test.

23-May-2019
-----------
WP-1189 - 30m
Required indexes are created in production db.
Suhas Shetty, please check the performance and do a round of testing.

WP-1213 - 7h
I updated nightly cron in production with new updates.
I checked the cron results. Missing buses ares added.
eg.9191
screenshot-6.png
eg 1200
screenshot-7.png
I observed another issue. When they update gps_id for a vehicle, it needs to be updated in our system.
For eg, vehicle_name 1554-LBWN, gps id is updated. It's new gps id is 4842039702.
screenshot-8.png
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=synovia_vehicle_mapping_temp&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B1%5D%5Bcol%5D=mobile_id&where%5B1%5D%5Bop%5D=%3D&where%5B1%5D%5Bval%5D=963C548F-640D-4DC8-8E94-E7D242EE3C03&where%5B11%5D%5Bcol%5D=&where%5B11%5D%5Bop%5D=%3D&where%5B11%5D%5Bval%5D=&order%5B0%5D=&limit=50&text_length=100
But, still our system is using old gps id.
screenshot-9.png
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=synovia_vehicle_mapping&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=mobile_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=963C548F-640D-4DC8-8E94-E7D242EE3C03&where%5B2%5D%5Bcol%5D=&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=&order%5B0%5D=&limit=50&text_length=100
I checked the cron, the logic to update gps id, is not in place. We need to implement this.
I will work in staging.
Yes. We need to fix #1 & #2 issues. And, #3 will be resolved once #1 is fixed.
I worked on this ticket.
#1 I have addressed this issue. Now, gps_id will be correctly when it is updated on synovia.
 !screenshot-14.png|thumbnail! 
#2 I have started looking into this.
#3 this is resolved after fixing #1.
 !screenshot-15.png|thumbnail! 
Updates are there in staging.

24-May-2019
-----------
WP-1213 - 4h
I am working on this.
#1 I have promoted this to production. And, tested the cron results. It is wokring fine. GPS id gets correctly updated and #3 is resolved.
vehicle table:
screenshot-16.png
mapping table:
screenshot-17.png
#2 I am working on this.

#2 I have completed this. I ran the cron in staging. It is working fine.
url
screenshot

/usr/bin/php /var/www/wheresthebus.com/code/scripts/run.php synovia_asset_mapping &>> /var/www/wheresthebus.com/logs/synovia_mapping_27May2019.txt

27-May-2019
-----------
WP-1213 - 1.5h
#2 is released to production.
I test and update the ticket.
I tested this. This is working fine.
screenshot-19.png

WP-1189 - 1.5h
This is released to production.
I will do some testing and update the ticket.
I have tested this. It is working fine in production. It takes around 2 seconds to load the page.
screenshot-8.png

WP-1188 - 5h
I am working on this.
I created a form and added submit button. I changed bus hyper link to bus dropdown. Bus dropdown list will be changed dynamically without page reloading when the district is in dropdown.
Need to work on query changes for new filters (parameters).

28-May-2019
-----------
WP-1213 - 4h
I worked on this.
I checked the cron results and found an observations. #2 fix did not work well. 
Below two DBI buses are assigned with bus number buses based on vehicle_name(gps_id). It is supposed to be null. 
<screen shot>
This is addressed.
<screen shot>

WP-1188 - 4h
I worked on this.
I have implemented new filters. And, it is working fine. Update is available in Prepro.
Need to work on 'All' bus features. I need to update the sql and php script as well.

29-May-2019
-----------
WP-1213 - 2h
I checked the cron today. Cron ran correctly. 
I checked the corn results. It is working fine. #1, #2, #3 issues are not happening.

WP-1188 - 5.5h - karthi - 1 h
I am working on this.
I have implemented 'All' bus option for 'Stamp vs Update' and 'Comm Regain Messages' options.
screenshot-8.png
We have optimized query for 'Consecutive Missing Messages' done by DBA Karthik. This sql needs to be modified for 'All' option. I updated the query, it is not giving correct result, I discussed with Karthik and he is looking into that.
I have started looking into implementing red dot instead of pin.
Yes, we can show three different colors. Please update the colors that we want to show for each of the message types.
a = Consecutive Missing Messages
b = Stamp vs Update > 60 Sec
c = Comm Regain Messages

30-May-2019
-----------
WP-1213 - 1.5h
I checked the cron today. It is working fine.

WP-1188 - 7h
I worked on this.
I received updated query for 'Consecutive Missing Messages' from DBA and integrated into php script.
I replaced pin icon by dot icons.
I implemeted red, blue and green icons for a, b & c respectively.
Updates are in prepro. Please check.

31-May-2019
-----------
WP-1213 - 1h
I checked the cron today. It is working fine.
We can close this.

WP-1188 - 5h
I worked on this.
We have outstanding issue in validations like,
1. Grey out 'Sec' input when 'Stamp vs Update' option is unchecked.
2. At least one check box option need to selected while submitting.
3. Future date should not be selected in date selection.
They are addressed and updates are available in Prepro.
Question:
Where the new page would be linked for navigation?

WP-1219 - 1.5h
I have started looking into it.
Will discuss in the call.

03-Jun-2019
-----------
WP-1219 - 7.5h
I worked on this.
This is completed and update is available in prepro.
For old assignments, ie MDT assignment not present in tablet info table, MDT data will be directly fetched from the tablet_event_XX table. I have updated the logic of tablet data viewer page.

WP-1226 - 2.5h
I worked on this.
New district 62 is setup in staging.
screenshot-1.png
In staging, realtime page is broken due to some other code updates. It will work fine in production.
We can promote this to production tomorrow.

04-Jun-2019
-----------
WP-1226 - 1h
This is promoted to Production. And, it is working fine.
screenshot-2.png
UDP server and workers were restarted by Karthika

WP-1229 - 5h
I worked on this.
I have setup macro cron for district 61.
As you are asking, macro cron to be part of new district setup, I have setup macro cron for district 62 as well which we released today WP-1226 Done .
Updates are promoted to production.
screenshot-1.png

WP-1188 - 2h
I looked into the issues.
UI shows data for one day ie 04/22 which is correct, but sql queries are framed to fetch data for two days 04/22 & 04/23. Sql need to be framed only for 04/22. Updated sql results.
Stamp Vs Update:
 !screenshot-11.png|thumbnail! 
Comm Regain:
 !screenshot-12.png|thumbnail! 
[~suhas_s], please check.

Note :
Usually, our practice is,
1. We first set up the district in the production.
2. Then, we will add buses to the district.
3. Finally, we will setup macro cron for the district if it is required.

05-Jun-2019
-----------
WP-1219 - 30m
This is promoted to production and working fine.
Suhas Shetty, please check.

WP-1227 - 7h
I am working on this.
I have completed fetching zonar asset. Update is available in staging.
"Cecil County" is used as contractor name. Fleet numbers are assigned to bus_numbers for those vehicles got gps_id. 185 zonar buses are assigned with bus numbers for district 62.
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.181&username=wtbuser&db=wtb_app_staging&select=zonar_vehicle_mapping&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=62&where%5B1%5D%5Bcol%5D=gps_id&where%5B1%5D%5Bop%5D=%21%3D&where%5B1%5D%5Bval%5D=&where%5B3%5D%5Bcol%5D=&where%5B3%5D%5Bop%5D=%3D&where%5B3%5D%5Bval%5D=&order%5B0%5D=&limit=500&text_length=100
We have different locations.
screenshot-1.png
Please confirm,
1. Vehicle locations we need to save?
2. Admin units that need to be mapped for locations?
I am working for gps data download in staging. I will update the ticket later.
I have completed gps data import in staging.
New admin units are created based on location and are mapped in zonar asset import cron.
Updates are in staging and working fine. Please check.

06-Jun-2019
-----------
WP-1227 - 4h
This is promoted to produciton.
I will test and update the status.
I checked this, it is working fine.
185 vehicles got gps ids and are assigned with bus numbers.
 !screenshot-2.png|thumbnail! 
Realtime page:
 !screenshot-4.png|thumbnail! 
Bus icons will be plotted on the map once we get the gps message from zonar. I checked bus icons are created.

WP-1188 - 2h
I worked on this.
"Hardware" group is created and "Cell Coverage Issues" is added to that group. Update is available in PrePro. Please check.

WP-1072 - 2h
I have just started looking into automation.

07-Jun-2019
-----------
WP-1072 - 7h - no jira
This is in progress. Working on automation script.

10-Jun-2019
-----------
WP-1188 - 30m
This is promoted to production. It is working fine.
Suhas Shetty, please check.

WP-1072 - 7.30h - no jira
I am working on this.
I was facing little difficulty in finding the status of contractors whether up or down. I got the solution and started working on automation script.

11-Jun-2019
-----------
WP-1072 - 8h
I worked on this.
I have completed the automation script. 
Testing in staging, is in progress.

12-Jun-2019
-----------
WP-1238 - 6h
I worked on this.
I checked the cron logic and added requried the debugging message.
And, I ran the cron manuaully and checked the cron results. We are getting expected results as given in the task description.
vehicle_odometer table:
My debugging did not change the cron logic and functionalities.
I will check the bus manager rounding.

WP-1072 - 1.5h - no jira
I am working on testing. I will update later.
This is working fine.
I will work with [~suhas_s] on testing in staging.

13-Jun-2019
-----------
WP-1238 - 1.5h
I checked today's cron results. It ran as expected and results are fine.
screenshot-3.png
I checked the debugging log as well and there is no issues.
I have not checked bus manager logic for rounding.

WP-1231 - 6h
I am working the report updates. This is in progress.

14-Jun-2019
-----------
WP-1238 - 6.5h
I checked today's cron results.
We are getting expected result for bus 'TB07'. But, result of 'TB10' is not correct.
Today cron result :
<vehicle_odometer screen shot>
Expected result is 33758594 meters. Just, 7 meters only added to last value from vehicle_odometer. 
I looked into the debugging logs which we enabled recently. Cron is scheduled to start at 3.30AM EDT and ran for 39 mins
<status test screen shot>
District 61 was processed at 04:07:36 AM today morning. 
We received 'Going To Sleep' with 7 meters at 4:05:48 AM.
<data viewer screen shot>
Hence, this meters is considered as last message of the day and 7 meters added to last value of vehicle_odometer.
Need to update the sql to consider the last message of previous day to find the distance covered. Currently, it just consideres last message.
Replying your quesetions:
#1 It adds 0 meters to vehicle_odometer table value.
#2 It adds meter value of last message (event code 19 - Going to sleep) to vehicle_odometer table value.
#3 It picks the last message of the bus(last driven day).

WP-1072 - 1h
Worked on with Suhas on testing in staging.

18-Jun-2019
-----------
WP-1238 - 4.5h
I am working on this.
I checked the logs for 14th, 15th & 16th June, odometer data was processed after 4AM EDT for district 61. 
This is the issue. And, also it took Friday(6/14) miles on Sunday(6/16) when Saturay(6/15) had just heart beat message with 0 Meters.
And also found that current sql uses daily_events table's id column to sort and pick the last message instead of using UpdateTime column.
Above two issues are addressed in the new fix. Now, cron will takes last message of previous day based on UpdateTime value and ordering. 
I tested this in local, it is working fine.
I had a discussed with DBA Naveena on optimization. He will work on that.
@Ryan, shall we promote new fix to Production or we can wait for Naveena to complete tuning?

WP-1072 - 3.5h
I have promoted this to production.
I have tested the automated script in off business hours. It worked fine.
And also, tested this while buses are running, it is working fine.

19-Jun-2019
-----------
WP-1072 - 1h
I checked this. It is working fine.

WP-1238 - 6.5h
This is NOT promoted to Production today.
I found an issue in calculating odometer value for the buses that did not drive for the day. So, I did not release it today.
I am working with DBA Naveena on this.
I worked with DBA and got modified query. Tested the sql query in staging db. It worked fine.
I have integrated updated sql query to the application. It is working fine.
Had discussion with DBA Naveena on query optimization. He is working on that.
This is promoted to Production. 
I have taken back of the odometer table.
Will check cron results tomorrow.

20-Jun-2019
-----------
WP-1238 - 6h
I am working on this.
I checked the cron results today. It is working fine.
There is minor difference between expected and cron result. I think, this is because the actual odometer(in morning) taken from the bus manager 
which is round value and cron does the calculation in meters and updates the vehicle_odometer table.
I have received optimized query from DBA. I will look into this.
I worked on this.
I checked the SP provided by Naveena. 
I tested the SP in staging. It is working fine. I have integrated into the application.
We can pass it for Suhas testing.

WP-1072 - 30m
I checked this. It is working fine.

WP-1231 - 1h
I could not spend much time here. I will work on this tomorrow.

21-Jun-2019
-----------
WP-1238 - 3.5h
I worked with Suhas on testing in staging. Helped testing in setting up required data and running cron manully with new and old queries and checking the logs.

WP-1231 - 3.5h
I worked on this.
This is completed and update is available in PrePro.
<screen shot1>
<screen shot2>

WP-1072 - 0.5h
I checked this. It is working fine.

24-Jun-2019
-----------
WP-1238 - 5h
Today, odometer cron took more than 2 hours to complete with new sql updates. 
I checked the cron log. Some district are completed quickly and some districts took more than 15 mins. I had discussion with DBA Naveena. He will look into that.
I worked with Suhas on testing.

WP-1234 - 2.5h
I have started looking into it.

25-Jun-2019
-----------
WP-1231 - 30m
This is promoted to Production and update is working fine.
Suhas Shetty, please check.

WM-492 - 30m - no jira
Testing zonar & synovia.

WP-1238 - 4h
I worked on this.
I integrated sql fix and promoted to staging. 
Worked with Suhas on testing the fix in testing and we found there is an issue in updating odometer value. I discussed with DBA Naveena and he is looking into that.

WP-1234 - 1h
I could not spend much time on this.
I am working on this.

26-Jun-2019
-----------
WP-1238 - 1.5h
I received latest sql from DBA Naveena and integrated to application.
Worked with Suhas on testing - setting up the requied data and running the cron in staging.
Performance fixes are promoted to Production.
I have taken a backup of odometer table for safer side.

WP-1234 - 6h
I am working on this ticket.
I will implement this new page inside bus manager popup. We will make it separate tab if we get any complexity.
<screen shot>
I am working on page UI.

27-Jun-2019
-----------
WP-1234 - 4h
I am working on this.
Worked on Add Bus UI. 
<screen shot>
Working on showint the buses in Delete Bus section.

WP-1253 - 3h
I worked on this.
New district is setup and promoted to staging. All the geozones of district 22 are copied to new district 63.
<screen shot>
We can promote this update to production tomorrow.
Need to setup the macro group for this new district. I will work on this tomorrow.

28-Jun-2019
-----------
WP-1253 - 1h
New district setup is done in Production. All the geozones of district 22 are copied to this new district. It is working fine.
screenshot-2.png
screenshot-3.png
Macro cron is not set up for this new district.

WP-1234 - 7h
I am working on this.

Worked on delete section UI and completed listing buses.
<screen shot>

02-Jul-2019
-----------
WP-1238 - 4h
I worked on this.
I checked for the processes using vehicle_odometer table in our application. Only bus manager can update the vehicle_odometer table and no other processes update odometer values.

WP-1234 - 3h
I am working on this.
Started working on implementing functionalities.

03-Jul-2019
-----------
WP-1238 - 3h
I checked the logs. It looks good.
We are using Stored Procedure in the cron to calculate and update the odometer values. That can not be logged from php.
I had a discussion with Naveen and he is looking into logging odometer the value.

WP-1234 - 4h
I have promoted the UI changes(except delete popup) to staging.
 !screenshot-5.png|thumbnail! 
I am working on add bus functionality.
Outstanding :
1. Delete Bus popup & functionality.
2. Add bus validations.
3. Export to excel functionality.


04-Jul-2019
-----------
WP-1234 - 6h
I am working on this.
I completed add bus functionality. Update is available in staging. Showing success messaage UI can be improved.
Started only on delete bus functionality.

WP-1238 - 1h
I had a discussion with Naveen. He has updated Stored Procedure in staging to return the old odometer values. I need to check this from php end to log. 

05-Jul-2019
-----------
WM-449 - 4h
Worked on this.
Today db activity statistics.
<excel>
I paused the crons after macro cron group and rerun crons after db activities are completed.

WP-1234 - 4h
I am working on this.
Completed delete popup and functionality.
Added progress popup message UI for add and deleted operations. Update are available in staging.
 !screenshot-6.png|thumbnail! 
 !screenshot-7.png|thumbnail! 
Need to insert into vehicle_id_logs table on add & delete operations. I will check with Ramesh.


09-Jul-2019
-----------
WP-1238 - 4h
I have updated php code to log the old odometer values returned by Stored Procedure. DBA Naveena has not done any other functional changes in stored procedure.
Copied production data (07/08) to staging and tested the cron in staging. It ran well and logged old odometer values. 
I will promote this update to production today.

WP-1234 - 4h
I am working on this.
Issue with delete a bus with no GPS, is addressed. Fix is available in staging.
I am working on validation.

10-Jul-2019
-----------
WP-1238 - 1h
I checked the new logs in production. 
We are logging the old odometer value returned by SP. I feel like having the new odometer value in logging, would help in debugging.
I have asked DBA Naveena to return the updated odometer value as well. He will look into that. 

WP-1234 - 6h
I am working on this.
Completed add bus validations.
Added logic to log add & delete bus operations to vehicle_id_logs tables. Had discussion with Ramesh.
Updates are available in staging.
Working on some alignment issues. I will pass it to Suhas for testing once it is done.
Only export to excel is outstanding.

11-Jul-2019
-----------
WP-1234 - 5h
I worked on this.
Addressed alignments issues.
Completed export to excel functionality.
Updates are available in staging.

WP-1262 - 3h
I worked on this.
I have created new district. It is available in staging. We can promote this to production tomorrow.
I will work on macro group cron setup for this new district.

12-Jul-2019
-----------
WP-1262 4.5h
Macro cron is setup for this new district. We can promote to production next week.

WP-1238 3.5h
I worked on this.
I received updated stored procedure from DBA Naveena. I have integrated this to php scripts and updated code for logging.
Copied production data to staging db and checked the new stored procedure in staging environment. It worked fine.
Now, we are logging old & new odometer values from nightly odometer cron. This logs is maintained for each day the cron runs. 
This will help to debug and fix the bad odometer data.
I can promote this update to production after the call.

15-Jul-2019
-----------
WP-1262 - 1h
This is promoted to Production.

WP-1263 - 7h
I am working on this.
#1 This is completed. Tablet heartbeat is added to realtimepage and reports page menu list.
<screen shotssss>
Do you want to remove navigation from tablet manager or we shall leave it.

#2 I am working on this. 

16-Jul-2019
-----------
WP-1263 - 7h
I worked on this.
#2 This is completed. We are considering the tablet those come within 100 miles from district center points. Other tablets are excluded from default map zooming.  
PrePro:
<screen shot>
Production:
<screen shot>
#1 & #2 updates are available in prepro.

WP-1251 - 30m - no jira
I have started going through this ticket.

17-Jul-2019
-----------
WP-1234 - 6.5h
I worked on this.
I have addressed duplicate bus number issue.
I have added success messages to add and delete operations.
Add:
 !screenshot-8.png|thumbnail! 
Delete:
!screenshot-9.png|thumbnail! 
Updates are available in staging. [~suhas_s], please check.

WP-1251 - 1h
I had discussion with Prakash. Received inputs on #1 & #2.

18-Jul-2019
-----------
WP-1263 - 4h
I am working on this.
District 17:
I checked this issue. We have following lat & lng as center points.
214.7483647, -7.709333
This is incorrect coordinates. We need valid coordinate as we are caculating tablet distance from district center poitns.
<screen shot>
Please provide valid coordinates, I will update that and check.
District 15:
I will check this after WP-1251.

WP-1251 - 4h
I am working on this.
#1 Completed.
#2 In progress and close to completion.
I will have Prakash to review the code.
I need to test this in staging.

19-Jul-2019
-----------
WP-1251 - 5h
I am working on this.
#2 Completed.
I will do some testing from my end.
Prakash P, Please review the code.
I have tested this in staging. It is working fine.
Suhas Shetty, please test #1 & #2 in staging.

WP-1238 - 1.5h
I worked on this.
I checked the logs. Extracted the log values for bad data buses, they are District 24's Bus 109 and District 9's Bus 1601 & 1603.
District 24 - Bus :109
17th Cron Run
Bus :109, Old Odometer :69422405, Old Miles :43137.0826 New Odometer :69422676, New Miles :43137.251
18th Cron Run
Bus :109, Old Odometer :69422405, Old Miles :43137.0826 New Odometer :69422405, New Miles :43137.0826
District 9 - Bus :1601
17th Cron Run
Bus :1601, Old Odometer :64676441, Old Miles :40188.0773 New Odometer :64767078, New Miles :40244.3965
18th Cron Run
Bus :1601, Old Odometer :64766564, Old Miles :40244.0771 New Odometer :64857807, New Miles :40300.7729
District 9 - Bus :1603
17th Cron Run
Bus :1603, Old Odometer :65912419, Old Miles :40956.0784 New Odometer :66017813, New Miles :41021.5672
18th Cron Run
Bus :1603, Old Odometer :66018636, Old Miles :41022.0786 New Odometer :66127143, New Miles :41089.5017
Odometer values for the above buses got updated before the cron runs early morning. 
As we know, only bus manager can update the odometer value and need to check once again any other process/program updates the odometer values.

WP-1234 - 1h
I have just started looking into the issue.

22-Jul-2019
-----------
WP-1234 - 5.5h
I worked on this.
Issue with accessing the page by inappropriate users, is addressed. Fix is available in staging.
[~suhas_s] please check.

WP-1238 - 1h
I checked the cron logs for the given bad data buses from 19th to 22nd July 2019. All bus data are correctly updated by cron. 
Odometer value of bus 1603(district 9), got updated by bus manager before cron run on 22nd July.

WP-1263 - 1h
District 17:
I will update new lat & lng in production db by tomorrow and check the issue.
District 15:
I have started looking into this.

23-Jul-2019
-----------
WP-1273 - 7h
I am working on this.
I investigated the issue and found there is an invalid contractor 'dat1154' created for this district. Actually this is causing the issue. No idea why it was created. We don't have this contractor in current configuration.
screenshot-1.png
It got data on 11/25/2016 and no updates after that.
Mapping table
screenshot-2.png
We need to clean up dat1154 data in db.
I have done the data clean up in staging db for New Canaan location.
We need to check and clean data for South Windsor,Windsor,East Hartford,Manchester locations.
No code fix is required in nightly cron as this is due to incorrect contractor configuration.
Currently, we have 58 vehicles assigned to New Canaan. In that, only 46 got GPS ID. Those got bus numbers and added to New Canaan admin unit in staging.
screenshot-3.png
Mapping Table Valid Data

WP-1263 - 1h
District 17:
I updated correct lat & lng in production db. And, I checked in PrePro. It works fine now. Please check.

24-Jul-2019
-----------
WP-1273 - 6h
I worked on this.
I have completed data clean up for New Canaan location in production db. dat1154 vehcile data are removed from mapping and other dependent tables.
And, I rerunt the zonar import cron. Now, it is working correclty for New Canaan location.
Currently, we have 49 buses with gps id.
<screen shot>
This is correctly updated mapping and admin unit.
<screen shot>
Other locations - fixed.

WP-1234 - 30m
This is promoted to PrePro. 
 !screenshot-10.png|thumbnail! 
[~suhas_s], please check.

WP-1238 - 1h
I checked the log values for the reported buses.
Nightly cron correctly updated the odometer value. And, the odometer values were modified from the bus manager.
District 24 - Bus :109
23rd Cron Run
Bus :109, Old Odometer :69422433, Old Miles :43137.1 New Odometer :69436688, New Miles :43145.9576
24th Cron Run
Bus :109, Old Odometer :69436889, Old Miles :43146.0825 New Odometer :69436963, New Miles :43146.1285
District 9 - Bus :1601
23rd Cron Run
Bus :1601, Old Odometer :64895312, Old Miles :40324.0774 New Odometer :65024284, New Miles :40404.2169
24th Cron Run
Bus :1601, Old Odometer :65024060, Old Miles :40404.0777 New Odometer :65118955, New Miles :40463.0427
District 9 - Bus :1603
23rd Cron Run
Bus :1603, Old Odometer :66129681, Old Miles :41091.0787 New Odometer :66236480, New Miles :41157.4405
24th Cron Run
Bus :1603, Old Odometer :66235898, Old Miles :41157.0789 New Odometer :66338034, New Miles :41220.5433

25-Jul-2019
-----------
WP-1251 - 1.5h
This is released to production. Stored Procedure is updated.
New column lunch_id was added to following db tables around 11pm eastern time.
1. student_details_history
2. student_details_upload
3. student_details

WP-1263 - 6h
I worked on this.
District 15:
Required logical updates are done. If no tablets come within 100 miles from district center point, 
then it will go back to old logic to set map default zoom level considering all the tablets irrespective of their location to district center point.

26-Jul-2019
-----------
WP-1251 - 30m
Yes, it was expected to populate lunch id for district 30 with today's cron.
I checked student cron import for district 30. Lunch ID is populated correctly based on manual_rfid_no.

WP-1234 - 5.5h
I am working on this.
Issue with vehicle log table is corrected. Now, we are tracking past bus & ESN in logs table while Unassigning a GPS unit.
Eg. deleting bus Test-1
screenshot-11.png
I discussed with Pritha.
1. Below fields are reset while unassigning a gps unit.
bus number, route,assigned_route,vehicle_type, admin unit, driver name, VIN
Now, it is updated in add/delete page.
Pritha confirmed sub, sub_type, sub_mode db columns are not updated as part of bus manager. She shows information icon when it is sub bus.
screenshot-12.png
Please clarify, what we needs to be set here?
2. Note associated with GPS unit, is added to additional_note column in vehicle_ids table like bus manager.
Eg. "Removed unit 4641254140 from Test-1 on 07/26/2019"

WP-1265 - 1.5h
I have started looking into this.


29-Jul-2019
-----------
WP-1263 - 30m
This is promoted to Production and working fine.
Suhas Shetty, please check.

WP-1234 - 6h
Initial requirement.
a) This is completed. If a bus is part of a sub, then it can not be deleted.
<screen shot>
b) As per initial discussion on this task, we need to show the vehicles in UI table only if they have bus number. 
That's the reason, the bus with ESN number, is removed from UI table after deleting it.
Now, the code is updated to show vehicles assigned with ESN but no bus number. 
<screen shot>
'Delete' option should not come for the buses with no bus numbers.
<screen shot>
I am working on this.

30-Jul-2019
-----------
WP-1234 - 1.5h
#C: If we do not list the GPS in the table, then these GPS with no bus numbers, can not be seen in the table after deleting. This is reverse of the update what we worked yesterday.
I will discuss with you and then continue working on it.

WP-1265 - 6h
I am working on this.
Working on updating bus assignment logics. I am expecting to complete this by tomorrow and then will promote to staging and test.

31-Jul-2019
-----------
WP-1280 - 3h
I looked into the issue.
I checked the logs. Zonar system's API for district 31 "First Student - Lower Moreland" contractor was down starting from 07/30 10PM to 07/31 12.20AM Easter Time. That's why we received the notification emails as there were no zonar feeds.
We have not restarted zonar process manually. Our system started collecting data once zonar system API was up.
It is working fine now.

WP-1265 - 4.5h
I worked on this.
I have completed the required updates in local.
Promoted to staging and started testing there.

01-Aug-2019
-----------
WP-1282 - 2h
I have started looking into it.

WP-1265 - 5.5h
I worked on this.
Tested in staging environment. It is working fine.
Now, all the vehicles of location FIR0080 of First Student, are saved to "First Student North" admin unit and rest of the buses are saved to "First Student West" admin unit.
screenshot-1.png
Realtime page shows "First Student North" buses.
screenshot-2.png

02-Aug-2019
-----------
WP-1282 - 7.5h
I am workin on this.
Created geozone_type and school_type values mapping in config file.
Working on importing geodata from zonar.
Just to confirm,
1. This is just one time import for zonar districts and we will start with district 62.
2. We will save geozone_name, geozone_type, school_type, poly_points, center_point, poly_points_spatial, center_point_spatial db table columns in geozone table.
poly_points_spatial value is used in sql queries to find geozone. Need to save poly_points_spatial as well.



05-Aug-2019
-----------
WP-1265 - 2h
This is promoted to production. It is working fine.
All the vehicles from location FIR0080 of First Student, are saved to "First Student North" admin unit and rest of the buses are saved to "First Student West" admin unit.
School Admin page:
Realtime page:

WP-1282 -  5.5h
I am working on this.
Completed importing geo data. I am able to get zonar geodata from code.
Working on parsing logics for required data formations.

06-Aug-2019
-----------
WP-1282 - 7.5h
I am working on this.
Completed Parsing and created required data formations. 
Promoted to staging. Need to test the functionality and data in staging environment.  I will work on this tomorrow.
I created two geozones, need to check and run it for other geozones in staging db.
 !screenshot-1.png|thumbnail! 
 !screenshot-2.png|thumbnail! 

07-Aug-2019
-----------
WP-1282 - 7.5h 
I worked on this.
I have implemented error logging message to the zonar geodata process.
I ran the process in staging for all the zonar geozones in district 62. And, tested the functionality and imported data. It is working fine. Also, I tested fetching geozone details by lat & lng using sql queries. It worked fine.
District 62 Geozones DB table
screenshot-3.png
Geozone list:
screenshot-5.png
Edit geozone:
Other geozones are drawn over map with their corresponding colours.
screenshot-4.png

08-Aug-2019
-----------
WP-1282 - 3h
This is promoted to Production.
All zonar geozones are imported to our geozones db table.
Existing geozones are 42 and imported geozones are 157. Total 199 geozones.
screenshot-8.png
Observation:
Geozone "Bay View Woods Lane" name is same like zonar geozone. So, it got 'zonar' keyword.
screenshot-10.png
Other zonar geozones naming is different from existing geozones. So, it did not append 'zonar' keyword.
eg: screenshot-9.png
Ryan Hill, what we need to do here?

WP-1296 - 5h
I have already started looking into this. 
Looks like something is not correct with Synovia system. It happened overnight.
I will look into this.
I have paused notification email to avoid receiving bunch of mails on this.
Update :
Synovia API URL is not working correctly. I can see the error message from logs.
screenshot-1.png
Synovia System's security certificate has expired on 08/07. So, it is blocking our API services.
screenshot-2.png
Will check the possibility to make it work.
This problem will be resolved by itself once they renew their certificate.
And, there is also an option to get the gps data from Synovia Systems by disabling the certificate verification from our end. But, it is recommended not to disable the certificate verification as it puts us on security risks. I need to discuss with Vijendra if we are going in this approach.
Ryan Hill, please confirm.

09-Aug-2019
-----------
WP-1296 - 4h
I worked on this
I have updated API endpoint as given by Synovia Team. Now, It is working.
We are able to import gps data from Synovia system.
screenshot-3.png
Currently, it is pulling the missed data. It will start receiving the realtime data after sometime.
Tested and it is working fine. Will keep monitoring for sometime.

WP-1289 - 4h - No jira
I have just started looking into this.

10-Aug-2019
-----------
WP-1296 - 8h
I worked on this.
I checked both the report logics. Two reports follow different structure and arrival logic. 
It is little challenging to bring both reports data into a single report for all schools.
"Individual All bus arrivals" report follows geozone_id. We need to change the logic to work based on school number 
like we have in "Individual Planned bus".
"Individual All bus arrivals" uses sql to fetch arrival for a school. I needs to be updated to SP to find arrivals for all the school like we have in
"All Schools: Planned buses vs. planned times". I will discuss with DBA Karthi on this.
I have started working for "Individual Planned bus" data in new report.

12-Aug-2019
-----------
WP-1289 - 7.5
I am working on this.
I am working for "Individual Planned bus" data updates in new report.
DBA Karthi is not available today. So, I will discuss about "Individual All bus arrivals" queries once he is available.

13-Aug-2019
-----------
WP-1289 - 7.5
I am working on this.
I have completed "Individual Planned bus" data in new report. 
[New report|http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=54297&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=45&action=Submit]
Need to address UI issues in data table like missing background color to differentiate rows. 
Tomorrow, I will discuss with DBA Karthi on "Individual All bus arrivals" queries on this report.

14-Aug-2019
-----------
WP-1302 - 7.5
I worked on this.
I have completed zonar set up for "Durham South" contractor in district 15.
Buses of this contractor are saved to "Durham South" admin units.
In "Durham" (DH buses), bus numbers are formatted to four digits by prepending 0 in fornt.Hence, I formatted "Durham South" buses to four digits by preceding zeros.
I have promoted to staing. Need to test in staging both vehicle asset and gps data importing before production release.
Just to confirm, contractor id is dur4142, which is not working. And, contractor_id is dur4143 from given URLs, it works and used the same in zonar setup.

19-Aug-2019
-----------
WP-1314 - 4h
I am working on this.
I have paused notification email just to avoid receiving bunch of emails on this.
We have this issue because of some updates done on Synovia Systems side. I am checking from our end to make it work.
I need to discuss with Vijendra on this since he has provided the WSDL file for Synovia.

I had a discussion with Vijendra and his comment is given below.
"
Looks like the metadata of their service is changed and hence our processes are failing. Generally, we were generating WSDL files from their service 
discovery page at https://api.synovia.com/SynoviaApi.svc. Once after generating the WSDL file, we were using that file in our process.
But, today we found that they have disabled metadata publishing for this service. Hence, we can not generate the WSDL file. Now, we need either of the following.
1. Enable metadata publishing of their service on their website.
2. Send us the latest WSDL file.
It will be good if they inform us before making any updates on their side.
"

WP-1302 - 3.5h
I tested the functionalities in Staging. It is working fine.
This is promoted to Production. Tested there, it is working fine.
School Admin:
screenshot-3.png
Realtime:
screenshot-4.png
Icons were created. It will appear over map when we receive GPS message from the buses.
Both GPS import is working fine. We can see GPS data for 0086DS & 0049DS.

20-Aug-2019
-----------
WP-1314 - 6h 
I worked on this.
I checked the new stage URL then updated in our staging environment.
I took Vijendra's help to get the WSDL file based the new stage URL.
It worked fine in staging environment.
Promoted the updates to production. It is working fine in production.
screenshot-1.png
We are able to see the realtime data for synovia buses.
screenshot-2.png

WP-1234 - 1.5h
Validation issue with admin unit, is addressed. 
This is promoted t PrePro. It is working fine.
Please check.

21-Aug-2019
-----------
WP-1289 - 7.5h
I am working on this.
Working for "Individual All bus arrivals" data.
Currently, "Individual All bus arrivals" is for one individual school. Need to update the logic and structure for all the schools. And also, it
works based on geozone_id, need to work based on school number like "Individual Planned bus".
I had discussion with DBA regarding "Individual All bus arrivals" queries. Stored Procedure is not required for now. We can use the sql queries.
He will work for the sql queries and then he will provide them.

22-Aug-2019
-----------
WP-1289 - 7.5h
I am working on this.
DBA is looking into on "Individual All bus arrivals" sql queries. He may provide on Monday.
I am working on "Individual All bus arrivals" logical updates. Modified structure and modified to work based on school_no. I used temporary sql queries to show some data in UI as DBA is working on that.
New Report
screenshot-1.png
"Individual All bus arrivals" results are appended to "Individual Planned bus" results.

--------------------------------------------------------

27-Aug-2019
-----------
WP-1325 - 6h
I worked on this.
I tried both WSDLs provided by Synovia in staging environment.
1. synovia api wsdl from stage.xml
2. synovia api single wsdl from stage.xml 
#1 It did not work as it references to https://apistage.synovia.com:9443/SynoviaApi.svc. It got error and stopped data collection.
#2 Implemented single WSDL in staging and tested. It worked fine.
Promoted #2 updates to production. I is working fine in production.
DB:
 !screenshot-1.png|thumbnail! 
Realtime:
We can see realtime data for Wisconsin Central buses.
 !screenshot-2.png|thumbnail! 

WP-1289 - 1.5h
I am working on this.
I worked with DBA Karthi and got the sql.
I have integrated the sql to php script.
I can see results are matching with individual reports.
Individual All bus arrivals:
https://www.wheresthebus.com/admin/school_arrival_report.php?district=24&school=530&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=45&noOfVisits=0&action=Submit
screenshot-4.png
Individual Planned bus:
https://www.wheresthebus.com/admin/school_assigned_buses_arrival_report.php?district=24&school=97677&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=45&action=Submit
screenshot-5.png
New Report:
http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=97677&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=45&action=Submit
screenshot-6.png
In "Individual All bus arrivals", we are reporting multiple arrivals of same bus. We are missing that in this new report. Need to work on it.
New Report:
http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=54295&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=45&action=Submit
screenshot-7.png
Individual All bus arrivals:
https://www.wheresthebus.com/admin/school_arrival_report.php?district=24&school=252&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=45&noOfVisits=0&action=Submit
screenshot-8.png

28-Aug-2019
-----------
WP-1325 - 2h
Yes. the email alerts are turned back on.
I checked synovia vehicle import nightly cron for the new update. No errors found and It is working fine.

WP-1289 - 5.5h
I am working on this. 
In new report, multiple arrivals of "Individual All bus arrivals", is not compatible with current structure and logic. I need to rewrite the logic to accomodata it. I am working on this.
I will also take a look on arrival filter issue.

29-Aug-2019
-----------
WP-1289 - 7.5h - no jira
I am working on this.
Multiple arrivals of "Individual All bus arrivals" are being reported in the new report. I have updated the logic.
Individual All bus arrivals report:
https://www.wheresthebus.com/admin/school_arrival_report.php?district=24&school=240&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=300&noOfVisits=0&action=Submit
screenshot-9.png
New report :
http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=54297&startDate=07%2F22%2F2019&endDate=07%2F26%2F2019&adminUnits=&day_part=AM&arrDept=300&action=Submit
screenshot-10.png
I have addressed the issue with arrival filters.
Clarification:
In "Individual Planned bus", arrival filter is checked against "Plan Time" instead of school bell time. Same thing is applied in the new report but we are not showing "Plan Time" column in UI table. Is this fine or should be change the arrival filter check against school bell time?
screenshot-11.png
Updates are available in PrePro.


30-Aug-2019
-----------
WP-1289 - 7.5h
I am working on this.
New column "Plan Time" is added to UI table and plan time data is shown.
Arrival filter works based on plan time for "Individual Planned bus" data and it works based on bell time for "Individual All bus arrivals" data.
Report for current data:
#1. Actually, one record comes from "Individual Planned bus" and another one from "Individual All bus arrivals" data. So, it looks like duplicate.
screenshot-12.png
#2. It is same like #1. 438 with route comes from "Individual Planned bus" data and 438 without route from "Individual All bus arrivals" data.
New filter "Late" is implemented. Arrival data is compared against the bell time to mark it as late(red text). Should we use "Plan Time" instead of bell time o mark it as late (red text) for "Individual Planned bus" data ?

---------------------------------------

03-Sep-2019
-----------
WP-1289 - 7.5h - no jira
I am working on this.
#1. Duplicate entries are handled. If there are two rows with same arrival values, then only planned bus row will be shown.
http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=54297&startDate=08%2F26%2F2019&endDate=08%2F28%2F2019&adminUnits=&day_part=AM&arrDept=30&arrLate=0&action=Submit
screenshot-13.png
#2. I had a discussion with DBA Karthi regrading planned school arrival SP. Bus 438 is not there in planned_activities table. That's why, it arrival is not reported.
screenshot-14.png
I checked this in "All Schools : Planned buses vs. planned times" report. Bus 438 is listed in "no arrivals" pop up.
https://www.wheresthebus.com/admin/all_school_planned_arrival_time_report.php?district=24&startDate=08%2F26%2F2019&endDate=08%2F28%2F2019&action=Submit&daypart=AM&adminUnits=&schoolType=All&timeWindow=30&earlylatechk=1&earlylateHid=1&early=30&optimal=30&marginal=30
screenshot-15.png
#3. This is done. Planned time is used for planned bus and bell time is used if it is not a planned bus.

04-Sep-2019
-----------
WP-1289 - 7.5h - no jira
I am working on this.
#1 Earlier, data is order based on average arrival. Now, I have modified to sort on route number first then bus number.
http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=54297&startDate=08%2F26%2F2019&endDate=08%2F28%2F2019&adminUnits=&day_part=AM&arrDept=30&arrLate=-10&action=Submit
Earlier:
screenshot-16.png
Current:
screenshot-17.png
#2 Okay.
#3 #1 This is done. Now, both negative and positive numbers are accepted and arrivals will be marked based on given late filter value.
screenshot-18.png
#3 #2 Late filter is applied to average arrivals as well.
screenshot-19.png
Updates are available in PrePro.
I have found an issue. When 'All' option is selected in school dropdown, it is reporting irrelevant arrivals to the school. I will look into this.
screenshot-20.png

05-Sep-2019
-----------
WP-1289 - 7.5h - no jira
I am working on this.
I have addressed reporting incorrect arrivals when running for all schools.
[All Schools Link|http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=24&school=-1&startDate=08%2F26%2F2019&endDate=08%2F28%2F2019&adminUnits=&day_part=AM&arrDept=30&arrLate=-15&action=Submit]
I have addressed issue with Bus # 301 which was listing twice. 
Actually, first row of 301 is from "Individual All bus arrivals" data and second row with plan time 8:50AM is from "Individual Planned bus" data. 08/26 arrival is moved to plan data row and displayed as single row.
Earlier :
 !screenshot-21.png|thumbnail! 
New :
 !screenshot-22.png|thumbnail! 
I am working for bus 438 issue. Here, we need to find sub bus and its arrival needs to be moved to plan data row, where we have route.
I will look into district 15 issue. 

09-Sep-2019
-----------
WP-1345 - 7.5h
I am working on this.
I setup the production data in staging and debugging the zonar import in staging environment.
I found missing two buses S028 and S082 belong to "Elite Bus Co" location and which is not part of locations that we track for distrit 62.
Initially, district 62 was setup with below locations.
Bench Bus
Brown JR Elkton
Brown SR Elkton
Brown SR PV
CCPS
Dvoraks LLC
Gilbert
Home
Johnson
Justin Davis
K and B
Marshall Bus Serv RS Jim
Marshall Joe
Wagner Emma
Wagner LLC Steve
"Elite Bus Co" is added to the locations. Now, both the buses are added to vehicle_ids table.
<DB screen shot>
<realtime>
Looks like, current admin units are not updated with the buses correctly in nightly cron. Need to work on mapping the locations to admin units. 
Please provide the which admin unit is mapped to whcih location
Current locations from Zonar:
<sql>
SELECT location, count(location) as NumOfBuses
FROM `zonar_vehicle_mapping`
WHERE `district_id` = '62'
group by location
<screen shot>

10-Sep-2019
-----------
WP-1345 - 7.5h
I am working on this.
All the Admin unit names are updated to match what's in Zonar location field
I updated all the admin unit names to match with Zonar location field. And, also created missing admin units. All the Zonar locations are added to configuration file. Earlier, we added only the locations that got buses with gps id. Now, I added all the locations of Zonar API to config file including blank gps id location buses and created admin unit for them as well.
screenshot-4.png
screenshot-5.png
All the buses are assigned to the correct admin unit based on the location field
Buses with gps id, are correctly assigned to admin unit based on location.
There are no missing buses
We have got 187 buses with gps id in mapping table and they are all saved in vehicle_ids table.
Mapping table
screenshot-6.png
Vehicle ids table
screenshot-7.png
The 2 new locations are correctly added and have the correct bus assignments.
I don't see two new locations that they planned to add today. Yesterday, we had 18 locations(including blank gps id buses) and today it remains same.
Yesterday's Data:
screenshot-8.png
Today's Data:
screenshot-9.png
All updates are done in staging first and tested then promoted to production and tested the functionality and it is working fine.
Yes, we can delete those 5 admin units.
I have done this in staging and tested. It worked fine.
Updated in production as well. It is working fine.
screenshot-10.png
"Elite School Bus Co" admin unit was not created by zonar vehicle import nightly cron. I tested this in staing.

11-Sep-2019
-----------
WP-1345 - 8h
I am working on this.
I checked today's nightly cron results for district 62. It got failed due to error. The error is due to special character in location. Zonar system renamed "Dvoraks LLC" to "Dvorak's Garage LLC". It is having single quote. It was not handled in zonar import process.
I have addressed the special character issue with location in staging and tested.
And also, zonar updated their other locations today.
Earlier locations with GPS id:
screenshot-11.png
Today locations with GPS id:
screenshot-12.png
They have added few new locations and renamed existing locations. Admin units are matched with locations and updated in config file.
Updates are there in staging and tested it. It is working fine. I will promoted to production.

I have done the updates in production. It is working fine.


12-Sep-2019
-----------
WP-1234 - 3h
I worked on this.
I have addressed the issue with removing bus from admin unit when it is deleted.
The fix is available in PrePro.
[Suhas Shetty|~accountid:5be5a697629ac7623025e00b], please check.

WP-1289 - 5h
I am working on this.
I have addressed issue with sub bus. Sub bus arrival data from "Individual All bus arrivals" row, is moved to plan data row where route & plan time. 
Fix is available in PrePro.
I have started looking into district 15 issue.

13-Sep-2019
-----------
WP-1289 - 7.5h
I am working on this.
I checked missing arrivals issue for district 15. 
"Individual Planned bus" are correctly reported in new report.
We are misssing some arrivals from "Individual All bus arrivals" report.
This is not an issue. We are missing arrival in new report based on arrival filters value.
New report with 1 hour arrival filter.
<new report with one hour arrival filter>
On-time & Late : We should consider both planned buses and non planned buses arrivals. right?
No Arrivals : Need to discuss
Assigned : Need consider only show planned bus arrivals.
Unassinged  : Need consider only show non planned bus arrivals.

13th Sep CALL UPDATE :::
On-time & late : just to confirm, need to consider both planned buses and non planned bus arrivals
 - Ryan : Yes
No Arrivals - not clear
106 - 1 - Ryan : correct
108 - 1 - Ryan : correct
-- 198 - 1 - Ryan : rule out as sub bus 438 ran for 198 route
-- 438 - 3 - Ryan : rule out as 438 ran as sub in route 198 
301 - 1 Ryan : correct

Assigned & Unassinged:
- To confirm, Assigned -> planned bus arrival & Unassinged -> non planned bus arrival. 
Ryan : correct

17-Sep-2019
-----------
WP-1289 - 8h
I am working on this.
I have addressed the issue with marking 7:18 arrival as late. There was an issue in logic.
I worked on summary data. Other summary data are completed except "No Arrival". 
<screen shot>
I am working on "No Arrival" data. Here, we need to consider the sub bus arrivals.

18-Sep-2019
-----------
WP-1289 - 7.5
I am working on this.
I have completed "No Arrival" calculations. 
<link>
<screen shot>
UI issues:
Please try to avoid any wrapping. We should have enough space to avoid this
- This is addressed.
Please remove the lines in this summary info section
- This is done.
Can this be centered like the School info?
- Yes. This is done.
Please try get the row lines into the tablefor all the columns after the summary.
- I am not getting this. Will discuss in call.
I am looking int to the average issue with 301 bus.
Updates are available in PrePro.

19-Sep-2019
-----------
WP-1289 - 8h
I am working on this.
I have addressed average issue with 301 bus.
Here, 08/26 arrival is 9.30 and plan time is 8.50. So the arrival should not be reported as arrival filter 30mins
New report:
screenshot-29.png
I checked the issue with "No Arrival" and "Unassigned" count of the new report.
screenshot-30.png
No Arrival:
No Arrival is calculated only for the expected bus(planned bus). Since bus 472 is not a planned bus, so, it arrival is not considered for route 161.
Unassigned:
We are counting the non plan buses (no plan time) that arrived. And, bus 472 is not a planned bus and it arrived. That's why it is counted.
In both 'No Arrival' and 'Unassigned' cases, bus 472 is not a planned bus (no plan time).

20-Sep-2019
-----------
WP-1289 - 7.5
I am working on this.
I have updated no arrivals logic. As we discussed, bus 472 arrival is considered for route 161 even though bus 472 is not from plan(no plan time).
New Report:
screenshot-31.png
I am looking at Unassigned & Assigned updates. I will update before I leave for the day.
I have modified Unassigned & Assigned logic for new update.
screenshot-32.png
Updates are available in PrePro.
I will look into Milwaukee issues.

WP-1289 estimation on 20/Sep/2019:
1/2d district 15 issue
1/2d UI issues
1d excel
2d testing

---------------------------------------
---------------------------------------
23-Sep-2019
-----------
WP-1289 - 7.5h
I am working on this.
I checked the district 15 issue. We are missing these arrivals from SP.
<sp screen shot>
I discussed with DBA Karthi. It is not returning the arrivals as there is no plan data for these buses in planned_activities table.
I checked the "All Schools : Planned buses vs. planned times". Arrival are not reported there. 
I need to discuss with Ramesh about the logic in all school planned arrivals report as these buses are reported in individual school arrival report.
I have added the row lines into the table for all the columns after the summary.
<screen shot>

24-Sep-2019
-----------
WP-1289 - 4h
I am working on this.
I discussed with Ramesh on "All Schools : Planned buses vs. planned times" report. District 15 is not handled there.
In district 15, bus number in planned_activities and school arrivals are different. And, we are finding school arrivals based on bus numbers. That's why, arrivals are not reported.
For example, route 0034 to BRUCE ELEMENTARY school.
Planned Activity table:
screenshot-36.png
School Arrivals table :
screenshot-37.png
Need to update db stored procedure for planned arrivals, which was created for "All Schools : Planned buses vs. planned times" report. We are making a call to this db stored procedure from new report as well.
I have created new ticket WP-1368 Assigned to address this in "All Schools : Planned buses vs. planned times" report.

WP-1368 - 4h
Ryan Hill,
I have started looking into this.
We have bus_route_info db table, I think, we can use to find the bus numbers for the route.
screenshot-1.png
I had discussion with DBA Karthi. He will look into the stored procedure.

25-Sep-2019
-----------
WP-1234 - 30m 
This is promoted to production. It is working.
Suhas Shetty please check.

WP-1368 - 4h
I worked on this.
I discussed with DBA Karthi and provided him the details and queries. He will work on stored procedure. 
So that, district 15 arrivals will be reported on all school planned arrrival report.
There were two junk processes in app server, which were running for several days.

WP-1354 - 3h
I have started looking into this.

26-Sep-2019
-----------
WP-1372 - 6.5hr
I am working on this.
#1 I have downloaded zip data for Apr 2016 - Dec 2016 from S3 as we have GPS data backups there.
#2 I have imported all the data to new daily_events_11 table in wtb_vehicle_tmp database.
screenshot-1.png
#3 I have deleted other buses data which are not in the list. Now, only needed buses data are left in new table. We have 539,253 records in new table.
screenshot-2.png
#4 Shall I move the data from new table to daily_events_11 in wtb_vehicle DB today? Ryan Hill, please confirm.

WP-1368 - 1 hr
I worked on this.
I discussed with DBA Karthi.

27-Sep-2019
-----------
WP-1374 - 6h
I worked on this.
I have done the setup in staging. And, I ran the zonar import manually in staging and tested it, it worked fine.
I have created new admin unit and buses are correctly saved to admin units. Buses appeared in realtime page.
This setup is done in produciton.
<Realtime page>
<admin unit>

WP-1372 - 2h
I worked on this.
I have moved archived data from temp table to production table.
Production's daily_events_11:
screenshot-3.png
I checked bus history page for few buses. It is showing past driving data.
screenshot-4.png
Ryan Hill, Please check.

--------------------------------------------------------------------------
--------------------------------------------------------------------------

30-Sep-2019
-----------
WP-1354 - 6h
I am working on this.
I checked existing logic for locations. Not all the districts follow the admin unit logic based on locations. For example,
District 26, We have 34 locations.
screenshot-1.png
we are tracking only some of the locations WP-1168 Done .
South Windsor,New Canaan,Windsor,East Hartford,Manchester,Crec.
In District 31, we are tracking only below locations.
Philly Trans,Tacony,Home,UNKNOWN,MAT Bus Corp (PA),School Vehicle Division
Here, "School Vehicle Division" location buses are saved in Philly Trans  Orthodox admin unit, "Tacony" location buses are saved in "Philly Trans  Tacony" admin unit. Different location name is mapping to different admin unit. They have done some mapping logic is done.
Someother districts don't have admin unit based on location and it uses contractor name as admin unit. For example,
District 37 takes all the zonar buses(non numeric bus number) and saves in "First Student Buses" admin unit name.
screenshot-2.png
In District 15, Lamers, Durham, Johnson, Durham South admin units are created with contractor name and all the buses are saved in respective admin units.
Will discuss more in the call.

WP-1368 - 1.5h
I worked with DBA Karthi.
He has to update the SP logic in many places. He is working on that.

01-Sep-2019
-----------
WP-1354 - 7.30h
I am working on this.
I am working on logical updates.

========================================================

08-Oct-2019
-----------
WP-1368 
- 3.5h
- Karthi 8hrs
	1st tue-2 3rd thur-2 and 04th fri 4
I worked on this.
He received updates from DBA Karthi. I integrated this to all school planned arrival report in PrePro using temporary SP. 
This temporary SP will be replaced with original SP when it goes to produciton.
I checked the report in PrePro. Looks like, it is working fine and reporting the missing arrivals of district 15.
<link>
<screen shot>
We can have Suhas to do a round of testing.

WP-1289 - 2h
I worked on this.
I integrated new db SP updates from WP-1368 Develop . I checked new report, it is working fine.
Report:
screenshot-39.png
Please check.

WP-1381 - 1.5h
I checked this issue.
I checked the logs and I could not find any errors. 
Need to debug the issue when we get the notification emails.

09-Oct-2019
-----------
WP-1354 - 7.5

This is in-progress
Working on implementing the required updates. 
1. If new location is added with bus assignments in zonar system, then new admin unit will be created in our system with new location name and buses will be assigned to it.
2. If location is renamed in zonar system, then it would be done for admin unit.
3. If location is removed from zonar system, then respective admin unit will be deleted.
4. If location does not get bus assignments in zonar system, then respective admin unit will be deleted as no buses will be shown for the admin unit in school admin page. We have done this manually for few admin units "Brown SR Elkton, Brown SR PV, etc.." while working on WP-1345. Please ref comment "10/Sep/19 5:11 PM".
Expecting to complete the updates by tomorrow and start testing in staging.

10-Oct-2019
-----------
WP-1354 - 5.5
I am working on this.
I have completed implementing required updates.
I will promote the updates to staging and test the functionality.

WP-1381 - 2h
I checked this issue.
Zonar API is not working for district 26 - Dattco and district 43 - Prince Georges County. Data collection was stopped due this issue and we started receiving
notification emails.
1. District 26
https://dat1154.zonarsystems.net//interface.php?username=datt0583&password=welcome1&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1570704461&endtime=1570711667
<Screen shot>
2. District 43
https://pri1059.zonarsystems.net//interface.php?username=VeoNowPGCPS&password=Veo.Location&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1570704415&endtime=1570711667
<Screen shot>
I tried restarting zonar process. It did not help.
Zonar API were up after sometime and data collection started again by itself.

11-Oct-2019
-----------
WP-1354 - 6h
I worked on this.
I promoted the updates to staging. I tested the functionality and it is working fine.
Outstanding thing is, we need to update the display order in admin units table in zonar import.
Just to confirm, we don't need to manually add/edit/delete admin units based on locations when we setup a new zonar district like district 62 in future.
If a district has multiple contractors, then we need to create admin units with contractor name or different name and save the buses to the admin unit. 
This will not follow the new location logic.

WP-1378 - 1h 
I will look into this next.
Do we need to format the bus number?

12-Oct-2019
-----------
WP-1354 - 3h 
I worked on this.
I completed updating display order of admin units in admin units table based on locations from zonar import.
Suhas Shetty can test the updates in staging. I will work with him on testing.

WP-1378 - 4h 
I worked on this.
I have setup new contractor Battles Transportation for district 31.
Promoted updates to staging and tested. It is working fine. 
We have got 22 vehicles with gps id and they are saved in vehicle_ds and assigned to new admin unit Battles Transportation.
<DB vehicle table>
<UI admin unit school setting page.>
<UI realtime page>
Observation:

WP-1379 - 2h 
I worked on this.
I have setup new contractor Best Transit for district 31.
Promoted updates to staging. Need to test once they zonar api is up

==============================================================

14-Oct-2019
-----------
WP-1378 - 1.5h
I worked on this.
I removed 1804 from bus number. Now, bus number like 18045111BA will be stored as 5111BA.
I ran the import in staging and checked. It is working fine.
Realtime:
 !screenshot-6.png|thumbnail! 
School setting :  !screenshot-7.png|thumbnail! 
Bus icons were created for all the buses of this contractors.

WP-1289 - 6h
I am working on this.
New report is linked to realtime page and reports page(admin header) as well.
Realtime page:
screenshot-40.png
Reports page(admin header)
screenshot-41.png
Duplicate school type in school drop down is fixed.
screenshot-42.png
Shortcut for Charter school type is not handled here. I have added CS as short cut for Charter schools. Is this correct? Ryan Hill, please confirm.
I am looking into admin filter issue.

15-Oct-2019
-----------
WP-1378 - 2.5h
I worked on this.
I have done new contractor set up in production. And, it is working fine.
I ran the zonar  import in production. We got 22 vehicles and those bus numbers are formatted correctly.
Buses are added to [vehicle_ids table|http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=vehicle_ids&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=31&where%5B01%5D%5Bcol%5D=BusNumber&where%5B01%5D%5Bop%5D=LIKE+%25%25&where%5B01%5D%5Bval%5D=BA&where%5B1%5D%5Bcol%5D=&where%5B1%5D%5Bop%5D=%3D&where%5B1%5D%5Bval%5D=&order%5B0%5D=&limit=50&text_length=100].
 !screenshot-8.png|thumbnail! 
And, also saved to "Battle's Transportation" admin unit.
 !screenshot-9.png|thumbnail! 
And, I checked GPS data import. It is working fine. Now, we are getting gps data for this contractor from zonar. I can see realtime data for few buses in realtime page.
 !screenshot-10.png|thumbnail! 

WP-1368 - 1.5h
I worked on issue with admin unit filter.
Found there is an issue with db SP that is used for assignments. I worked with DBA Karthik. It is fixed now.
Report:
screenshot-5.png
We can have suhas to do a round of testing.

WP-1289 - 2h
I am working on this.
I checked admin unit filtering issue. And, found, it is an issue with db SP. We are using this SP from all school planned arrival report. So, I checked in all school planned arrival report, it is not working there as well.
[All school planned arrival report:|https://www.wheresthebus.com/admin/all_school_planned_arrival_time_report.php?district=15&startDate=09%2F09%2F2019&endDate=09%2F13%2F2019&action=Submit&daypart=AM&adminUnits=&schoolType=All&timeWindow=45&earlylateHid=0&early=0&optimal=0&marginal=0]
 !screenshot-43.png|thumbnail! 
After selecting Lamers admin unit:
 !screenshot-44.png|thumbnail! 
I have added this new issue in WP-1368 description. I worked with Karthi and fixed.
Admin unit filter is working now.
 !screenshot-45.png|thumbnail! 

16-Oct-2019
-----------
Checked zonar issue - 1.5h 
 
WP-1324 - 6h
I have started working on this.
#1. I am working with DBA Karthi on this as I need to fix this first. Pritha will work on other queries in WP-1343 Develop Develop .
#2. What would be the value of "MDT Unit Number"? Can you please give few sample values? We don't have space in the table to introduce the new column before IMEI number. Will discuss.
screenshot-1.png
#3. Okay.
#4. Will work on this after #1, #2, #3.

17-Oct-2019
-----------
WP-1402 - 2.5h
I looked into the issue.
Found that export to excel of Idle Report, was running in the background for long time and consuming more resources. This was causing the issue.
Php server status
screenshot-2.png
I killed the process and php server load is back to normal.
screenshot-1.png
Usually, a php script will get killed by itself if it is running for long time. 
Need to check why it did not happen with this report when it was running for too long time. I will check the report and update.

WP-1324 - 5h
I am working on this.
1# I checked query formation from php. I will discuss with DBA Karthi.
2# I have added new column 'mdt_unit_number' to tablet_info table. I am working on fuctionality.
3# I have added new column 'note' to tablet_info_table.

18-Oct-2019
-----------
WP-1402 - 1h
I checked the report.
Maximum execution time of the php script, is relaxed in this report. So, it was running for too long time. We need to set a max allowed time in this report to avoid this in future.
Ryan Hill, What is the max time we can set for this report?

WP-1324 - 6h
I am working on this.
#1 I had discussion with Karthi. I will work on this.
#2 This is added to the table.
screenshot-2.png
"MDT Unit Number" is shown in three lines because of less space and lengthy header. Can we reduce the header text?
For eg:
screenshot-3.png
#3 This is added to the table. I have used default browser tool tip.
screenshot-4.png
#2 & #3 are handled in edit tablet page as well.

================================================================

21-Oct-2019
-----------
WP-1405 - 6.5h
I worked on this.
I have completed the updates and available in staging. I ran the zonar import and tested. It is working fine.
I have created new admin unit "Lamers Muskego". All the buses from location "30 MKO" are saved to this new admin unit and all other buses remain in exiting "Lamers" admin unit.
screenshot-1.png
Realtime page:
screenshot-2.png
New bus company "Lamers Muskego" with bus_number_assignment "R" and code "LM"
screenshot-3.png
Can this new "Lamers Muskego" still have the same LM at the end of the bus numbers or do we need to change this to something else?
    Yes, we can have same LM at the end of the bus number in this new "Lamers Muskego" admin unit.

WP-1402 - 1h
I checked other reports.

    Most of the reports are relaxed in maximum execution time.
    Only few reports follows defaults max execution time that is 30 secs.
    I found a report "Timecard Report" is set to 15 mins as max execution time.



22-Oct-2019
-----------
WP-1405 - 3h
I have promoted the updates required for Lamers for district 15 and it is working fine.
Created new admin unit "Lamers Muskego". All the buses from location "30 MKO" are saved to this new admin unit.
screenshot-4.png
New bus company "Lamers Muskego" is created with bus_number_assignment "R" and code "LM".
screenshot-5.png
Realtime page:
screenshot-6.png

WP-1368 - 2h
I looked into the issue.
Found we are missing the arrival of the reported bus '1471LM' from the db stored procedures. I will check with DBA Karthik on this.

WP-1402 - 1h
I worked on this.
Updated the max execution time of the Idle report to 15 mins.
Promoted the updates to prepro.

WP-1324 - 1.5h
#1 I received update from DBA Karthik. We need to create index on the tablet_events_XX table. 
Index creation might take sometime if table is having more records.  We have many tablet event tables and some table having millions of records.
We need to work on this in off business hours. I will start this tomorrow in production db.
#2 & #3 New column are updated in export to excel. Available in staging.


23-Oct-2019
-----------
WP-1324 - 3h
I am working on this.
#1 I have created indexes for all tablet_events_XX tables in production db. Now, tablet manager UI loads quickly in few seconds.
screenshot-6.png
Note : Going forward, when we create new tablet event table, this new index need to be added there.
CREATE INDEX ix_bus_tablet_log_XX ON tablet_events_XX(bus_number,tablet_info_id,log_date);
Please replace XX by district id. For example, district 24 index will be,
CREATE INDEX ix_bus_tablet_log_24 ON tablet_events_24(bus_number,tablet_info_id,log_date);

WP-1368 - 3h
I worked on this.
I checked missing arrival issue bus # 1471LM. It's route # 0293. We have record in buses_assigned_to_school and in planned_activities tables.
screenshot-6.png
screenshot-7.png
We are using bus_route_info table to find actual bus number for the plan bus based on route number. Then, arrivals will be found for the actual bus number from school arrivals table.
Since, we don't have a record in bus_route_info table for the given route 0293, we are missing arrivals for bus # 1471LM.
screenshot-8.png
I checked with DBA Karthi on above findings. He confirmed it.
Prakash P, can you check please why don't have record for route # 0293 & bus # 1471LM?
Note: I can see a record with route # 0292 instead of route # 0293 for bus # 1471LM. Can it be a data issue?

24-Oct-2019
-----------
WP-1402 - 30m
Idle report update is promoted to production. And, report is working.
Suhas Shetty, please check in production.

WP-1368 - 6h
I am working on this.
Route # 0293 did not have 1471LM assignment on given day 10/04. So, showing bus # 1471LM to route # 0293 is incorrect. Like that, incorrect bus numbers are shown for other routes as well in assignment popup. I discussed this with Ramesh S
screenshot-9.png
This issue is addressed now. We are not linking wrong bus number to a route when there is no bus assignment.
Report:
screenshot-10.png
I found incorrect plan time appears in no arrival popup for routes with no bus assignment. I am looking into this issue.
screenshot-11.png

WP-1324 - 1h
I discussed with DBA regarding indexing on copy table. It will not cause any issues if we have the same index name on different tables. But, it is not a good practice.
#4 I will look into this next.

25-Oct-2019
-----------
WP-1368 - 5.5h
I worked on this.
I have modified no arrival logic. Now, it is showing correct plan time in no arrival popup.
screenshot-12.png
Updates are available in PrePro.

WP-1324 - 2h
#4 I have started working on this.
Should we also log IMEI like we do logging for mobile number in vehicle_id_logs?


============================================================

31-Oct-2019
-----------
I am working on this.

#4This is completed. Both bus_number and IMEI changes(add/edit/delete) are logged into a db table like vehicle_ids. Modified time and user also being tracked. Created new table tablet_info_logs in staging db.
screenshot-7.png
Updates are available in staging.
As we discussed on Tablet Label Numbers excel, I will save 'Label #' to newly added field 'mdt_unit_number'. I will work on this.

==============================================================

04-Nov-2019
-----------
WP-1428 - 5.5h
I looked into this issue. It is working fine in production now.
I tried to debug this issue in stage. It worked fine and I could not reproduce the issue.
Then, I checked today's nightly cron results in production. It is working fine. Below three buses were assigned correctly from New Cannan location.
29030- 8026990
29031- 8520749
29032- 8552609
Mapping table:
screenshot-1.png
Vehicle id:
screenshot-2.png
These buses are correctly added to admin units.
District 26 realtime page:
screenshot-3.png
District 55 realtime page:
screenshot-4.png
Note : I did not make any code changes and no db data updates as well.

WP-1324 - 2.5h - no jira
I worked on saving Label # to db table. I have used IMEI number to update Label value.
I will test this tomorrow in staging.

05-Nov-2019
-----------
WP-1368 - 4.5h
I am working on this.
Issue #1 - Missing arrival for 2158RW.
I checked this issue. We have assignment data in buses_assigned_to_school and plan data in planned activities table. And, we also have data in bus_route_info and school arrival table. But still we are missing the arrival. We are not getting arrival data in SP results. I need to check with DBA Karthik on this.
Issue #2 - Incorrect "Arrival" time in popups
I checked the code. These are correct "Arrival" times in popup. They are calculated from "Plan Time" and not based on "Average Plan Time".
Eg.
Plan time of bus 1298LS is 07:25 AM and it is arrived at Oct 04, 07:24 am, then "Arrival" value will be shown as 1 min in arrival popup.
screenshot-13.png
screenshot-14.png

WP-1428 - 1
I checked today's nightly cron results. It is working fine for district 26 & 55.
Mapping table:
screenshot-5.png
Vehicle table:
screenshot-6.png
Realtime page:
screenshot-7.png

WP-1324 - 2h
I tested saving Label # from excel to db table. I is working fine. Label number got updated based on IMEI number correctly.
Tablet Info table:
screenshot-8.png

06-Nov-2019
-----------
WP-1368 - 4h
I worked on this.
I worked worked with DBA Karthi on this. Vehicle type of Bus # 2158RW is truck(3).
vehicle_ids:
screenshot-15.png
We are not reporting arrivals of vehicle types 3(truck) & 4(Others) in the report. We are restricting this. That's why are missing the arrival in the report.
I also checked All Schools: All bus arrivals vs. bell times and All Schools: Planned buses vs. bell times reports. We are not reporting Bus # 2158RW arrival. We have same condition over there.
All Schools: Planned buses vs. bell times Report
screenshot-16.png

WP-1289 - 3.5h
I worked on this.
I applied the fixes of WP-1368 Test here.
Due to some common code updates, we are getting UI breaks and page load error alerts in this page. I am looking into this issues.


07-Nov-2019
-----------
WP-1289 - 9h
I worked on this.
I addressed UI issues and error message alerts in page loading.
I found an issue with integration of WP-1368 fixes. We have routes with no bus assignment in [all school planned arrival report.|http://prepro.wheresthebus.com/admin/all_school_planned_arrival_time_report.php?district=15&startDate=10%2F04%2F2019&endDate=10%2F04%2F2019&action=Submit&daypart=AM&adminUnits=&schoolType=All&timeWindow=45&earlylateHid=0&early=0&optimal=0&marginal=0]
 !screenshot-46.png|thumbnail! 
We are missing those routes with no bus assignment in the [new report|http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=15&school=1063&startDate=10%2F04%2F2019&endDate=10%2F04%2F2019&adminUnits=&day_part=AM&arrDept=45&arrLate=0&action=Submit].
 !screenshot-47.png|thumbnail! 
I have addressed this issue. Those routes appear in the report.
 !screenshot-48.png|thumbnail! 
Observation :
In db stored procedure for finding the arrivals, 'stop_time_sec' of planned_activities<db url> table is primarily used. 
And, we have incorrect data in 'stop_time_sec' column for merged districts.
<screen shot planned>
Here, district 46 'stop_time_sec' is expected to be same as district 15, 20. Due to this, we are not getting correct results in db stoped procedure.
I discussed this with DBA karthi and handling this in SP will take more effort.
The root cause for this different 'stop_time_sec' is plan data import cron timing. It is 11.55PM 
District 15 & 20 completed on 11/06 11.56PM & 11.58PM respectively and district 46 completed at 11/07 12.04AM.
I discussed with Prakash, this issue can be sorted out if we prepone the plan data import cron time. Can we set it 11.30PM. 
So, that 'stop_time_sec' will be same as cron would be finished before 12AM.

08-Nov-2019
-----------
WP-1289 - 3.5h
Okay.
I checked plan import cron. I can see district 15, 20 & 46 are in different positions(execution order). We can put them together, this will further help here. I will do this when I update the plan stop import cron time.

I have addressed #2 issue.
<screen shot>

WP-1437 - 4h 
I worked on this.
I stopped zonar GPS for this customer in staging and tested ,it worked fine.
This is done in production as well. It is working fine in production.
Zonar import continues working fine for other customers. 

===========================================
11-Nov-2019
-----------
WP-1289 - 6.5h
I am working on this.
#1 I have completed export to excel for this new report. I have promoted update to prepro. Please check.

WP-1444 - 1.5h
I have started looking into it.

12-Nov-2019
-----------
WP-1289 - 1h
This is promoted to production and working fine. I have also changed plan data import cron to 11.45PM in production.
Realtime:
screenshot-51.png
New Report:
screenshot-52.png
Export to excel also working fine.
District 7 issue:
Not sure, why it is not working for district7. Need to check.

WP-1368 - 1h
This is promoted to production and reported issues are working fine.
Now, we are reporting arrivals for district 15.
screenshot-17.png
Showing correct route and actual bus number in report.
screenshot-18.png

WP-1444 - 5.5h
I worked on this issue today.
I worked with Ramesh. Found missing start & end hours of AM & PM for this district.
As we discussed and set start and end hours, it started working fine.

13-Nov-2019
-----------
WP-1448 - 2h
I worked on this.
This is addressed. And, it is working fine.
I added the new location to district 62 zonar. And also, created new admin unit "Anderson Bus Company Inc.". I tested the nightly cron results. I worked correctly.
Buses are saved to new admin unit :
screenshot-1.png
Buses are available in vehicle ids table:
screenshot-2.png
Realtime page:
screenshot-3.png
We had similar issue earlier for district 62. And, created a new ticket WP-1354 Test to handle this in nightly cron automatically. Here, development is completed and yet to be tested.

WP-1428 - 1h
I checked this update. Nightly cron ran correctly and made updates.
Mapping table:
screenshot-8.png
Realtime page:
screenshot-9.png

WP-1289 - 4h
I am working on the issues.
District 7 :
I checked the new report for district 7 in production. I can see the data. Please check.
screenshot-53.png
District 15 :
PM bus numbers are not correct. So, we are missing arrivals in new report.
screenshot-54.png
We have this issue with 'All school planned arrival report'. That has impact on the new report and regular plan version of the new report as well.
screenshot-55.png
I am looking into the issue.


14-Nov-2019
-----------
WP-1354 - 2h
Testing with Suhas.

WP-1452 - 5h
I am working on this issue.
I have deleted duplicate records from district 15 in production.
Looks like, these duplicate records are created by zonar cron . I am looking into the issue.


15-Nov-2019
-----------
WP-1452 - 7h
I worked on this issue.
This issue is happening because of zonar nightly cron. I believe, Riteway was a contractor for district 15 zonar in part. Now, it is not part of district 15 zonar. But, somehow, the past vehicle details of Riteway, are getting saved in current_position table due to a bug in code.
I have addressed this issue zonar cron and released to production. It is working fine in production.
Need to observe it in production for couple of days.
Realtime page:
screenshot-1.png
History page:
screenshot-2.png
Currecnt Position table:
screenshot-3.png

WP-1454 - 1h
I have started looking into this issue.

===============================================

19-Nov-2019
-----------
WP-1354 - 2.5h
This is promoted to Production. And, it is working fine.
Admin units ware automatically created by nightly cron based on zonar api location. And, buses were saved to respective admin units.
Admin units:
screenshot-4.png
Realtime page:
screenshot-5.png
Suhas Shetty, please take a look.

WP-1452 - 1h
I checked this issue in production today.
There are no duplicate entries in current positions table for district 15 & 46.
Current Position:
screenshot-4.png
Realtime page:
screenshot-5.png
History page:
screenshot-6.png
It is working fine. We can close the ticket.

WP-1453 - 1hr
I looked into this.
I used the credentials in staging and tested. It is working fine.
We can update this in production.

WP-1454 - 3h
I am looking into the issues.

20-Nov-2019
-----------
WP-1453 - 1.5hr
I looked into this.
I used the credentials in staging and tested. It is working fine.
We can update this in production.

WP-1454 - 6h
I am working on this.
#1 I have addressed this issue in new arrival report.
screenshot-1.png
#2 Missing arrivals for Midday routes. I am looking into this issue.


21-Nov-2019
-----------
WP-1454 - 7.5h
I am working on this.
#2. I checked this issue. We are missing midday arrivals due to two different forms for midday(MD & MID) in route value.
For example, Bay View HS
screenshot-3.png
We have arrival for "9010 MD OUT" and it is not appearing on the report.
school arrival db:
screenshot-4.png
Bus 0085SC ran on "9010 MD OUT" based on bus_route_info table.
screenshot-5.png
Bus 0085SC is not shown in new report for route "9010 MD OUT" and we are also missing its arrival. This is because, we have "MID" in bus_route_info and "MD" in planned activities
screenshot-6.png
and buses_assigned_to_school db tables.
screenshot-7.png
Which one is correct either "MD" or "MID"? and should it be corrected in db table or should we handle this in program to consider both "MD" & "MID" are same. Ryan Hill, please confirm.


22-Nov-2019
-----------
WP-1454 - 7.5h
I am working on this.
#2. As we discussed, I have updated district 15, 20 & 46 routes value from "MID" to "MD" for 11/08 in bus_route_info table. After this update, I started seeing assigned bus number for midday routes in new report and also its arrivals.
screenshot-9.png
Still we are missing arrival for 0085SC, that I am looking into the issue.
#3 Missing plan data eg 9009 MD OUT for Audubon HS. I checked this issue. We are missing the plan from db stored procedure. I will discuss with DBA Karthi on thi.
Sometime, we are missing the plan in All School as well. DB stored procedure results are not stable here. I will check with DBA Karthi.
All school without 9009 MD OUT plan
screenshot-10.png
Individual school with 9009 MD OUT plan
screenshot-11.png


23-Nov-2019
-----------
WP-1454 - 7.5h
I worked on this.
#2 Once WP-1470 Ready for Production is completed, then it will be resolved.
And also, I checked the missing arrivals of 0085SC. This is not an issue, the arrival is filtered based on 30 mins arrival filter value. We can see this arrival by increasing arrival filter value to 45 mins in new report.
screenshot-12.png
#3 I discussed with DBA Karthi and worked with him. This is fixed now. Stored procedure gives the plan data consistently.
Audubon HS school only:
screenshot-13.png
All schools:
screenshot-14.png
#4 Missing arrivals of buses without plan in all schools version of the new report. There was a bug in code. This is addressed.
screenshot-15.png
Updates are available in PrePro. Suhas can test this new report.
We need to apply the fixes to other two report.
1. Individual School : Planned buses
2. All Schools : Planned buses vs. planned times

=================================================
25-Nov-2019
-----------
WP-1454 - 7.5h
I am working on this.
"Regarding this arrival filter - this should not be filtering out the planned arrivals - the planned arrival should still be showing, but the actual arrival should be blank."
I am not following this. Should we not apply arrival filter to planned arrivals in new report? Will discuss.
screenshot-16.png
Milwaukee Spanish Immersion:
Individual school : We have one plan route for this school based on planned activities db table.
screenshot-17.png
All school : It has to show one plan route in UI. But, it was showing other school routes. We have difference in school number.
Db link:
screenshot-18.png
This is a bug and I have addressed this issue in all school version.
screenshot-19.png
We are seeing "SC" only for unassigned bus's route numbers. We get these route numbers from school arrivals db table.

26-Nov-2019
-----------
WP-1464 - 3h
I looked into this.
I tried stopping zonar import from super user (root) and starting from wtbuser account many times in app server. But, It did not work out. It was giving permission denied error.
I let the zonar import continue running from super user account.
I will check with Vijendra and proceed further here to run from wtbuser account as it was running earlier before server restart.

WP-1324 - 4.5h
I am working on this.
#5. I am working for new UI to show the past tablet assignment history. And, I also need to link this new UI to MDT Mgr. History button  after "Unassigned MDT". 
Just  to confirm, we are showing "Bus Mgr. History" (vehicle logs) link only to below users. 
- Super Amin
- District Admin
- Trans Manager
- Technician
- Real-Time Only with Bus Manager
And, same access privileges  should be applied to show MDT Mgr. History button correct?


27-Nov-2019
-----------
WP-1454 - 4h
	I am working on this.
	I checked the duplicate issue for 1287RW bus in new report. Bad data of 1287RW is the root cause of this issue. We have duplicate entry for 1287RW bus in bus_route_info table.
	screenshot-20.png
	Bus 1287RW belongs to district 46 and it is expected to have entry in bus_route_info table only for district 46. We had entry for district 15 as well. This is incorrect data in bus_route_info table. I have deleted incorrect entries of 1287RW from bus_route_info for 11/04. And, new report is working fine now.
	screenshot-21.png
	I discussed bus_route_info issue with Prakash P. He found this is related to WP-1452 Done . We do not have incorrect records for district 15 with district 46's bus numbers after we fixed WP-1452 Done .
	db url
	screenshot-22.png
	We need to clear bad data of all district 46's buses from bus_route_info table for district 15.

WP-1324 - 3.5h
I am working on this.
#5 I have completed new UI for tablet assignment logs like vehicle_ids log.
http://staging.wheresthebus.com/admin/tablet_assignments_log.php?district=24
Need to work on linking UI to "MDT Mgr. History".

28-Nov-2019
-----------
WP-1464 - 3h
I worked on this.
I discussed with Vijendra. This is fixed now. Zonar import are running correctly from wtbuser account.

WP-1454 - 1.5h
This is promoted to production. And, it is working fine.
Suhas Shetty, please check.

WP-1324 - 3h
I worked on this.
#5 This is completed. New page is linked to "MDT Mgr. History" button from table pages.
Updates are available in staging.
Suhas Shetty, can start testing.

=======================================
03-Dec-2019
-----------
WP-1454 - 5h
I worked on this.
Wrapping issue with route number is addressed. Route number spacing was same like bus number and route number did not have enough space. Now, it doesn't wrap. Update is available in PrePro.
Report:
screenshot-23.png

WP-1379 - 0.5h
I just checked this.
ShowOpen API is still not working.
Ryan Hill, Can we put this ticket on-hold bucket?

WP-1420 - 1h
I have started looking into this.


04-Dec-2019
-----------
WP-1454 - 0.5h
This is release to Production and working fine.
New report date wrapping fix:
screenshot-26.png
New report route number wrap fix:
screenshot-27.png


WP-1420 - 7h
As discussed, I have updated sql query to use assigned_route column to check route assignments from geozones.
1. Now, missing swap buses appear in the school view page.
screenshot-5.png
2. This works with normal bus as well.
Link:
screenshot-6.png
3. I could not check the cover bus as there is no such assignments currently.
4. Sub bus is not working correctly. It shows the bus that is not running for the day.
Eg. Bus 543 is subbed for 316 in route 2539. It shows bus 316 instead of bus 543.
School view:
screenshot-7.png
Vehicle_ids table :
screenshot-8.png
Note:
Sub bus issue is not due to the change in sql query column from 'route' to 'assigned_route'. This is not working in production as well.
School View:
screenshot-9.png
admin Ryan Hill added a comment 

05-Dec-2019
-----------
WP-1420 - 7.5h
I worked on this.
We are missing sub bus 543 in school view sql query results. That's why, sub bus is not appearing in the UI.
screenshot-11.png
We are missing sub bus records in result set due to route filter on school route assignments. This filtering should be happening on php logic in order to work correctly for sub bus. Hence, I removed the route filter from sql query and implemented in php logic. Now, sub but is working correctly.
School View Sub bus:
screenshot-12.png
Removing route filter from sql and new php logic is not affecting swap bus. It works correctly.
School View:
screenshot-13.png
Above changes are only for district 31.
I had discussion with Ramesh S on above updates.
Is there separate logic for district 31?
There is no separate logic for district 31 sub buses. This wasn't working due sql filter.



06-Dec-2019
-----------
WP-1489 - 5h
I worked on this.
I had discussion with DBA Karthik. There was an issue with size of route numbers parameter to stored procedure. This is upgraded now. And, it is available in production.
Now, I am getting results from stored procedure. I checked, it is working for all the contractors.
Dairyland Buses:
screenshot-2.png
Durham Buses:
screenshot-3.png
Suhas Shetty, please check.

WP-1420 - 1h
I checked this working correctly.
We can push it to Suhas Shetty for testing.

WP-1324 - 1.5h
I worked on this.
'MDT Unit Number' is changed to 'MDT Number' in edit tablet.
Issue with showing 'MDT Number' & 'Note' values in edit tablet, is addressed. This is due to some code conflict in staging's common php script file.
screenshot-9.png
Suhas Shetty can do testing.

=======================================
09-Dec-2019
-----------
WP-1492 - 5h
I am working on this issue.
Below list(db link) of buses were marked as manaully_removed.
screenshot-1.png
I have corrected it in db table and ran the cron. Now, it is working correctly.
screenshot-2.png
I am not sure how it happened. Need to check the logic and code.

WP-1486 - 2h
I have started looking into this.

10-Dec-2019
-----------
WP-1486 - 6h
I am working on this.
I have come up with a plan to work on this. I will discuss this plan with Vijendra tomorrow.
1. UI updates in school admin page to save settings value like parameter, email, etc.
2. Process to monitor gps messages and save speeding alerts to new db table 'speeding_alerts'.
3. Process to send email alerts to users by reading from speeding_alerts db table.
#1 UI updates:
a. Need to add 'Has Speeding Alert' option in 'Early Release:'. So, the districts enabled with this check box option, will be tracked for speeding alerts.
b. Need get X & Y values below 'Has Speeding Alert'.
c. Need to add 'Speeding Emails' section with 'Send mail' option & 'From Address' dropdown selection.
d. Need to add 'Send Speeding Emails To:' section below 'School District Settings' section to get comma separated Email ids. This is accessible to district users.
#2 Monitoring & Saving Process:
We can have a db stored procedure, which will be called by php script at a fixed time interval(Eg. every 5mins) to monitor & find the speeding alerts that meet both X &Y parameter values and it will save them into speeding_alerts db table. I had discussion with DBA Karthik on this.
#3 Sending email alerts:
we need to create a php process to check for new alert and send email notifications independently.
New db table 'speeding_alerts' structure. We can add if anything is required.
screenshot-1.png
Eg. data.
screenshot-2.png

WP-1442 - 1h
Ryan Hill,
As we discussed, I have reverted the code in production. Now, history page loads the current day data.
Before revert :
screenshot-12.png
After revert :
screenshot-11.png

11-Dec-2019
-----------
WP-1492 - 6h
I am working on this.
I not able to reproduce this issue in staging. I will continue looking into this.
One thing, I am think that deleting the buses from the bus manager UI, this will also mark as manually deleted.

WP-1486 - 1h
I discussed the plan with Vijendra.
#1 & #3 will be done in php side.
#2 Vijendra wants to have this on UDP side. Java code will save the speeding alerts to new table. Karthika Palanisamy is off today, we will discuss with her once she is back to work.

12-Dec-2019
-----------
WP-1492 - 2.5h
I looked into this.
I checked above buses. And, I have corrected manually_deleted to 0 and ran the cron. 
Now, they are appearing in the realtime page.
 !screenshot-3.png|thumbnail! 
I could not reproduce the issue in staging. We can close this ticket.

WP-1486 - 5h
I had a discussion with Vijendra & Karthika together on this. We have come up with an approach. Tomorrow, we will have call with you after php updates and discuss more on this.
#1 I have started looking into this.

12-Dec-2019
-----------
WP-1486 - 7.5h
I am working on this.
#1 This is in progress. I am working in local.
#1 Update on UI work. Working on functionality.
screenshot-3.png
screenshot-4.png

=================================
16-Dec-2019
-----------
WP-1324 - 1.5h
This is promoted to Production. And, it is working fine.
1. Valid mdt_unit_number is being displayed for the respective imei_number as mentioned in the file.
2. Reported issues in the staging environment are working fine in production.
3. For testing purpose, I have added one data & has been deleted after testing, valid data is being displayed in the UI & tablet_info db table.
screenshot-10.png
Edit Page:
screenshot-11.png
Tablet Log:
screenshot-12.png

WP-1486 - 5h
I worked on this.
#1 I have completed this and promoted to staging.
Do we need to show any default value to '# of consecutive messages' and '# of mph above speed limit' settings in UI?
screenshot-5.png

17-Dec-2019
-----------
WP-1486 - 7h

- Discussion with Vijendra & Karthika. --
- Example for one email alert for long time overpeeding . --
- New DB table creation -- 
- Karthika to add/alter table. --
- Working on functionality. --

18-Dec-2019
-----------
WP-1486 - 7h
I am working on this.
I have completed the functionality. Updates are in my local. I will promote this to staging and test with some sample data.
Email content is given below like the one we have for geozone alert. Please check.
Subject : Over Speeding Alert : Bus 101.
Body:
Bus 101 has committed over speeding - <geo location detailes> location at 10.30AM.
<Link to realtime page to track the bus>
Need to setup a cron speeding alert notification like geozone alert. Can we run speed alert check once in every 5 mins?
screenshot-6.png

19-Dec-2019
-----------
WP-1486 - 7h
I worked on this.
I have implemented new updates to the email notification. I have added two new db columns 'Speed' & 'SpeedLimit' to new db table speed_alerts. Karthika Palanisamy, please populate value for these two new columns as well.
I have added a cron to run the speeding email notification.
screenshot-7.png
I added test speeding alert into db table and tested the functionality by running cron in staging environment.
screenshot-8.png
It is working fine and received email notification on speeding alerts from AWS email service(SES)
screenshot-9.png
Suhas Shetty, can start testing once WM-607 Develop is completed.

20-Dec-2019
----------
WP-1486 - 1h
This update is done.
screenshot-10.png

WP-1472 - 5h
I have started looking into this.

======================================
24-Dec-2019
-----------
WP-1472 - 7h

I am working on this.
I have listed the things need to be done here.
1. Ability to run multiple reports concurrently.
2. Allow only X number of report/realtime/history pages can be opened concurrently.
3. Ability to find user closes browser window while request is being serviced(on page load)
#1. As discussed earlier with Vijendra, this can be done by explicitly releasing the lock in required pages.
#2. Just to confirm, once the concurrent pages are served, then user can open other report/realtime/history pages. We need to configure X parameter and need a logic to serve only X number of pages at a time. This needs to be implemented in required reports, realtime & history pages.
#3 I checked this. Looks like, we don't have method in php script to find tab/browser closure while it is being served(on page load). I will discuss with Vijendra on this.


26-Dec-2019
-----------
WP-1472 - 7h
I am working on this.
#2 It is little challenging to track the status of 3 concurrently running report pages and to put 4th report on hold if X is parameter value is 3. I got the logic to implement this. It is check the status of concurrently running report pages at selected time interval say for eg. 10 secs (configurable) based on their status, we will decide to allow/hold other new reports execution. I have done some sample scripts on this. Currently, I am testing this one and will implement it for few reports along with #1. We will check that and then I will move on to implement it for other reports.
#3 I did not get time to discuss with Vijendra today.

27-Dec-2019
-----------
WP-1472 - 7h
I am working on this.
#2 I tested sample scripts. It is working fine. But, when I implemented the logic in few of the arrival reports, it is not working as expected. I am unable to track the status of running reports. I am debugging this issue. 

==============================
02-Jan-2020
-----------
WP-1472 - 5h
I am working on this.
#2 I worked on addressing the issue with tracking the status of running reports. I will implement it for some reports and test. Then, will promote them to PrePro for your testing.

WP-1514 - 2h
I have done code review with Savitha and I have 2 concerns.
1. New db column 'cur_time' is created to save the expiry time of forgot password hash key. This new column is not required as expiry time is already being a part of hash key and which can be decoded to fetch expiry time.
2. Please rename new db column from 'hashkey' to 'forgot_pwd_hashkey'.
Will this impact the forgot password process from the parent apps using the iOS and Andriod apps?
Need to discuss with Mobility Team.
I helped Savitha and addressed the issue with decoding hash key and fetching expiry time.

WP-1342 - 30 mins
Ryan Hill,
I checked Synovia_data_information and zonar_data_information db tables. We do not need to archive these tables. We can delete the old data.

WP-1420 - 30mins
Suhas, as discussed, looks like my updates are overwritten in PrePro. I will do code merge there, then you can continue testing.

03-Jan-2020
-----------
WP-1420 - 1h
I checked this issue in PrePro. This is due to code clash from WP-1513 Test . I have merged my updates back to srider page in prepro. Now, it is working.
http://prepro.wheresthebus.com/mobile/srider.php?district=31&uid=6caf77f0-3f8f-11e2-8ecb-404093141f8e&sid=117656
screenshot-14.png
Suhas Shetty, please continue your testing.

WP-1519 - 2h
I checked this one.
I worked correctly. Bus 29032 got updated with new gps id 8520139 in nightly cron. [Vehicle ids|http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=vehicle_ids&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=55&where%5B01%5D%5Bcol%5D=BusNumber&where%5B01%5D%5Bop%5D=%3D&where%5B01%5D%5Bval%5D=29032&where%5B011%5D%5Bcol%5D=&where%5B011%5D%5Bop%5D=%3D&where%5B011%5D%5Bval%5D=&order%5B0%5D=&limit=50&text_length=100] db table.
 !screenshot-1.png|thumbnail! 
This bus appears in realtime page. 
 !sreenshot-2.png|thumbnail! 
This bus is available in Dattco admin unit as well.
 !screenshot-3.png|thumbnail! 
This works fine. Nothing required here.

WP-1514 - 1h
Ryan HillI had discussion with Abhishek Parihar.
New validation implemented in php to restrict sending multiple forgot password request emails in short time. This update will not impact the forgot password process from the parent apps using the iOS and Andriod apps.
Suhas Shetty, please check forgot password functionality for mobile browser version as well.

WP-1472 - 4h
I am working on this.
#1 This is done for below 4 reports.
#2 As discussed earlier with Vijendra, we mark the status of a report in session when the report is opened and we will update the status of that report once its execution is completed.
I worked on implementing the new fix for report tracking issue. This is done for below 4 reports. For testing, I have set 2 as max report pages can be opened at a time. If we open 3rd page, it will be in wait state.
All Schools Arrival Reports :
1.All bus arrivals vs. bell times (interactive, any date range)
2.Planned buses vs. bell times
3.Planned buses vs. planned times
4.Student Reports: Single day detail (please check for district 15 - student_rfid_report_summary.php)
Updates are in Prepro.
Ryan Hill, Please check. I can implement this approach to other pages if this is good.

===============================================
06-Jan-2020
-----------
WP-1515 - 6.5 h
I am working on this.
My understanding is, so far we are giving user access to modules based on role. Going forward, we need to give user access based on module permission granted to the user rather than role based. We are going to introduce this feature for district 31 first and it would be given to other districts in future.
I worked on this and have come up with a plan.
1. Need to introduce 'HasUserSpecificAccess' check box in school district setting.
2. For the districts enabled with #1, we need to show new column 'Permissions' in 'Manage Users' UI section. This new column will be a multi select drop down and we will show modules to be granted to users like 'Employee'.
3. Need to create a new db table to save user Vs module permissions. I need to work little more on this. It will be like geozone Vs bus assignment db table(buses_assinged_to_geozone_alert) for geozone alerts.
4. Need to update 'Employee' button code in realtime page. So that, this button will work normaly to other district and this button will be shown for district 31 only if user has access to 'Employee' module.
Just to confirm, we need to give exclude super admins from above permissions.

WP-1472 - 1h
I have prepared a test case here. will discuss that in the call.

07-Jan-2020
-----------
WP-1486 - 1h
Worked with Karthi on testing speeding alerts

WP-1515 - 6.5h
I am working on this.
#1 This is completed. Added new setting 'Has User Specific Access' to school setting page and saved in db table.
 !screenshot-1.png|thumbnail! 
#3 I worked on new db table design and created the table.
Update are in my local.
Next, I will work on #2. Need to capture user Vs module permissions via school setting UI and need to save them to new db table.

08-Jan-2020
-----------
WP-1515 - 7.5h
I am working on this.
Worked on configuration & common code for district and modules associations.
#2 This is in progress. Since we have 'Permission' column in UI table, I added new 'Access' column add new use section. Working on saving the data to new db table. Next, I will work on edit 'Access' functionality in manage user UI table.
screenshot-2.png

09-Jan-2020
-----------
WP-1522 - 7.5
I am working on this.
I have set up this zonar import for this new district like district 62.
I have enabled auto admin unit creation for this new district like we have in district 62. So, admin units will be created/ updated based on zonar location name and buses will be saved to the admin unit.
I have done the setup in staging and it is working fine.
Mapping table:
screenshot-1.png
Vehicle_ids:
screenshot-2.png
School setting page - Admin units :
screenshot-3.png
Realtime page : No bus icons as we don't have gps locations.
screenshot-4.png
I am working on importing gezone data from zonar.
I worked on this.
"Unknown" admin unit is deleted.
screenshot-7.png
I imported geozones from zonar for district 67 using same logic from WP-1282 Done .
Totally, 937 geozones are imported.
screenshot-5.png
Categories are strange in district 67, so all the geozones are marked as Trip Destination as per current logic.
Geozone UI:
screenshot-6.png
Updates are in staging. Ryan Hill, Please check.
Let's plan to get the GPS side of things to production tomorrow so that we start collecting this data
Currently, we are not getting GPS data from zonar API. We shall monitor in production.

10-Jan-2020
-----------
WP-1522 - 5h
I worked on this.
I have done district 67 zonar setup in production. It is working fine.
I ran the nightly cron manually and checked the results. We got 97 buses from zonar.
Mapping table:
screenshot-8.png
Vehicle table:
screenshot-9.png
Buses are correctly saved to admin units.
School setting page
screenshot-10.png
I checked the GPS data import. Now, we are getting data form zonar api.
screenshot-11.png
I did not import zonar geozones for district 67.
Nothing else is required here.

WP-1523 - 0.5h
I have done the code review.

WP-1515 - 1h
I will continue wokring on this.

=========================

13-Jan-2020
-----------
WP-1515 - 7.5h
I worked on this.
#2 This is in-progress.
a. Completed add functionality. Assigning modules to users and saved to new db table.
b. Completed listing saved user module assignment in UI table.
screenshot-3.png
c. Working on edit assignments functionality and delete functionality on user delete option.
Updates are in my local.

14-Jan-2020
-----------
WP-1515 - 7.5h
I worked on this.
#2 This is completed.
c. Completed edit assignment UI and functionality. 
 !screenshot-4.png|thumbnail! 
And, also we need to delete the assignments when user is deleted from UI table. This is completed.
 !screenshot-6.png|thumbnail! 
#1, #2, #3 are completed. These are configurations, settings, capturing data related work. Next, I will move and start working on #4, where we will enforce restricting user access to 'Employee'.
#4 I have started looking into this.
I hope I will complete this by tomorrow.

15-Jan-2020
-----------
WP-1534 - 1h 
Worked on zonar issue.

WP-1515 - 6.5 h
I worked on this.
#4 This is done. I have implemented access control for 'Employee' button in realtime page. This is only for district 31.
School setting :
screenshot-7.png
2Test@trigent.com - User with no access to 'Employee button'
screenshot-8.png
1Test@trigent.com - User with access to 'Employee' button
screenshot-9.png
Updates are in staging.
ote: Access control is based on logged in user. So, please do login once if you are not seeing the update.
UI clarification on Access input:
We have used multi-select dropdown to select one or more accesses. Select and De-select can be done using 'Cntrl Key' + Mouse selection, this is standard practice in web application.
screenshot-10.png
We can discuss more on the call.

============================
20-Jan-2020
-----------
WP-1515 - 7h
I worked on this.
Regarding Suhas reported issue:
Actually, there was no issue in implementation. In staging environment, Pritha had overwritten my code in bus realtime page when she promoted her changes there on 01/16. I put my code back to realtime page. Now, it is working fine.
Setting page;-
screenshot-11.png
Realtime page:-
screenshot-12.png
Observation on user's access without log out:
I have updated the logic. Now, checking user access to a module, will be performed when they open the page.
Updates are in staging.

21-Jan-2020
-----------
WP-1534 - 1h
We had a discussion with Vijendra on automating post app server restart process which is currently being done manually.
I have shared details with Vijendra. He will look into that.
 [^Re  App Server Restart - Automating post restart process..eml] 
I have attached the email from Mozilla Thunderbird Email Client. Please let me know if you face problem in opening the attachment.

WP-1420 - 6h
I worked on this.
I have addressed the issue with missing 914PT bus. There was an issue with getting route numbers for a school. This issue is from my end and not from WP-1513.
[Srider page:|http://prepro.wheresthebus.com/mobile/srider.php?district=31&uid=3f998cc3-556a-11e8-8e24-f23c9173ec9c&sid=110067]
 !screenshot-15.png|thumbnail! 
I have merged my updates with Ramesh's updates for WP-1513 in prepro.

22-Jan-2020
-----------
WP-1514 - 2.5h
Helped Savita to address observation.
There was an issue with handling special characters in encryption/decryption methods which generates the hashkey. I have addressed this issue and update is in staging.
Since, php encryption/decryption methods are used by parent apps as well. We need to test their current forgot password functionality once.

WP-1515 - 4h
I am working on this.
#1. I checked the issue. This is not related to the new employee button updates.
#2 I have not made any changes to add attendance functionality. We are facing this issue due to communication error with Java API in staging. I will check with Karthika.
screenshot-13.png
#3 I will look into this.

23-Jan-2020
-----------
WP-1420 - 30m
This is promoted to Production. And, it works fine.
Suhas Shetty, please check in production.

WP-1515 - 5h
I worked on this.
#2 I checked with Karthika and tomcat service is started in staging. Looks like, this can be tested in PrePro.
#3 I have done the excel updates.
screenshot-14.png
Suhas can do a round of testing.

Note: I spend some time in server load issue today.

WP-1551 - 2h
Worked on server load issue.

24-Jan-2020
-----------
WP-1515 - 1h
This is released to PrePro. And, it works fine.
Suhas Shetty, please check.

WP-1551 - 1.5h
Based on yesterday's geozone_querys.csv from Prakash, I have a suggestion here to prevent table level lock in future. Geozone db table uses MyISAM engine where other tables have InnoDB engine.
screenshot-3.png
MyISAM locks entire table while performing its operations called table-level locking, where InnoDB locks only the required rows called row-level locking. In this way, yesterday, most of the queries went into wait state "Waiting for table level lock" for a very long time, becuase of table-level locking performed by MyISAM engine.
We need to figure out,
1. Why do we have MyISAM engine for geozone table.
2. Based on #1, we need to find the possibility to migrate gezone db table from MyISAM to InnoDB.
Need to work with DBA on this.

WP-1547 - 5h
I have started looking into this.
I have some clarifications. will discuss in call.
Just to confirm,
1. New school admin setting to enable/disable whole "Child Check" report section correct?
2. We need to get event code 92 messages from daily_events_XX for this report correct?
3. Based on given report parameter, there are start & end day select. Since, it is single day report, do we need end day input?
screenshot-1.png

===============================
28-Jan-2020
-----------
WP-1513 - 2h
Today, we released WP-1525 Ready for Production , WP-1513 Ready for Production & WP-1525 Ready for Production ticket.
Ramesh S, Suhas Shetty and I worked on load test starting from 4:15AM EST. Altogether, we opened more than 200 srider pages concurrently. Queries from srider were not piled up and not shown in slow queries list.
As we intentionally did a load test, we got cpu spike to 99.5%. We feel like this is due to more number of queries in parallel and not due to query's execution time. Below, Csv was captured when we had spike on cpu.
db_server_queries_04_30_AM_EST.csv
New updates are in production and we expect no load on cpu from srider page.
We are monitoring server load. So far, the load is normal.

WP-1420 - 0.5h
This ticket WP-1420 Ready for Production is promoted to production along with two other tickets WP-1513 Ready for Production & WP-1525 Ready for Production . And, it works fine.
We will do a load test on this.
Suhas Shetty, please check.

WP-1515 - 0.5h
Production release done.

WP-1547 - 4h
I am working on this.
We need to work on below items.
1. School setting update for new setting
2. New report "Single Day Detail" report in "Child Check" report section.
3. Bus realtime page updates to show new report like Rider List report.
4. Bus History page updates for selected location from new report.
#1. This is completed.
#2. I have started working on this.

29-Jan-2020
-----------
WP-1547 - 6.5
I am working on this.
#2 This is in progress. Just to confirm,
a. We need to consider 00:00 to 11:59 for AM and 12:00 to 23:59 for PM.
b. We need to show rounded off minutes in date column.
screenshot-2.png 

WP-1555 - 0.5h
Done code review with Savitha.

30-Jan-2020
-----------
WP-1547 - 7h
I am working on this.
#2 This is completed. Will look into excel once the data is correct.
a. This will be taken care when I work on Bus Realtime update.
b. This is handled.
Updates are there in staging.
New Report:
screenshot-3.png
I copied production data for 01/01 to staging for district 31. It got minimal records. Do we have any districts that send more event code 92.
#3 I have started to look into this.

31-Jan-2020
-----------
WP-1547 - 7.5h
I am working on this.
#3 This is completed for old realtime page. New report is added to realtime page like rider list.
Realtime page:
screenshot-4.png
screenshot-5.png
I am working of new realtime page.
#4 I will look into this next. Will discuss with Ramesh S on this.

=====================================
03-Feb-2020
-----------
WP-1534 - 2h
I worked on app server restart with Vijendra and tested the automation of post restart processes.
We had some issues in automation . Those were addressed and tested.
Gearman ports and zonar process were automatically started after app server restart. And, they are working fine.
App server is working fine.
screenshot-3.png
Update on automation time:
1. Gearman ports will be started from root after 30 seconds.
2. Below command will be executed from wtbuser after 6 mins.
sh /var/www/wheresthebus.com/code/scripts/startMacroZonarWorkers.sh
3. Below command will be executed from wtbuser after 7mins.
nohup php /var/www/wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/wheresthebus.com/logs/zonarproces.log &

WP-1547 - 5h
I am working on this.
Implemented the new report in both Bus realtime report section and reports page.
screenshot-6.png
screenshot-7.png
#3 Working on implementing the new report in new bus realtime page. I am facing some issues with showing popup in new realtime page. Will update here once it is addressed.
#4 I had discussion with Ramesh on this. I can link the bus history page url to the location column but, looks like, it needs additional updates on history page. Need to discuss more on this with Ramesh.
#3 New report is implemented in new realtime page.
screenshot-8.png

04-Feb-2020
-----------
WP-1547 - 5h
I worked on this.
#4 This is completed.
As we discussed yesterday in the call,  when the location is clicked from new report, we just need to zoom to the child check location and highlighting is not required. I had discussion with Ramesh on this. 
 !screenshot-9.png|thumbnail! 
#5 I worked on export to excel and completed it.
Updates are available in staging.

WP-1558 - 2h
Had discussion with Vijendra & Prakash. We have come up with high level plan.
We will have new db table.
shared_buses_between_district.xls
In school admin page, we will have a new section, where we will can assign comma separated bus numbers to a district. There will be separate rows for each district like we have bus assignments to admin unit.
Ryan Hill as we discussed in the call today with Vijendra,
1. We need to have code for the districts and that we need to append to the shared bus number.
2. There won't be report for these shared buses.
3. Bus history page will work for current day data for the shared bus.
4. Bus history page will work for past day data for the shared bus only if the sharing(assignment) exists in new db table.
I will look into this more tomorrow.

05-Feb-2020
-----------
WP-1558 - 7 hr
I am working on this.
I had discussion with Ramesh S.
Confirmation :
1. We will pass original district id & bus number in history page url like we do for merged district.
2. We need show formatted bus number(district code at the end) in history page as it is shown in realtime page.
Questions:
1. Are we going to share only route buses to other districts?
2. If sub bus runs for an inactive route bus which is shared to other district. What we need to show in other district?
Looks like, implementing this new feature in BusRealtime page would be complex one. I will take DBA help for the sql updates.

WP-1547 - 30mins
Prepro release & test.

06-Feb-2020
-----------
WP-1547 - 30mins
Production release & test.

WP-1486 - 4h
I discussed with [Karthika Palanisamy|~accountid:5d3a5f7eaf1d920bc99785a1] on the things required WM-607 from PHP .
#2 This is completed the logic in local. I need to test this in staging tomorrow.
#3 This is completed in local.
I will test both #2 & #3 in staging tomorrow with Karthika.
I will help Suhas on testing tomorrow.

WP-1558 - 2h
I could not get much time to work on this today.

07-Feb-2020
-----------
WP-1486 - 4h
I worked on this.
#2 Promoted this to staging and tested the functionality with [Karthika Palanisamy|~accountid:5d3a5f7eaf1d920bc99785a1]. It is working fine.
#3 I have setup the cron and invoked SP provided by Karthika. It works fine.
 !screenshot-11.png|thumbnail! 

WP-1558 - 3h
I worked on this.
Created db table & added new colun in district table.
Working on school admin UI.

===========================================================

10-Feb-2020
-----------
WP-1486 - 30m
Worked with Suhas on testing.

WP-1558 - 7h
I am working on this.
Worked on school settings page UI stuff.
screenshot-1.png
Add new transfer.
screenshot-2.png
I am working on add, edit & delete functionalities.

11-Feb-2020
-----------
WP-1558 - 7.5h
I am working on this.
I worked on add, edit & delete functionalities in school admin page. It is completed. Updates are available in staging.
Implementing access control is taken care for "manager transfer bus" in school setting page.
1. Only super admin can add/delete/edit districts.
2. District admin can only edit the share bus number.
District admin view:
 !screenshot-4.png|thumbnail! 
 !screenshot-3.png|thumbnail! 
Need to work on form data validation for "manager transfer bus" in school setting page. I will look into this later.
Now, school admin page correctly saves the share bus and district data in new db table. Based on these data, I can start looking into bus realtime page update.

12-Feb-2020
-----------
WP-1559 - 45m
I reviewed the code along with Savita K. I have below observation.
1. Please remove unused code.
2. Alignment for label got changed to left side after introducing new sticker number. Before it got right alignment.
staging:
screenshot-1.png
Production:
screenshot-2.png
We have right alignment for label in tablet manager(MDT Mgr).

WP-1579 - 1h
I looked into this issue.
Looks like, there was some issues in Zonar System API in providing GPS data for district 15 - Durham South contractor. That's why we received notification emails for this contractor.
I restarted zonar process. Now, it is working fine. But, we have automated this. Need to check the automation process.

WP-1558 - 6h
I am working on this.
I worked for Has Transfer Buses additional setting in school admin page. Update is available in staging.
screenshot-5.png
I have started looking into bus realtime updates.

13-Feb-2020
-----------
WP-1558 - 7h
I am working on this.
Managing admin unit:
Worked on creating needed admin unit when transfer bus assignment is made in school admin page. It is completed.
Creating new share bus assignment from District 3 for District 1 & District 7 in school setting page.
screenshot-6.png
Admin unit db table:
screenshot-7.png
Managing edit & delete operations are done for admin unit when there is an updates happen on share bus assignments to districts.
Restriction on edit admin unit:
Implemented restricting district people from editing their assignments in these new admin units created by system for share bus. They can not edit the admin unit name & buses number. But, they can edit the display order of admin unit.
I have given a tool tip to inform the restriction to the district people.
District 1:
screenshot-8.png
District 7:
screenshot-9.png
Updates are available in staging.

WP-1486 - 30m
I worked with Suhas on testing.
Is this ready to be promoted to production? Would Monday be a good day to promote this along with ticket https://wheresthebus.atlassian.net/browse/WM-607
Yes, we can promote this to production on Monday.
Can we promote this to PrePro tomorrow? we can not test speeding alert db data and email notifications. But, we can test the school settings page UI stuff in PrePro.

12-Feb-2020
-----------
WP-1486 - 45m
This is promoted to PrePro and works fine.
screenshot-12.png
Suhas Shetty, please check

WP-1558 - 6h
I am working on this.
Since we do not have text appended bus numbers(formatted bus number) stored in db tables like vehicle_ids, current_positions tables, we can not save formatted bus numbers in admin unit table. So, we need to save original bus numbers. But, we can show formatted bus numbers in admin unit UI of school admin page.
I have done this update in my local and testing it. I will promote to staging before end of the day.
We are using formatted bus numbers in realtime page UI and planning to do the logical things with original bus number.
I have started looking into real time page updates.
Update on admin unit's bus number format:
I have completed testing bus number format for admin unit. I had few bugs and fixed. It is promoted to staging.
District 1:
screenshot-10.png
Here, "WP" is the code appended to share buses with hyphen. This code can be changed from school setting UI. I have provided input box for this code.
screenshot-11.png
I have moved 'share_bus_code' db column to school_setting db table as we have this input in setting.

====================================

17-Feb-2020
-----------
WP-1486 - 45m 
Production releaase.

WP-1558 - 6.5h
I am working on this.
I have removed hyphen from 'School District Settings' section and also removed it from buses shown in admin unit. Update is available in stating.
District1
screenshot-12.png
Hyphen was used as a separator between bus number & district code. And, this is to help bus number parsing in UI.
I am working on realtime page updates. I have identified sql queries those need to be updated for transfer bus feature. I will check with DBA Karthi on this.


18-Feb-2020
-----------
WP-1563 - 1h
I worked on zonar issues caused by port number blocking from UDP server.

WP-1558 - 4h
I am working on this.
I have added code at the end of the bus number.
screenshot-13.png
I discussed with DBA Karthi on sql updates. I have shared the queries with Karthi. I will work with him tomorrow.
I will continue working on updates.

WP-1589 - 2h
I worked on this issue Ryan.
DB queries when we had PHP server issue again around 11.15AM EST.
DB_queries.csv

19-Feb-2020
-----------
WP-1589  - 3h 
I worked on this.
I found the long running query is from MDT's Student Log Report. I ran the same query in database in off business hours. It took 41 mins to complete and returned 112,262 records in result set.
screenshot-1.png
I discussed with the team about yesterday's server issues and sql query.
We have a ticket WP-1528 Develop for student log report which swarnim_d is working on. We can have him to optimize this query.
Suggestion from team:
Currently, user can select any date range. We can have restriction in student log report UI for date selection only to select max for a week period.

WP-1558 - 4h
I am working on this.
I had discussion with DBA Karthi and explained the expected results. He will work on the update.
Meantime, I can work on other updates in realtime page.


20-Feb-2020
-----------
WP-1558 - 7.5h
I am working on this.
I worked on logical updates. I completed the updates on php code. Next, I will look into javascript and other updates required on UI front.
I checked with DBA Karthi, he was not available today

20-Feb-2020
-----------
WP-1558 - 7.5h
I worked on this.
I worked on javascript & other updates required for bus realtime page.
I made a kind of static (hardcoded) data setup to take a look into realtime page.
District 1 school setting:
screenshot-14.png
District 1 - Realtime page:
screenshot-17.png
Link is given to Bus History for these transfer buses on left click.
screenshot-18.png
There are some alignment issues on left click popup menu. I will look into that address that.
Updates are done for old realtime page and if it works fine, then we can implement in new realtime page.
pdates are in my local.
DBA Karthi is off today. He will work on Monday.
I can further work on this task only after receiving the sql updates from DBA Karthi. Hence, I will move on to other tickets.

=======================================
24-Feb-2020
-----------
WP-1558 - 30m
I discussed with DBA Karthik. He is working on this. He may give the updated queries by tomorrow.

WP-1579 - 7h
- working on this
- need to update the automation script logic when a customer goes down when there are some issue in zonar systems
- I am working on automation logic.

25-Feb-2020
-----------
WP-1558 - 30m
I discussed with DBA Karthi. He is working on the updates.

WP-1579 - 7h
I worked on this.
I have completed the new updates required to the automation logic.
I want to do some kind of testing in staging environment before promoting to production. I will work on this.

26-Feb-2020
-----------
WP-1558 - 1h
I had discussion with DBA Karthi. I just received the updates SQL from him. 
Next, I will integrate them into application and continue working on this.
 
WP-1579 - 6h
I worked on this.
I promoted to staging and tested.
Initially, I had some issues in set up and execution in staging. Then, it worked fine.
Automation script is working fine with new updates.


27-Feb-2020
-----------
WP-1579 - 4h
This is promoted to production.
I tested automation script updates in  produciton. It is working fine.
Nothing left here.

WP-1599 - 1h
Worked Vijendra & Karthika on db load.

WP-1558 - 3h
I could not spend much time on this as I was busy with WP-1579 & DB server load issue.
I am working on this.

28-Feb-2020
-----------
WP-1558 - 7.5h 
I worked on this.
I have integrated the updated sql queries into application. Updates are promoted to staging.
screenshot-19.png
I did some testing and found few issues.
1. Left click on bus number is not working in staging.
2. As reported earlier(02/21), We have some alignment issue with bus number left click menu.
3. We need to show shared bus number with code in bus icon over the map in realtime page. eg: original bus number is 101 and code is 'WP', now it has to appear 'WP101' in bus icon. We need to create these new bus icons as part 'Manage Transfer Bus' operation in school setting page.
Note:-
Updates are done for old b

===========================================================

02-Mar-2020
-----------
WP-1558 - 7.5h - no jira
I worked on this.
1. This is working now. Looks like, someother updates affected this.
screenshot-21.png
2. I am working on this. I will take UI designer help if required.
3. This is completed. I worked on school admin page and added the logic to create new bus icons having bus code in the beginning. This is working fine.
screenshot-20.png
Updates are in staging.

03-Mar-2020
-----------
WP-1558 - 7.5h - no jira
I worked on this.
#2 I addressed the issues with UI alignments.
screenshot-22.png
Issue with showing the icon for route column value is fixed.
screenshot-23.png
Updates are available in staging.
Suhas can start testing this.



- Look into route column icon issue.
- Fix UI issue on bus number menu.







1486
----
21
102
55
12
155
7

1547
----
4
20
517
10
27
10
27
220
220



- Update number of lines. 
- Update leave plan. --


- Bus menu issue -- No code changes - started working fine.
- Bus menu alignment issue
- Bus icon creation 
- create master icon index values in ajax response.

Today:

- Install tortoise git tool
- Check git password provided by Vijendra.
- Deployement Script:
	- Fetch only delta change
	- Have parameter for version number and default value is latest version.
	- In staging, get separate application code base AND do your experiments there.


ps -elf | grep start_zonar
/usr/bin/php /var/www/wheresthebus.com/code/scripts/zonarMonitor.php

stopped at 4.7

Even I don't have access to check running process in production mysql database server. 

It was revoked as part of security tightening.


# LOGGING #
log-error                      = /var/lib/mysql/mysql-error.log
log-queries-not-using-indexes  = 0
slow-query-log                 = 1
slow-query-log-file            = /var/lib/mysql/mysql-slow.log
long_query_time                = 30
sql_mode = NO_ENGINE_SUBSTITUTION
sync_binlog = 0




nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/staging.wheresthebus.com/logs/zonarproces.log &

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping >> /tmp/zonar_assetmapping.log

ssh -i ppk barathkumar_n@172.31.2.181

eva muthula romba karuppa iruntha
epa ed
answ: fair & lovely may be someother foreign cream
- karthi off
- js logic completed.
- work further after sql query

- pritha ticket
- 


//WP-1558
is_shared_bus
$row['is_shared_bus'] != 1
originalBusNo = trim(data.originalBusNumber);
parent_district_bus = trim(data.parent_district_id);
is_shared_bus = data.is_shared_bus;

Note:
districtOnPage


Js
Keep only bus history on left click - remove/disable other option

http://devtrunk.wheresthebus.com/admin/bus_manager_v2.php?district=3
http://devtrunk.wheresthebus.com/district/BusRealtime.php?district=3

add parent_district_id, is_shared_bus to 'bus' div. 

Instruction:
- Send additional query to karthi.
- Restrict banner edit option. 




DBA
1. shared_bus_code, child_district_id, is_shared_bus




I made some updated in that table for my development item. It is missing.

2618-Feb-2020 01:24:09 - last process message
Tyring to connect to ActiveMqtcp://172.31.1.209:61613


Find the areas that need to be updated for transfer bus.


BusRealtime.php
line #130 $$BUS_TRACK_LIST, php function & sql
line #155 $ROUTE_TRACK_LIST, sql 

function calls:
getAllActiveBuses
getDistrictBusesByAdminUnit

js script:
allBuses
fBuses




## Run Every Saturday 1PM and cleans up old speeding alerts.
0 1 * * 6 php /var/www/wheresthebus.com/code/scripts/run.php clear_speeding_alerts

## Check send speeding alert notification every 5 minutes
*/5 * * * *  php /var/www/wheresthebus.com/code/scripts/run.php send_speeding_alert &>> /tmp/speeding_mail_alerts.txt

'code/public/admin/trans_admin_new.php' 'code/public/admin/bell_times.php' 'code/scripts/run.php' 'code/includes/classes/SpeedingAlert.php' 'code/includes/classes/BusDataChecker.php'

code/public/admin/trans_admin_new.php
code/public/admin/bell_times.php
code/scripts/run.php
code/includes/classes/SpeedingAlert.php
code/includes/classes/BusDataChecker.php




- appended '-code'
- code in setting section

showSpeedingPopupRow
showShareBusPopupRow

numConsecutiveMsgs
shareBusCode

$numConsecutiveMsgs
$shareBusCode

shared_bus_code

shared_district_id = '{$district}'
_

-
 
 

Tiger 1
ssh -i ppk barathkumar_n@172.31.2.38

Tiger 2
ssh -i ppk barathkumar_n@172.31.2.91

App YY
ssh -i ppk barathkumar_n@172.31.1.204

PHP 
ssh -i ppk barathkumar_n@172.31.1.198

Mysq DB
ssh -i ppk barathkumar_n@172.31.2.207

Access to tiger server for settting upUSA tiger data.


- add new column in admin unit to track transfer bus admin unit
- manager admin units 
- Restrict bus number edit in regular admin unit

promote to staging --
admin unit mgmt --
restricting user from unit name & buses edit --
added tool tip for that--
allowed to edit display order.--


helped suhas in testing.

reply on speeding alert.





has_transfer_bus
hasTransferBus
//WP-1558




Admin Units:
+
Standard process.
- 
Approach ie incremental number for add/update operation.
No delete operation
No validation

Geozone:
+
Accurate add/delete operation with random strig for new & db id for existing
-
Update should happen on submit button
No success message for update.

--------------
Observation:
--------------
Primarily follow admin units style.
Bring geozone concept for accuracy.
IMP:: Need to finish soon as it is straight forward in Customer point of view.


Form validation
Add operation -- 
 - Check super admin 
Edit operation
Delete operation
 - check super admin
 
 

deleteShareBus


validateForm
validateSharingForm

adminUnitTbl
sharingTbl

addShareBus

addShareBusBlock

enrollment_form
share_bus_form

form_id
share_bus_form_id

updateUnits
updateShareBus
Table : distric_shared_buses
id - auto incre
parent_district_id - not null
 - 
bus_number - null 
shared_district_id  - index - no null
 - child_district_id
created_by datetime - null 
created_on - datetime - null - default now


cleanSpeedingAlertRecords

CREATE TABLE `wtb_app_live`.`district_shared_buses`(  
  `id` INT NOT NULL AUTO_INCREMENT,
  `parent_district_id` INT NOT NULL,
  `bus_number` VARCHAR(15),
  `child_district_id` INT NOT NULL,
  `created_by` INT,
  `created_on` DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX (`child_district_id`)
);








prepro conflict
code/public/district/BusRealtimeReportMenu.php
code/public/district/BusRealtime.php
code/public/district/BusRealtime_new.php
code/public/resources/js/BusRealtime.js
code/public/resources/js/BusRealtime_new.js




RELOAD_SCHOOL_SETTINGS

'code/public/admin/trans_admin_new.php' 'code/public/admin/bell_times.php' 'code/public/admin/single_day_child_check.php' 'code/public/district/BusRealtime.php' 'code/public/district/BusRealtime_new.php' 'code/public/resources/js/BusRealtime.js' 'code/public/resources/js/BusRealtime_new.js' 'code/public/admin/reports.php' 'code/public/district/BusRealtimeReportMenu.php'




- Prepro release
- fix excel issue





school admin page


Bus history only if shared bus association is present in db.
No reports.
No other options in realtime page left click on bus except history option.



1. excel check
2. district merge
3. history page


http://prepro.wheresthebus.com/district/BusHistory.php?bus=0067SC&date=01/23/2020&day_part=AM&district=20&showRoute=0


&points=%2743.004194,-87.973552|43.006485,-87.970055|43.006563,-87.964862|43.003064,-87.965913|43.002483,-87.970763|43.001964,-87.968280%27

&centerLat=%2743.04813%27&centerLon=%27-87.979729%27

&zoomTo=%2716%27


ps -elf| grep gearman

php /var/www/wheresthebus.com/code/scripts/run.php check_bus_alt_voltage >> /var/www/wheresthebus.com/logs/cron.log



Student-Rider-List
Child-Check-List

Rider-List-Options
Child-Check-Options

Rider_List_AM
Child_Check_AM

Rider_List_PM
Child_Check_PM

Rider_List_DATE
Child_Check_DATE

buildRiderDetailsPopUp
buildChildCheckPopUp

getStudentData
getChildCheckData

studentRfidDiv
childCheckDiv

studentTopHeader
childCheckTopHeader

imgExportButton
CCimgExportButton

imgPrintButton
CCimgPrintButton

loaderDiv
CCloaderDiv

studentRfidData
childCheckData

studentRfid
childCheck

studentPopDivDefaultItems()
childCheckPopDivDefaultItems()

setStudentPopupHeight()
setChildCheckPopupHeight()


Pritha, WP-1480


jira tool.
daily Scrum meeting.
we update jira tickets.





- completed
- which district got event code 92?
- copied 01/07 data to staging
- 

http://app.wheresthebus.com/admin/student_rfid_report_summary.php?action=getDetails&bus=&routeNo=&adminUnits=&startDate=01/22/2020&district=7&non_student=0


am / pm
Need to show round off mins


merged districts buses
  - need to pass actual district id (34 and not 31)
  - running new report for all the buses for a merged district like 31 - showing both 31 & 34 buses & its data approach - yet to be decided.
minute round off --
Apply filter -- 
Fix UI issues - 
  - Width --  
location linking 
AM / PM / ALL filter --
Merge school admin changes to staging --
Bus realtime page --
Bus history page -
report section
code clean up --


$hasUserSpecificAccess
$hasChildCheck

hasUserSpecificAccess
hasChildCheck

has_child_check




WP-1547
settings - 0.5
report - 1.5
bus realtime page 0.5 
history page 0.5



















- release -
- Ramesh & I worked on load test started at 4.15AM EST -
- intentional load test -  above 200+ tabs - 99.5% load. -
- srider queries are not there in long running queries. -
- attach excel. -
- we feel like load is because of more queries and not because of query execution time. 
- New updates are there in production and will monitor in business hours.

'code/includes/common.php' 'code/public/admin/trans_admin_new.php' 'code/public/admin/bell_times.php' 'code/public/district/BusRealtime.php' 'code/public/district/BusRealtime_new.php' 'code/public/admin/employee_info.php' 'code/public/admin/edit_employee_info.php' 'code/public/admin/school_tablet_events.php' 'code/public/admin/manage_users_excel.php'







- New report section after Vehicle report.
- "Single Day Detail" is the report name.
- New setting for "Child Check" in school admin page.
- List all event code 92 messages.
- Link location to history page with bus, day & zoom to location.

Questsion:
- School admin setting for whole "Child Check".
- Which district has event code 92.
	- district 31
- Confirm - need to get data from daily_events table?
- confrim - since it is single day - end day selection not required correct?





As discussed in scrum meeting, 
We have MyISAM db engine for Geozone table in database, where other tables have InnoDB engine. 
MyISAM does table-level locking where InnoDB follows row-level locking. We need to figure out,
1. Why do we have MyISAM engine for geozone table.
2. Possibilities to migrate gezone table from MyISAM to InnoDB.
Need to work with DBA on this.


Based on yesterday's geozone_querys.csv from Prakash, I have a suggestion here to prevent table level lock in future.
Geozone db table uses MyISAM engine where other tables have InnoDB engine. 
<screen shot>

MyISAM locks entire table while performing its operations called table-level locking, where InnoDB locks only the required rows called row-level locking. 
In this way, yesterday, most of the queries went into wait state "Waiting for table level lock" for a very long time,
becuase of table-level locking performed by MyISAM engine.
We need to figure out,
1. Why do we have MyISAM engine for geozone table.
2. Based on #1, we need to find the possibility to migrate gezone db table from MyISAM to InnoDB.
We need to work with DBA on this.



We need to figure out, 




172.31.1.206




Observation:
Generates with + 
It is automatically removed when we read from query string.



latitude longitude

gearmand -d -p 4732&
gearmand -d -p 4737&

sh /var/www/wheresthebus.com/code/scripts/startMacroZonarWorkers.sh
nohup php /var/www/wheresthebus.com/code/scripts/zonarProcess.php  2>&1 >> /var/www/wheresthebus.com/logs/zonarproces.log &


Login:
Initialze session array for module ids --
Realtime page: (Both old & new)
Get district's module array 
Check module id is available in user allowed module ids in session. 

php /var/www/wheresthebus.com/code/scripts/macroWorker.php > /var/www/wheresthebus.com/logs/macroWorker1_1.txt &

gearmand -d
gearmand -d -p 4732&
gearmand -d -p 4737&

I2w3C68HQJ

WP-1534











district enabled with module
user module count != 0
user access to that module

Prakash, we are getting zonar notification emails. Please start the zonar as per server restart checklist excel.


$hasUserSpecificModuleAccess
$districtMoudles


$_SESSION['wtb.user']['modules_allowed']


add permissions 1/2
edit permission 1/2
control access in realtime page button 1/2
control access in employee page 1/2
bug fixes 1/2

modules[]
$hasUserSpecificAccess
if($hasUserSpecificAccess == 1)

$userModuleArray
$moduleArray
edit_modules
modules
deleteUser()

user_module_permissions


add operation --
List UI --
edit UI --
edit operation --
delete operation --

add - 2144
edit - 

Complex::
UI issues 
find and add required code --
debugging 




1w 3h 30m
3d

ajax exclude 1
reports implementation 2d 1/2
realtime & history implementation 1/2

- like district 62 --
- no contractor & auto admin unit creation & update based on location name --
- zonar mapping db
- vehicle id db
- admin unit db
- realtime page
- working on geozone import.

New update:
- We are not getting gps data from zonar import.
- imported geozones
- categories don't match with our current logic(district 62 cat)
- all geozones are marked as Trip Destination as per WP-1282 logic.

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping >> /tmp/zonar_assetmapping_09Jan2020.log
https://bat8632.zonarsystems.net//interface.php?username=t.fleming&password=Welcome2&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1571046255&endtime=1571046285
https://hig8281.zonarsystems.net//interface.php?username=ssimpson&password=Fieldtrip5431&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1571046255&endtime=1571046285


#1 completed location
#2 Nex I till work on this to capture user and module permissions and save it new db tables
#3 I worked on db tables.

$hasUserSpecificAccess
$districtMoudles

- configuring district with modules
- working 


-- Create table
-- Decide config array for the districts.
-- Decide place of config array for the districts.
-- Add new column in manage user section based on new setting parameter
Populate user data from new table
Save user data to new table
UI issues


- school settings
- new db tables
- will work on manage user sections



- Read config array for the district.
- 


hasUserSpecificAccess
has_user_specific_access

php /var/www/staging.wheresthebus.com/code/scripts/run.php send_speeding_alert




module access based on user permission and not on role based.
Only for district 31.

Best practice:
Modules in db table.
Populate Module from db.
Junction table to map user and module.

Questions:
How to map UI button text to db module name?
 - check Xref table before showing.

Modules in db with name & id
Xref table user_id & module_id
check user permission in Xref table before showing Mod button
District settings - HasUserSpecificAccess flag

-- Your understanding - need to give user access based on module permission assigned to the user than just on role based.
-- New district setting to enable permission to user specific.
-- Need new db table to save user Vs module permissions like geozone Vs bus assignment db table for geozone alerts.
-- New UI stuff to assign user to module.

Barathkumar Narasimhan
AYXPB5583G
10-April-2013

No.32, 2nd Street, Anjaneya Temple, Link Road, Seshadripuram, Banagalore-20
				
				
















- as per vijendra discussion
- only 4 reports in prepro
- max report = 2

All Schools Arrival Reports :
1.All bus arrivals vs. bell times (interactive, any date range)
2.Planned buses vs. bell times
3.Planned buses vs. planned times

Student Reports:
1.Single day detail




04a889oaijalo6cd3ige2qmdsh

function session_reopen() {
    //ini_set('session.use_only_cookies', false);
    //ini_set('session.use_cookies', false);
    ////ini_set('session.use_trans_sid', false); //May be necessary in some situations
    ini_set('session.cache_limiter', null);
    session_start(); //Reopen the (previously closed) session for writing.
}


Observation:
- session updated at end of the file is NOT working.
- POC is working fine in local event in admin/ folder

all school arrival
all school planned arrival
all school assigned buses
student_rfid_report_summary.php




- Stream line the code
- implement  #1 & #2 in few reports
- Test in PrePro.
- Exclude ajax content once


Forgot password:
As discussed, hashkey generated for forgot password link contains timestamp. Please save the key in user table when user makes a 
forgot password request first time. Please use this key for validation when user tries to make multiple forgot password requests 
before it expires. Please clear this key in user db table on successfull password reset.





Observation:
- Php script continues execution even after the page is closed.
- Able to updates session at the end by reopening the session.
- Not sure above find the page closure while loading.

- Find php script closure / termination
- Check php scritp execution after page closure.

613
cat LogCuncurrentReport.txt
cat /dev/null > LogCuncurrentReport.txt

2019-12-24 05:24:25



apply for WFH -- 


new update --
db changes --
sample data --
staging testing --
screen shot --
cron setup & screen shot --


1515
290273440 -813034230
290309180, -813035090

1514
290280970 -813008700

- local
- 5 mins once like geozone alerts?
- Email test

Subject : Over Speeding Alert : Bus 101.
Body:
Bus 101 has committed over speeding - <geo location detailes> location at 10.30AM.
<Link to realtime page>


Hi Savitha,

Your task is to handle over cadbury dairy milk chocolate to Karthika as a reward when she completes her task with chewing gum.

Don't miss to get your share of chocolate as a reward for your task.

Hey Abhishek,

This is your secret santa. And, your task is to wear helmet in office. Do your work from your cubicle for mininum 30 mins.

Please complete the task between 5.30pm to 7.30pm today.

- Yours Secret Santa.


1. 30th December
2. 23rd December

tablet_assignments_log.php

code/public/admin/tablet_manager.php
code/public/admin/tablet_manager_excel.php
code/public/admin/edit_tablet.php
code/includes/common.php
code/public/admin/unassigned_tablets.php
code/public/admin/wifi_network_manager.php
code/public/admin/tablet_data_viewer.php
code/public/admin/tablet_data_viewer_new.php
code/public/admin/tablet_heartbeat.php
code/public/admin/tablet_heartbeat_new.php
code/public/admin/tablet_assignments_log.php
code/public/admin/status_test_config.php
code/scripts/run.php
code/scripts/check_tracker_status.sh

'code/public/admin/tablet_manager.php' 'code/public/admin/tablet_manager_excel.php' 'code/public/admin/edit_tablet.php' 'code/includes/common.php' 'code/public/admin/unassigned_tablets.php' 'code/public/admin/wifi_network_manager.php' 'code/public/admin/tablet_data_viewer.php' 'code/public/admin/tablet_data_viewer_new.php' 'code/public/admin/tablet_heartbeat.php' 'code/public/admin/tablet_heartbeat_new.php' 'code/public/admin/tablet_assignments_log.php' 'code/public/admin/status_test_config.php' 'code/scripts/run.php' 'code/scripts/check_tracker_status.sh' 

apecMca06!



hasEmergencyButton
hasSpeedingAlerts
$numConsecutiveMsgs
$numMph

db col
has_speeding_alerts
send_speeding_emails
speeding_email_from_address
speeding_email_to_address
num_consecutive_msgs
num_mph


All
'1125FW','9933FW','9943FW','452JN','1081JN','439JN','495JN'
Only mapping:
'9933FW','9943FW','452JN','1081JN','439JN'

Vehicle_ids
'1125FW','495JN'


- Vijendra
- Monitoring java side.
- Karthika leave




New Arrival report not working for all district 15 contractors. 

1.D  IAM roles for EC2 instances allow applications running on the instance to access AWS resources
without having to create and store any access keys. Any solution involving the creation of an access key
then introduces the complexity of managing that secret.

2. B, D  Both DynamoDB and ElastiCache provide high performance storage of key-value pairs.
CloudWatch and ELB are not storage services. Storage Gateway is a storage service, but it is a hybrid
storage service that enables on-premises applications to use cloud storage.


WP-1420 15.5h




3159FW
3162FW
3163FW
3165FW
3166FW
'3159FW','3162FW','3163FW','3165FW','3166FW'

No vehicle_ids
1141FW --
1260FW --
2453FW --
5891FW --
'1141FW', '1260FW','2453FW','5891FW'

Total buses
'3159FW','3162FW','3163FW','3165FW','3166FW','203PFW','206PFW','207PFW','208PFW','213PFW','216PFW','220PFW','7486FW','0076FW','1141FW','1260FW','2453FW','5891FW'

- buses list.
- Manual DB update - ran the cron - working.
- No idea why it got set - need to check.

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping >> /tmp/zonar_assetmapping_09Dec2019.log

Questions :
Both X & Y needs to be met to send email alerts?
Can there be additional parameters(than x & y) specific to district?


- plan.
	UI
	Process to monitor & save to new table (SP)
	Process to email notification (PHP)
- discussion with DBA Karthi.
- Will discuss with Vijendra.

UI 
1. Has Speeding Alert option in 'Early Release:'
2. Get X & Y values 
3. 'Speeding Emails' section with 'Send mail' & 'From Address'.
4. 'Send Speeding Emails To:' section to get comma seperated Eamil ids.

DB
1. SP to track and save speed alert in new table
2. New table: Speeding 
District_id
Bus number
Route number (from daily_events)
UpdateTime (help to track next speed alert from this point of time)
isEmailSent
...

Save speeding time to track next check?
Is this alert for specific districts or all?



29B095FS



- removing filter from sql - missing sub buses in results. --
- hanled in php logic -- 
- Discussion with Ramesh. -- 
- changes only for district 31. -- 
- answer his question -- 



Finding:
We are taking 'sub' column value(not 'route' column value ) from vehicle_ids table when it is swap bus.


Do a code walk through to understand the flow. --
Read another ticket. 
Check with Ramesh. --

Sub bus isue
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=vehicle_ids&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=31&where%5B1%5D%5Bcol%5D=BusNumber&where%5B1%5D%5Bop%5D=IN&where%5B1%5D%5Bval%5D=%27316%27%2C%27543%27&where%5B3%5D%5Bcol%5D=&where%5B3%5D%5Bop%5D=%3D&where%5B3%5D%5Bval%5D=&order%5B0%5D=&limit=5000&text_length=100
http://prepro.wheresthebus.com/mobile/srider.php?district=31&uid=3f998cc3-556a-11e8-8e24-f23c9173ec9c&sid=117632

district 24
Buses 437(sub bus) - 092(route bus) in route 092.
Getting only one records for Bus 437 - route 092
Feching all the buses and filters out the assigned buses in php code
https://www.wheresthebus.com/mobile/srider.php?district=24&uid=6dd16fc6-d2c2-11e6-98f7-f23c9173ec9c&sid=54301





- that bus swap data clear
- found similar bus
- Not getting in result set
- confirmation on bus number and route number



Bus 620PT - Route 7665
Bus 530PT - Route 7761

620PT & 530PT are swapped
Expected results in school view:
Bus 620PT - Route 7761
Bus 530PT - Route 7665


Expected results:
Route 4636 - Bus 520PT
Route 4209 - Bus 320PT




code/public/admin/school_assigned_unassigned_buses_arrival_report.php
code/public/admin/student_nomatch_details.php
code/public/admin/student_rfid_bus_details.php
code/public/admin/student_rfid_report_summary.php
code/public/admin/students_scan_summary_report.php

'code/public/admin/school_assigned_unassigned_buses_arrival_report.php' 'code/public/admin/student_nomatch_details.php' 'code/public/admin/student_rfid_bus_details.php' 'code/public/admin/student_rfid_report_summary.php' 'code/public/admin/students_scan_summary_report.php'



One day leave on 2nd/3rd week of Dec
30th Dec




All Arrivals with Summary


finding -

clean up one day for 1287RW - report status -
discussion with Prakash
Need to clean up



I2w3C68HQJ

mdt_unit_number

observation:
Restarting zonar process in wtbuser - did not help.
Not able to restart macro workers from wtbuser - getting permission denied.
Looks like, we can try restarting gearman service - will try tomorrow as busniess hours started.


- arrival filter
- individual school plan correct
link 
- all school - bug - fixed.
link & screen shot.
- Since no plan data, unassigned records shown with route from school arrival.


Confrim with Ryan on arrival filter.
Why no of planned buses are different between individual and all school planned? eg Milwaukee Spanish Immersion  --
Why merging results did not happen? eg Milwaukee Spanish Immersion - bus number 0066SC to planned route 8197 and  also check with 0086SC Bay View school no 012
Clarify Ryan, why SC is shown on route?
	- Since no plan for this school, then 

'"0155", "0155PM", "0225", "0225PM", "0234", "0234PM", "0252", "0252PM", "0269", "0269PM", "0294", "0294PM", "0301", "0301PM", "0307", "0307PM", "0343", "0343PM", "0533", "0533PM", "0562", "0562PM", "0748", "0748PM", "0778", "0778PM", "0905", "0905PM", "0909", "0909PM", "0984", "0984PM", "1167", "1167PM", "1311", "1311PM", "1469", "1469PM", "1481", "1481PM", "1507", "1507PM", "1527", "1527PM", "1554", "1554PM", "1556", "1556PM", "1557", "1557PM", "1567", "1567PM", "1568", "1568PM", "1576", "1576PM", "1598", "1598PM", "1638", "1638PM", "1644", "1644PM", "1685", "1685PM", "1698", "1698PM", "1717", "1717PM", "1752", "1752PM", "1763", "1763PM", "1776", "1776PM", "1784", "1784PM", "1790", "1790PM", "2033", "2033PM", "2051", "2051PM", "2056", "2056PM", "2067", "2067PM", "2073", "2073PM", "2424", "2424PM", "2718", "2718PM", "5440", "5440PM", "8020", "8020PM", "8041", "8041PM", "8044", "8044PM", "8051", "8051PM", "8054", "8054PM", "8088", "8088PM", "8089", "8089PM", "8106", "8106PM", "8108", "8108PM", "8116", "8116PM", "8126", "8126PM", "8171", "8171PM", "8197", "8197PM", "8241", "8241PM", "8265", "8265PM", "9001 MD OUT", "9008 MD OUT", "9009 MD OUT", "9010 MD OUT", "9012 MD IN", "9100", "9100PM", "9101", "9101PM", "9102", "9102PM", "9104", "9104PM", "9105", "9105PM", "9106", "9106PM", "9108", "9108PM", "9109", "9109PM", "9111", "9111PM", "D001 - New Trip:1", "D001 - New Trip:2", "D002 - New Trip", "D002 - New Trip:1", "D003 - New Trip", "D003 - New Trip:1", "D004 - New Trip", "D004 - New Trip:1", "D075 - New Trip", "D075 - New Trip:1", "D075 - New Trip:2", "D075 - New Trip:3", "D093 - New Trip", "D093 - New Trip:1", "D095 - New Trip:2", "D095 - New Trip:3", "D110 - New Trip", "D110 - New Trip:1", "D115 - New Trip", "D115 - New Trip:1", "D126 - New Trip", "D126 - New Trip:1", "D151 - New Trip", "D151 - New Trip:1", "D157 - New Trip", "D157 - New Trip:1", "D191 - New Trip", "D191 - New Trip:1", "D210 - New Trip", "D210 - New Trip:1", "D210 - New Trip:2", "D210 - New Trip:3", "D227 - New Trip", "D227 - New Trip:1", "D239 - New Trip", "D239 - New Trip:1", "D244 - New Trip", "D244 - New Trip:1", "D248 - New Trip", "D248 - New Trip:1", "D267 - New Trip", "D267 - New Trip:1", "D267 - New Trip:2", "D287 - New Trip:2", "D287 - New Trip:3", "D293 - New Trip", "D293 - New Trip:1", "D294 - New Trip", "D294 - New Trip:1", "D483 - New Trip", "D483 - New Trip:1", "D507 - New Trip", "D507 - New Trip:1", "D543 - New Trip", "D543 - New Trip:1", "D625 - New Trip", "D625 - New Trip:1", "D681 - New Trip", "D681 - New Trip:1", "D706 - New Trip", "D706 - New Trip:1", "D708 - New Trip", "D708 - New Trip:1", "D732 - New Trip", "D732 - New Trip:1", "D732 - New Trip:2", "D886 - New Trip:1", "D886 - New Trip:2", "D907 - New Trip:2", "D907 - New Trip:3", "D999 - New Trip", "D999 - New Trip:1", "D999 - New Trip:10", "D999 - New Trip:13", "D999 - New Trip:14", "D999 - New Trip:15", "D999 - New Trip:16", "D999 - New Trip:17", "D999 - New Trip:18", "D999 - New Trip:19", "D999 - New Trip:2", "D999 - New Trip:20", "D999 - New Trip:21", "D999 - New Trip:22", "D999 - New Trip:23", "D999 - New Trip:24", "D999 - New Trip:3", "D999 - New Trip:4", "D999 - New Trip:5", "D999 - New Trip:6", "D999 - New Trip:7", "D999 - New Trip:8", "D999 - New Trip:9"'
'"0155", "0155PM", "0225", "0225PM", "0234", "0234PM", "0252", "0252PM", "0269", "0269PM", "0294", "0294PM", "0301", "0301PM", "0307", "0307PM", "0343", "0343PM", "0533", "0533PM", "0562", "0562PM", "0748", "0748PM", "0778", "0778PM", "0905", "0905PM", "0909", "0909PM", "0984", "0984PM", "1167", "1167PM", "1311", "1311PM", "1469", "1469PM", "1481", "1481PM", "1507", "1507PM", "1527", "1527PM", "1554", "1554PM", "1556", "1556PM", "1557", "1557PM", "1567", "1567PM", "1568", "1568PM", "1576", "1576PM", "1598", "1598PM", "1638", "1638PM", "1644", "1644PM", "1685", "1685PM", "1698", "1698PM", "1717", "1717PM", "1752", "1752PM", "1763", "1763PM", "1776", "1776PM", "1784", "1784PM", "1790", "1790PM", "2033", "2033PM", "2051", "2051PM", "2056", "2056PM", "2067", "2067PM", "2073", "2073PM", "2424", "2424PM", "2718", "2718PM", "5440", "5440PM", "8020", "8020PM", "8041", "8041PM", "8044", "8044PM", "8051", "8051PM", "8054", "8054PM", "8088", "8088PM", "8089", "8089PM", "8106", "8106PM", "8108", "8108PM", "8116", "8116PM", "8126", "8126PM", "8171", "8171PM", "8197", "8197PM", "8241", "8241PM", "8265", "8265PM", "9001 MD OUT", "9008 MD OUT", "9009 MD OUT", "9010 MD OUT", "9012 MD IN", "9100", "9100PM", "9101", "9101PM", "9102", "9102PM", "9104", "9104PM", "9105", "9105PM", "9106", "9106PM", "9108", "9108PM", "9109", "9109PM", "9111", "9111PM", "D001 - New Trip:1", "D001 - New Trip:2", "D002 - New Trip", "D002 - New Trip:1", "D003 - New Trip", "D003 - New Trip:1", "D004 - New Trip", "D004 - New Trip:1", "D075 - New Trip", "D075 - New Trip:1", "D075 - New Trip:2", "D075 - New Trip:3", "D093 - New Trip", "D093 - New Trip:1", "D095 - New Trip:2", "D095 - New Trip:3", "D110 - New Trip", "D110 - New Trip:1", "D115 - New Trip", "D115 - New Trip:1", "D126 - New Trip", "D126 - New Trip:1", "D151 - New Trip", "D151 - New Trip:1", "D157 - New Trip", "D157 - New Trip:1", "D191 - New Trip", "D191 - New Trip:1", "D210 - New Trip", "D210 - New Trip:1", "D210 - New Trip:2", "D210 - New Trip:3", "D227 - New Trip", "D227 - New Trip:1", "D239 - New Trip", "D239 - New Trip:1", "D244 - New Trip", "D244 - New Trip:1", "D248 - New Trip", "D248 - New Trip:1", "D267 - New Trip", "D267 - New Trip:1", "D267 - New Trip:2", "D287 - New Trip:2", "D287 - New Trip:3", "D293 - New Trip", "D293 - New Trip:1", "D294 - New Trip", "D294 - New Trip:1", "D483 - New Trip", "D483 - New Trip:1", "D507 - New Trip", "D507 - New Trip:1", "D543 - New Trip", "D543 - New Trip:1", "D625 - New Trip", "D625 - New Trip:1", "D681 - New Trip", "D681 - New Trip:1", "D706 - New Trip", "D706 - New Trip:1", "D708 - New Trip", "D708 - New Trip:1", "D732 - New Trip", "D732 - New Trip:1", "D732 - New Trip:2", "D886 - New Trip:1", "D886 - New Trip:2", "D907 - New Trip:2", "D907 - New Trip:3", "D999 - New Trip", "D999 - New Trip:1", "D999 - New Trip:10", "D999 - New Trip:13", "D999 - New Trip:14", "D999 - New Trip:15", "D999 - New Trip:16", "D999 - New Trip:17", "D999 - New Trip:18", "D999 - New Trip:19", "D999 - New Trip:2", "D999 - New Trip:20", "D999 - New Trip:21", "D999 - New Trip:22", "D999 - New Trip:23", "D999 - New Trip:24", "D999 - New Trip:3", "D999 - New Trip:4", "D999 - New Trip:5", "D999 - New Trip:6", "D999 - New Trip:7", "D999 - New Trip:8", "D999 - New Trip:9"'

sp assignment for loop school number
route number

1.Barath
2.Pritha
3.Ramesh
4.Suhas
5.Swanim




Known issue:
0.SP inconsistent result issue. 
	- Tested and reported the observation on incorrect plan time issue to karthi. 
1.Missing arrival for 0085SC (plan bus for a midday route) eg 0086SC Bay View school no 012
	- This is due to arrival filter - working with 45 mins arrival filter 
2.Missing "no plan bus" arrival in individual version. eg 0086SC Bay View school no 012
	- This is due to arrival filter - working with 250 mins arrival filter 
3.Missing "no plan bus" arrival in all school version. eg 0085SC appearing in individual and not in "all school" eg 
	- Bug in code - fixed.
4.Missing multiple arrivals - 0069SC has second arrival for Bay View school no 012
	- This is due to arrival filter - working with 250 mins arrival filter 
5.District 7 missing arrival


Observation:
In second loop, referring undefined route value

"0080SC", "0079SC", "0064SC", "0078SC", "0068SC", "0083SC", "0076SC", "0067SC", "0062SC", "0063SC", "0082SC", "0077SC", "0054SC", "0106SC", "0061SC", "0081SC", "0066SC", "0055SC", "0100SC", "0099SC", "0060SC", "0105SC", "0104SC", "0097SC", "0069SC", "0065SC", "0084SC", "0085SC", "0107SC", "0108SC", "0102SC", "0098SC", "0103SC", "0101SC", "0086SC", "0087SC"


District 15,20,46 - 11/08 - all routes - 11,161 records
District 15,20,46 - 11/08 - all routes - 1,378 records


$assigneBusesCount[$school_no]['P'][$schoolBusAssignment['route_no']."_".$schoolBusAssignment['stop_time_sec']]=array();
$assigneBusesCount[$school_no]['P'][$schoolBusAssignment['route_no'] . "_" . $schoolBusAssignment['stop_time_sec']][$assingedDate] = $dayParts['AM'];





/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/zonar_assetmapping_19Nov2019.log
nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/staging.wheresthebus.com/logs/zonarproces.log &


Production Release:
- Take db backups --
- Create new column in admin unit table --
- Release zonar asset class and config file --
- Manually delete all admin units of district 62 --
- Run the zonar asset mapping cron if it has not already started 



INSERT IGNORE into current_positions (BusNumber,district_id) select bus_number,district_id FROM zonar_vehicle_mapping where district_id = 15 and bus_number is NOT NULL
INSERT IGNORE into current_positions (BusNumber,district_id) select bus_number,district_id FROM zonar_vehicle_mapping where district_id = 15 and bus_number is NOT NULL



Staging:
'1218RW','1218RW','1225RW','1225RW','1226RW','1226RW','1228RW','1228RW','1229RW','1229RW','1230RW','1230RW','1235RW','1235RW','1236RW','1236RW','1237RW','1237RW','1239RW','1239RW','1240RW','1240RW','1242RW','1242RW','1243RW','1243RW','1245RW','1245RW','1247RW','1247RW','1270RW','1270RW','1271RW','1271RW','1272RW','1272RW','1273RW','1273RW','1274RW','1274RW','1275RW','1275RW','1276RW','1276RW','1277RW','1277RW','1278RW','1278RW','1284RW','1284RW','1287RW','1287RW','1288RW','1288RW','1289RW','1289RW','1290RW','1290RW','1291RW','1291RW','1292RW','1292RW','1295RW','1295RW','1296RW','1296RW','1297RW','1297RW','1298RW','1298RW','1299RW','1299RW','1300RW','1300RW','1301RW','1301RW','1302RW','1302RW','1303RW','1303RW','1304RW','1304RW','1305RW','1305RW','1307RW','1307RW','1308RW','1308RW','1309RW','1309RW','1329RW','1329RW','1330RW','1330RW','1331RW','1331RW','1332RW','1332RW','1335RW','1335RW','1336RW','1336RW','1345RW','1345RW','1346RW','1346RW','1354RW','1354RW','1356RW','1356RW','1363RW','1363RW','1365RW','1365RW','1366RW','1366RW','1369RW','1369RW','1373RW','1373RW','1376RW','1376RW','1407RW','1407RW','1413RW','1413RW','1414RW','1414RW','1415RW','1415RW','1417RW','1417RW','1419RW','1419RW','1420RW','1420RW','1424RW','1424RW','1425RW','1425RW','1426RW','1426RW','1427RW','1427RW','1428RW','1428RW','1429RW','1429RW','1433RW','1433RW','1435RW','1435RW','1567RW','1567RW','1568RW','1568RW','1587RW','1587RW','1588RW','1588RW','1601RW','1601RW','1602RW','1602RW','1603RW','1603RW','1604RW','1604RW','1605RW','1605RW','1609RW','1609RW','1610RW','1610RW','1611RW','1611RW','1616RW','1616RW','1617RW','1617RW','1618RW','1618RW','1619RW','1619RW','1621RW','1621RW','1631RW','1631RW','1632RW','1632RW','1633RW','1633RW','1635RW','1635RW','1642RW','1642RW','1643RW','1643RW','1644RW','1644RW','1646RW','1646RW','1647RW','1647RW','1648RW','1648RW','1649RW','1649RW','1650RW','1650RW','1651RW','1651RW','1653RW','1653RW','1656RW','1656RW','1661RW','1661RW','1663RW','1663RW','1665RW','1665RW','1670RW','1670RW','1673RW','1673RW','1674RW','1674RW','1675RW','1675RW','1730RW','1730RW','1731RW','1731RW','1734RW','1734RW','1739RW','1739RW','1740RW','1740RW','1741RW','1741RW','1747RW','1747RW','1748RW','1748RW','1750RW','1750RW','1751RW','1751RW','1752RW','1752RW','1753RW','1753RW','1754RW','1754RW','1755RW','1755RW','1756RW','1756RW','1757RW','1757RW','1758RW','1758RW','1759RW','1759RW','1760RW','1760RW','1761RW','1761RW','1762RW','1762RW','1763RW','1763RW','1766RW','1766RW','1767RW','1767RW','1768RW','1768RW','1777RW','1777RW','1860RW','1860RW','1861RW','1861RW','1862RW','1862RW','1863RW','1863RW','1864RW','1864RW','1865RW','1865RW','1893RW','1893RW','1894RW','1894RW','1897RW','1897RW','1898RW','1898RW','1899RW','1899RW','1900RW','1900RW','1901RW','1901RW','1903RW','1903RW','1905RW','1905RW','1916RW','1916RW','1917RW','1917RW','1918RW','1918RW','1919RW','1919RW','1921RW','1921RW','1972RW','1972RW','1973RW','1973RW','1974RW','1974RW','1975RW','1975RW','1976RW','1976RW','1977RW','1977RW','1978RW','1978RW','1979RW','1979RW','1980RW','1980RW','1981RW','1981RW','1982RW','1982RW','1983RW','1983RW','1984RW','1984RW','1985RW','1985RW','1986RW','1986RW','1987RW','1987RW','2000RW','2000RW','2001RW','2001RW','2002RW','2002RW','2003RW','2003RW','2004RW','2004RW','2009RW','2009RW','2026RW','2026RW','2042RW','2042RW','2053RW','2053RW','2054RW','2054RW','2056RW','2056RW','2057RW','2057RW','2060RW','2060RW','2063RW','2063RW','2064RW','2064RW','2071RW','2071RW'



- Enable zonar import cron

- Update District 15 Johnson not working



DB table backup --
add new location --
create new admin unit --
run the zonar --

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/zonar_assetmapping.log

Not working
"Johnson"=>array("weburl"=>"https://joh1218.zonarsystems.net/","username"=>"RLenz","password"=>"trap123"),

Modifiing::
/includes/routes.php

New
openGeozoneIFrame();
old
openGeozoneIFrame();

History
redirectToBusrealtimeToCreateGeozone();




code/public/admin/school_assigned_unassigned_buses_arrival_report.php
code/public/district/BusRealtimeReportMenu.php
code/public/admin/reports.php
code/scripts/run.php

Your change
Ramesh change
SP changes

code/public/admin/school_assigned_unassigned_buses_arrival_report.php
code/public/district/BusRealtimeReportMenu.php
code/public/admin/reports.php
code/scripts/run.php
code/public/admin/all_school_planned_arrival_time_report.php
code/public/admin/school_assigned_buses_arrival_report.php

'code/public/admin/school_assigned_unassigned_buses_arrival_report.php' 'code/public/district/BusRealtimeReportMenu.php' 'code/public/admin/reports.php' 'code/scripts/run.php' 'code/public/admin/all_school_planned_arrival_time_report.php' 'code/public/admin/school_assigned_buses_arrival_report.php'

sh script.sh "12-Oct-2019" "Barath_Ramesh"

Observation
Tried::
app - with www 		- NOT setting stops.
app - without www	- NOT settting stops.
php - with www		- NOT setting stops.
php - without www	- need to check.


current tableExport - not working - bubble_report_new.php
current tabletools - not working. - student_nomatch_details.php
Check fix for the above two plugin.
Find new plugin with nested table compatibility and rowspan.

Temp 1:
$('#imgExportButton').click(function(e){
console.log($('#tableWrap').html());// wrapper div for table
                    //var dtltbl = $('#dtltbl').html();    
  window.open('data:application/vnd.ms-excel,' + encodeURIComponent(
		$('#tableWrap').html()
	));

Try for new jquery plug in with header.
Complete excel without summary using currently library.

Consider:
Show filters on top of excel.

- Store current row index into $tempRowIndex & tempSummaryRowIndex when you start school --
- Print Summary deatils with static col & incrementing row tempSummaryRowIndex
- and start printing bus, route, etc... using tempRowIndex and incrementing the same
- Once iteration is done, then merge bus, route, plan for 'All' and print 'All' values and increament tempRowIndex once.
- Check $tempRowIndex Vs $tempSummaryRowIndex values and set highest value to next school iteration's dataRowlIndex values.


Oustanding:
Highlighting red in excel. --
Set bold to internal summary headers.  --
Merge summary unused cells row vice. --
Fix spacing issues & width. --
Fix Alignment issues. 
Remove hand cursor for headers
Remove excess space from header row value
Change excel file name

Test with All school option.--
Test with min and max rows.-- 
Placing excel icon. (datatable / else seperate icon) --
Placing print option. (datatable) --

$xlsDefaultColumns[$summeryHeaderEndIndex]
$phpExcel->getActiveSheet()->getStyle('A3')->applyFromArray($styleArray);
$lateStyle

https://www.wheresthebus.com/admin/route_admin.php?&district=65
https://www.wheresthebus.com/admin/route_admin.php?&district=65

nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/staging.wheresthebus.com/logs/zonarproces.log &

/var/www/wheresthebus.com/zonar_data/19_11_08_06_59_10_dist_id:62:_Cecil County.txt


This is causing issues in reporting correctly arrivals.



We are getting issue in arrival due to incorrect 'stop_time_sec' value 




-- In testing, I found we are missing arrivals of some buses in all school planned arrival report. I have updated WP-1368. This will impact this new report as we are using db stored procedures of all school planned arrival report.




- UI fix
- page loading error fix
- Missing empty bus number issue due to integration
- 

 
All school pal
- reproduce missing arrivals issue
- Worked on issue with DBA Karthi - found incorrect stop_time_sec in planned activity table, causing issue in SP and not returning correct data in results.
- Explain plan activity table processing issue.
- Quick fix is prepone to 11.30
- Discussed with Prakash.



Issue url
district 15
http://prepro.wheresthebus.com/admin/school_assigned_unassigned_buses_arrival_report.php?district=15&school=925&startDate=09%2F09%2F2019&endDate=09%2F13%2F2019&adminUnits=&day_part=AM&arrDept=45&arrLate=0&action=Submit



Report district 60 credential issue.







track bus number and change and who did the changes.
Create the new db table - check vehicle_log.





$assignedBusesBySchool[$school_no]['P'][$schoolBusAssignment['route_no']][][] = array("bus"=> null,"stop_time_sec"=>$schoolBusAssignment['stop_time_sec']);
$assigneBusesCount[$school_no]['P'][$schoolBusAssignment['route_no']."_".$schoolBusAssignment['stop_time_sec']]=array();


CALL SP_Planned_Bus_Assigned_To_School_kar('15,20,46',NULL,'ER',NULL,1570161600,1570161600,NULL);
call SP_Planned_School_Arrival_District_kar('15,20,46','0','AM',1570161600,1570161600,NULL)


CREATE INDEX ix_bus_tablet_log_24 ON tablet_events_24(bus_number,tablet_info_id,log_date);
CREATE INDEX ix_bus_tablet_log_15 ON tablet_events_15(bus_number,tablet_info_id,log_date);



And, some table having millions of records. 
-- I will do this tomorrow in off business hours and check the page load performance.


SP_Planned_Bus_Assigned_To_School


Stop zonar vehicle import cron --
Check-in code --
Take db backup --
Create new admin unit --
Create new bus company --
Release asset php code --
Take a note on db table row count --
Run cron --
Test -
Run master icon cron again --
Update ticket with admin unit, realtime page 


I worked on this.


29860038

6
3,4,5,6 maghizchi
4,6 taste




Technical Competencies

Reports:
MDT Reports -
Attendant Log
Route Based Attendance
** MDT Status Report
MDT Student Summary
** MDT Driver Login Summary Report
** MDT Student Summary by Contractor Report
Student Count
Student Log
Student Log Summary


Vehicle Reports - 
All Schools: All bus arrivals vs. bell times
	Planned buses vs. bell times
	Planned buses vs. planned times
Individual School: All bus arrivals
	Planned buses
	All Arrivals with Summary
Individual Bus
By Tier
Idling
Slack Time
Time and Mileage
Depot Arrival
** Unexpected Stops	
** Speed
** Geozone Activity
Deadhead


most report - relaxed.
Timecard Report - 15 mins







MDT Unit Number.
example value.

Space cons




Pause today's asset mapping cron --
Compare code. --
Check-in code. --
Release code. --
	Asset mapping
	Config
	Create admin unit --
take backup of tables. --
Take a look at current db table records --
Run the cron manually. -
Check db tables 
Check icons 
Update jira 




Confirm - CS - Charter


77609 77980

case "Sague":
			//wp-326 starts here
		 if($this->districtId == 31){
            $BusNumberQuery = "Update " . def_DB_DBNAME . "." . $this->dbTableName . " SET bus_number =  concat(trim(fleet_number),'SG')
  where contractor_name = 'Sague' and bus_number is NULL and `gps_id` != '' and district_id = {$this->districtId}  ";
			$this->dbObj->doQuery($BusNumberQuery);
		}
			//wp-326 ends here
			echo "\n\n\n";
		break;

----------------
Going forward:
- district 62 style - since it has no contractors and admin units in location
-
Contractor Districts :
Admin units are created for contractors and not for location
Do you need admin unit in location name not in contractor name?
What happen if same location is there in two different contractors?




going forward when we setup a new zonar district like district 62,


Outstanding - display order


/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/zonar_assetmapping.log



SP_Planned_School_Arrival_District

https://dat1154.zonarsystems.net//interface.php?username=datt0583&password=welcome1&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1570704461&endtime=1570711667
https://pri1059.zonarsystems.net//interface.php?username=VeoNowPGCPS&password=Veo.Location&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1570704415&endtime=1570711667





32092
student_log_summary_report_export.php
43-13	32092	92/98/185748	G	0.69	679266	0	5808.2	6.44	11139.58	172.31.2.201	veonow.com:80	GET /admin/student_log_summary_report_export.php?action=getdsr&


- Have an additional array in config file to find the districts having auto admin unit creations.
- Create isZonar created admin unit flag column in admin unit table.
- Find logic to add/edit/delete admin unit based on location updates from zonar api.
- Figure out way to handle user created admin units and auto admin units.
- Concern on code - where buses are saved to vehicle_ids based on location array.

Implementation:
- Get the list of locations(array) from zonar vehilce mapping table. 
- Get the list of zonar admin units(array) from admin units.
- loop zonar locations array
	- Check location is matching with zonar admin units array
	- If matches, then update buses and set a flag to both zonar location array item and zonar admin unit array item
- Delete unflagged zonar adming array items from admin units table.
- Clear zonar adming array
- Loop zonar locations array only unflagged items
	- Create admin unit with zonar location item name and update buses.
	- Flag zonar location array item.


- Check if the location is available in admin units table.
- Create if it is not available and store buses.
- If it is available, then update the admin unit.







4164156347


Get the districts and jira tickets that work based on location.
- WP-1168
- District 26, list using location.
- District 31, 


Get the district that dont work based on locations.
Location is not used.
District 37:
Taking all the zonar buses(non numeric bus number) and saved in "First Student Buses" admin unit name. 
District 15:
Lamers, Durham, Johnson, Durham South admin units are created with contractor name and all the buses, 
are saved in respective admin units.



Production:
original : 31475134
Temp : 539253
 
 
 select 
*
-- count(*) 
from zonar_vehicle_mapping zm
left join vehicle_ids v on v.BusNumber = zm.bus_number and v.district_id = zm.district_id
where zm.district_id = 26
and zm.location = 'Crec'
and zm.bus_number is not null
-- Find only missing bus number in vehicle from zonar mapping
and v.BusNumber is null


- s3
- confirm



- Download data. --
- Import data --
- Remove unwanted bus data 
- Test in staging once. --
- Production - Import data in temp table. --
- Production - Do clean up and remove unwanted bus data. -
- Production - copy data to daily_events_11 table after Ryan approval.
- revoke grants for tmp db
- drop tmp db

mysql -h 172.31.2.181 -u wtbuser -p wtb_vehicle_staging < /tmp/district11_gps_restore/04.sql
my#5751O182TBfN

wtbuser@172.31.1.206
show grants for wtbuser@172.31.1.206;
REVOKE ALL PRIVILEGES ON `wtb_vehicle_tmp`.* FROM 'wtbuser'@'172.31.1.206'

mysql -h 172.31.2.207 -u wtbuser -p wtb_vehicle_tmp < /tmp/district11_gps_restore/04.sql





Findings.
Ramesh discussion.
Karthi discussion.
Confirm all school plan report arrivals.

New ticket:


- Check how we are finding correct bus number for route in planned data (assignment) UI. --
- Check how it is working fine in All school assigned buses report. --
- Discuss with Karthi on this. --
- Create a ticket to address missing arrivals in Speed.
- 

While working on WP-1289, we found district 15 arrivals are not correctly reported in all school planned arrival report.
<report url>
<screen shot>

They are reported in individual school arrival report.
<url>
<screen shot>

We need to fix this.



$routesArray



Discussed with DBA Karth.
Need to discuss with Ramesh.











//Move school arrival data to plan arrival data in sub bus data movement.

Note:
Mark sub bus record as sub eventhough it has no plan time.

Find sub bus after merging - so you will get both plan & non-plan routes
- Get routes from merged res by looping --
- Execute sub sql for routes --
- loog merged res as mrec --
- find mrec's bus & route matching with sql res sub & route 
- if matching, set sub = 1 & call setSubRoute(), then if mrec is plan data, then find and move school arrival data to mrec




Here, 08/26 arrival 9.30, should not be reported as arrival filter 30mins and Plan time is 8.50. I am looking into the issue.


-----------
Tomorrow ::
-----------
Remove 9.30 arrival from the report as it is outside the arrival filter.




No arrival
- Considering only plan bus. 472/161 is not from plan
- Work for it.
Unassigned
- Considering only non plan buses (no plan time). 472/161 is not from plan(no plan time)
- Work for it.
District 15
- Need to check



Average issue with 301 bus:
Here, 08/26 arrival 9.30, should not be reported as arrival filter 30mins and Plan time is 8.50. I am looking into the issue.

Updates are available in PrePro.


if (strtolower($dayPart) == 'am') {
                if ($schoolBeginTime) {
                    //dd('school begin time');
                    if (!empty($val['arrival']))
                        $arrivalSeconds = $val['arrival'] - floorTime($val['arrival']);

                    if ($arrivalSeconds < $schoolAmBeginTime || $arrivalSeconds > $schoolAmEndTime) {
                        $skipFromAvg = true;
                    }
                }
            }
            if (strtolower($dayPart) == 'pm') {
                if ($schoolEndTime) {
                    if (!empty($val['arrival']))
                        $depSeconds = $val['arrival'] - floorTime($val['arrival']);
                    if ($depSeconds < $schoolPmBeginTime || $depSeconds > $schoolPmEndTime) {
                        $skipFromAvg = true;
                    }
                }
            }


Sub:
Get sub list from db based on routes from planned assignments --
Check db 'sub' value and planned assignment's bus value are matching --
If yes, mark planned asssignment item with sub flag. --
Loop only sub flag items from planned assignments 
Check planned assignment bus is present in school arrival with or without route. 
Then, pull school arrival value to planned arrival item 
Unset school arrival item. 

301:
Take bus 301 and route 301 from planned arrival(item) --
Loop school arrival and find first occurance(item) of bus 301 & route 301 in school arrival 
Loop school arrival item itself and compare arrival & depature value for each dayPart
If planned arrival and school arrival are different for a day, then update planed arrival item with school arrival item arrival & depaturn
Unsset school arrival item.




Staging :
- Run the zonar in staging 
- Get the latest locations in staging 
- Add all the locations to zonar config file **
- Drop existing admin units **
- Create all locations (only gps_id locations) as admin units **
- Run the cron **
- Run the master image cron *
- Check mapping, vehicle, admin units **
- Check admin units bus count **
- Check with join sqls **
- Check realtime page **
- Check for other districts as well.

Production rlease:
- Take db backup **
- Promote code changes. **


take backup in staging before running cron
php /var/www/wheresthebus.com/code/scripts/run.php zonar_asset_mapping >> /tmp/zonar_assetmapping.log
php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/zonar_assetmapping.log

php /var/www/wheresthebus.com/code/scripts/run.php master_icon

upload_max_filesize=2M

take db table backup --
update zonar config file in production --
run zonar asset mapping --
Test once --
run master file cron --
restart zonar gps process --

staging:
original : 1861308
New : 144668




District 15
- planned data are matching.
- school arrival not matching

- sorint order --
- late filter update (-/+) --
	-ve => arrival < bell/plan + window --
	+ve => arrival > bell/plan + window --
- late filter update for avg arrival --
- report all option issue -
- table style






"We definitely dont want to show duplicate row - there is no point to this. Can we hide the duplicted row? 
If there are two rows, we would only want to see the planned bus row"

For missing planned bus arrivals :
- Bus assigned with route for the day and arrived with out route. --
- give no arrival screen shot from all school planned bus report. --
- Get details from Karthi. --
- Have a call with Ryan after Mobility team.






For 03Sep2019:
- Looks like 438 arrived on 26Aug without route. Thats why it is reported in "Individual All bus arrivals" data and not in "Individual Planned bus" data
- Confirm with Karthi / Ramesh.

No Arrival
Aug 26	198	438	08:50 AM
Aug 27	198	198	08:50 AM

Arrived
Aug 28, 08:48 am	198	198	2 min






- Add plan time column --
- Check Ryans observations --
	- Not duplicate. One is from school arrival and another one from school arrival (assigned & planned)
- New late filter  --
	- New filter - school arrival based on bell time & school arrival (assigned & planned) based on plan time?

- Address datatable issue style issue
- Check possibility of sorting




- Integrate query & test --
	Same data like my own query
- *Find - multiple arrival - new row logic. ^^^ ??
- use their code directly in new report and update the code to fit here.
- Address datatable issue
- Issue in All average (bottom)
- Check why start & end date is weired
- Check arrival filter issue --
- Issue in All school option - incorrect arrival from individual school arrivals 

if (strtolower($dayPart) == 'am' && $schoolList[$school_no]['begin_time'] != '') {
                            $bell_time = date('h:i A', floorTime() + $schoolList[$school_no]['begin_time']) . " bell time";
                        } else if (strtolower($dayPart) == 'pm' && $schoolList[$school_no]['end_time'] != '') {
                            $bell_time = date('h:i A', floorTime() + $schoolList[$school_no]['end_time']) . " bell time";
                        }
$schoolList[$school_no]['am_begin_time']
$schoolList[$school_no]['am_end_time']
$schoolList[$school_no]['pm_begin_time']
$schoolList[$school_no]['pm_end_time']						


php /var/www/wheresthebus.com/code/scripts/run.php synovia_data_reducer

php /var/www/staging.wheresthebus.com/code/scripts/run.php synovia_data_import
php /var/www/staging.wheresthebus.com/code/scripts/run.php synovia_asset_mapping &> /tmp/synovia_mapping.txt

<soap:address location="http://api.synovia.com/SynoviaApi.svc" />


1. If empty, create record in array with first sql row
2. If not empty, check whether first entry for bus in array. If yes, create record in array with first sql row
3. else regular flow


Observation: 
Datatable initialization issue ::
Working fine with school number and no rowspan & no 'All' summary
-- Not working with neither rowspan nor colspan in data rows.

Funcationality::
Empy bus number from planned, is not reporting in the UI.

New Report:
- Check school arrival query at higher level and discuss with DBA karthi. --
- *Find - multiple arrival - new row logic. ^^^ ??
- Integrate school arrival code --
- Update school arrival code to work it based on school number  --
- Show school arrival data --
- Address datatable issue
- Issue in All average (bottom)
 
	$checkingBus = ' AND bus_number IN (' . $eachUnits . ') ';
	$districtCond =  ($IsDistrictMerged) ? " IN ($districtIdTofetch) " : " = {$district}";
    $destinationCond =  ($IsDistrictMerged) ? " IN ($schoolIdTofetch) " : " = {$schoolId}";
    
    $query = "SELECT * FROM  school_arrivals WHERE  (`day_time` >= '$startTime' AND `day_time` <= '$endTime' ) AND `day_part` = '$dayPart' $checkingBus ";
    $query .=  " AND district_id $districtCond ";
    $query .=  " AND destination_id $destinationCond ";



Depot arrival report - UI Reference:
http://app.wheresthebus.com/admin/depot_arrival_report.php?action=DA&busNo=&routeNo=&startDate=08/05/2019&endDate=08/11/2019&district=31&au=&isSchoolArrivals=0&isUnExpectedStops=0&isIgnitionEvents=0&isShowAddress=0&isDriveThrough=0

$school_no_sql => $selected_school_no
---------------------------
foreach ($schoolList as $school_no => $school) {
                                
                                //if (!isset($reportCard[$school['geozone_id']])) {
                                if (!isset($reportCard[$school_no])) {
                                    continue;
                                }
---------------------------
$schoolList[$school_no]['geozone_name'] // School 123 ES
---------------------------
//Bell time
$title_table = $schoolList[$school_no]['geozone_name'];
if (strtolower($dayPart) == 'am' && $schoolList[$school_no]['begin_time'] != '') {
    $title_table .= "(" . date('h:i A', floorTime() + $schoolList[$school_no]['begin_time']) . ")";
} else if (strtolower($dayPart) == 'pm' && $schoolList[$school_no]['end_time'] != '') {
    $title_table .= "(" . date('h:i A', floorTime() + $schoolList[$school_no]['end_time']) . ")";
}
---------------------------
if($IsDistrictMerged)
        {
            $districtWhereContion = "$districtIdTofetch";
        }
        else
        {
            $districtWhereContion  = "{$district}";
        }
$selected_school_no_sql = isset($selected_school_no) ? "'".$selected_school_no."'" : 'null';		

SELECT * FROM  school_arrivals WHERE  (`day_time` >= '1563768000' AND `day_time` <= '1564113600' ) AND `day_part` = 'AM'  AND bus_number IN ( "154", "155", "155N", "156", "157", "157N", "158", "158N", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "233", "234", "235", "235N", "236", "237", "238", "238N", "239", "300", "301", "302", "303", "304", "305", "306", "307", "308", "309", "310", "311", "314", "315", "316", "317", "318", "319", "319N", "320", "320N", "321", "322", "323", "324", "325", "326", "400", "404", "405", "410", "415", "417", "419", "420", "435", "436", "437", "438", "454", "455", "457", "458", "472", "480", "481", "M9")   AND district_id  IN (24,37)  

Known challenges :
1. Additional fiter (skip arrival) individual school arrival report
	- Just ignore 'No of Visits' for now.
2. Merging two report's results.
3. Sorting because of 'colspan' for individual school 'All' summary
4. Manaing admin unit and bus list


Instructions:
First build the data structure based on assinged bus result data. -
Merge with school arrival data. - 
do the Avg arr & Avg for Avg & day(arr & dep) after merging. 
Use same $averageTotals array with school_no as additional and first index.


School arrival report:
Fetches arrival based on destination_id(comma seperated if merged district). line #96 & 100.

Assigned bus:
Uses destination_id in school dropdown

Notes:
$checkingBus is equivalent to $checkingBusTBLBusAssigned






Take backup -- 
Deploy file -
Run the process

2718968 9294B725-5E7A-4755-957E-F0809058F643	
2718967	B382B514-909E-4395-9833-0F9FD142373B 

php /var/www/wheresthebus.com/code/scripts/run.php zonar_geozone_import "62","Cecil County" > /tmp/zonar_geo_data.txt

Headers?
- School dropdown list?
- 

Summary data?

Additional:

Questions?
To confirm - arrived even without an assignment -> you mean say no route number assigned?
Usually individual school -> school dropdown  -> How the table UI should be?


Standard header filters like start




- Parse poly points and spatial points --
- Indentify and prepare other required db columns values --
- Insert into geozone table --
- Call it from run.php by passing district_id & contractor name --
- Logging messages --
- Error handling --

- DB status **
- Geozones UI 
- error handling, logging message
- Finding geozone based on lat & lng sql also works.
- 

"62","Cecil County"
"42","Five Star Transportation"
"60","St Johns County Schools"
district_id, geozone_name, geozone_type, school_type, active, poly_points, center_point, poly_points_spatial, center_point_spatial, created_on, last_updated_on

- Only 6 digits maintained after decimal point for both lat & lng
- confirm with Ryan
- Run geozone finding query once
- Finding geozone based on lat & lng sql also works.

GPS lat long
39.606201, -76.074888
39.606090, -76.074986

SELECT `geozone_id` FROM `geozones` WHERE `district_id` = 62 AND `auto` != 1 
AND ST_CONTAINS(`poly_points_spatial`,ST_GEOMFROMTEXT( CONCAT( 'POINT(', 39.606090/10000000, ' ', -76.074986/10000000, ')' ) )) LIMIT 1 

Barath
Pritha
Ramesh
Suhas
Swarnim





POLYGON((40.319016 -76.008735,40.317967 -76.006301,40.317387 -76.006693,40.316807 -76.007085,40.317798 -76.009643,40.319016 -76.008735))
	
https://tamil.gizbot.com/scitech/4400-year-old-tomb-revealed-in-egypt-and-it-may-have-hidden-treasure/articlecontent-pf146513-020224.html?utm_medium=Desktop&utm_source=OI-TA&utm_campaign=Homeclicks-News	


Workd:
In Progress. 
Added geozone_type and school_type values in zonar config file.
Working on importing data.

Confirmation:
This is just one time import for a district.
Will save geozone_name, geozone_type, school_type, poly_points, center_point, poly_points_spatial, center_point_spatial db table columns in geozone table.

Stuff:
Need to format poly_points.
Need to format poly_points_spatial as well, this value is used in geozone finding sql queries.




SBI PPF:
https://www.sbi.co.in/portal/web/personal-banking/faq-public-provident-fund
https://www.sbi.co.in/portal/web/personal-banking/public-provident-fund-ppf

Calculator
https://www.paisabazaar.com/saving-schemes/ppf-calculator/


Monisha R
Old No:141A, New No:106, Venkatrangam Pillai, Street, (Near - Ice House), Triplicane, Chennai, Tamil Nadu - 600005

#32, Anjaneya Temple 2nd Street,
Link Road, Seshadripuram,
Bangalore - 560 020.
Karnataka.




/var/www/wheresthebus.com/zonar_data/19_07_31_00_22_07_dist_id:31:_First Student - Lower Moreland.txt


Zonar
district 15 is not working based on locations.


s11
1212121233

deleteBusModal
subBusModal



TSL16
36374754754

Test1
4641254140

140
4641237864


1.
- sub, sub_type, sub_mode 
- set blank not null
2. Check with Pritha on deleting note.



District 26 - Dattco Last ID 35753991
District 31 - Cheltenham Trans - Last ID 35754177
District 42 - Five Star Transportation - Last ID 35753990





code/public/admin/delete_bus_excel.php

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/zonar_assetmapping.log

dat1154 was a contractor earlier?
	- no sure
Clearing dat115 and run cron will help?
	- yes


Fix this in staging today for New Canaan.

Get the list of buses for dat1154 in New Canaan.
Delete the buses from mapping, vehicle ids & current position.

('3963','1399','1413','1414','1415','1420','1421','1422','1423','1424','1425','1426','1427','1428','1429','1430','1431','1432','1433','1434','1435','1436','1460','1461','1462','1463','1464','15035','15036','15037','15037-bad','15038','15039','15040','15041','15043','15049','15055','15056','15066','2995','2996','3965','3926','SPED 21','SPED 22','SPED 29','SPED 30','SPED 31','SPED 32','SPED 33','SPED 34','SPED 35','SPED 38','SPED 39','SPED 40','SPED 41','SPED 42','SPED 45','SPED 46','SPED 47','SPED 526','SPED 527','SPED 528');
-- 64 buses - dat1154
-- 41 buses we have in Dattco
-- 23 buses we need to find and delete from vehicle_ids

I am working on this.

I investigated the issue and found there is an invalid contractor 'dat1154' creataed for this district. No idea why it was created. 
We don't have this contractor in current configuration.
<screen shot dat1154 & Dattco>

It got data on 11/25/2016 and no updates after that.


-Invalid contractor dat1154. No idea why it got added.
-<screen shot dat1154 & Dattco>
-Data from 2016 no update.
-<screen shot>
- Causing the issue.
- Need to clean up dat1154 data in db. 
- Done in staging for New Canaan location.
- Need to check and clean for South Windsor,Windsor,East Hartford,Manchester locations.
- No code fix is required in nightly cron.

I am working on this.
I investigated the issue and found there is an invalid contractor 'dat1154' created for this district. Actually this is causing the issue. No idea why it was created.  We don't have this contractor in current configuration.
 !screenshot-1.png|thumbnail! 
It got data on 11/25/2016 and no updates after that.
[Mapping table|http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.207&username=wtbuser&db=wtb_app_live&select=zonar_vehicle_mapping&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=26&where%5B1%5D%5Bcol%5D=location&where%5B1%5D%5Bop%5D=%3D&where%5B1%5D%5Bval%5D=New+Canaan&where%5B2%5D%5Bcol%5D=&where%5B2%5D%5Bop%5D=%21%3D&where%5B2%5D%5Bval%5D=&where%5B3%5D%5Bcol%5D=contractor_name&where%5B3%5D%5Bop%5D=%3D&where%5B3%5D%5Bval%5D=dat1154&where%5B5%5D%5Bcol%5D=&where%5B5%5D%5Bop%5D=%3D&where%5B5%5D%5Bval%5D=&order%5B0%5D=update_datetime&order%5B1%5D=&limit=500&text_length=100]
 !screenshot-2.png|thumbnail! 
We need to clean up dat1154 data in db.  I have done the data clean up in staging for New Canaan location.
We need to check and clean data for South Windsor,Windsor,East Hartford,Manchester locations.
No code fix is required in nightly cron as this is due to incorrect contractor configuration.

New Canaan:
Take db backup --
Clear mapping table data --
Clear vehicle_ids --
Clear current position --
Run zonar cron. -
Test. --

Repeat for other locations.
South Windsor: --
Clear mapping table data --
Clear vehicle_ids --
Clear current position --
Test

Windsor: 
Clear mapping table data
Clear vehicle_ids
Clear current position
Test. 

East Hartford:
Clear mapping table data
Clear vehicle_ids
Clear current position
Test.

Manchester:
Clear mapping table data
Clear vehicle_ids
Clear current position
Test

php /var/www/wheresthebus.com/code/scripts/run.php master_icon >> /var/www/wheresthebus.com/logs/master_icon.log &










1w 2d
1w 3d 7h
3d 2h

2w 2d



Just to confirm.
I will add new column lunch_id after bus_stop_time in student_details_upload, student_details & student_details_history tables.
We need to store lunch_id values only for district 30 in student_details_upload table and this new column will be null for all other districts.

Manual_rfid_no
0 and values stored as it is in lunch_id.
How NULL values should be saved?

lunch_id

null 8275698
0 8280111
123 8280351
A1A 8283489
null 8283840 dist 1








1626


WP-1251
1. Current state?
	Which column uses?
2. Proposed state?
If we have,
a.barcode value in stud_id
b.lunch_id in manul_rfid_no
Then why do we need new column for lunch_id ?
3. Bus History page?
4. Student Report? which reports?

Check the current student import crons?



$districtLat
$districtLon
ignore_zoom


wtb_lib.php - calcDistance()
common.php - calcDistanceBetweenScanLocationAndBusStop()



checkin code --
Take db backup --
release code --
release sp --

23 aug sbc - mas

07 Sep sbc - kpd
08 Sep kpd - sbc

13 Sep sbc - mas
27 sep sbc - mas


$.blockUI({
                                message: '<div class="bold">Adding. Just a moment...</div>'
                            });
							$.unblockUI();


Server check - already exist:
BusNumber --
VIN --

Must:
Bus Number --
Route Number if vehicle type is Route Bus --
Vehicle type --
Status --
Admin Unit --

Optional:
Driver Name --
VIN --

$('#vehicle_id').val();
$('#vin').val()
$('#BusNumber').val();

Work for::
Check bus number exists
Vin validation

vehicle_id_logs 
1. Adding a new bus to vehicle_ids table
2. Deleting a bus from vehicle_ids table
3. Clearing bus number, route number, admin unit, driver name, VIN values and changing Status to Unassigned in vehicle_ids table.

17390 - 2004 - 5N1BV28U18N102401

I checked the new logs in production. 
We are logging the old odometer value returned by SP. I feel like having the new odometer value in logging, would help in debugging.
I have asked DBA Naveena to return the updated odometer value as well. He will look into that. 


District ID
-----------
Bus :<value>, Old Odometer :<value>,


11 done
24 & 9 need tbe done.


Click on Delete Bus
ajax call with vehicle_id, to check bus has ESN or not
	If No ESN - delete the bus.
	If ESN - 
		Show popup content
		Confirmation - ajax call with vehicle_id - remove the bus number, route number, admin unit, driver name, VIN and set the Status to Unassigned


deleteBusModal
delete_vehicle_id
delete_busno
delete_GPS



Pausing the cron for DBA activities.

Crons not depend on daily_events:
student_imports
child_id_import
emp_import
bus_route_info_PM
stop_import

Note : 
Paused till slack_time_report
We should finish work before 4AM for heartbeat
IST 6.45AM login and pause the crons.

Important::
Zonar monitor and notifications are paused...

Before running the crons manually, check how many cron missing and yet to start.


































Goa Liquor
Barath - Rs.1182




Update to vehicle_odometer tables:
edit_bus_process.php
edit_bus.php

vehicle_odometer
VEHICLE_ODOMETER







Create New District 62 - Cecil County Public Schools (MD)

<div id="content">
    <div class="title bold">Add/Delete Bus</div>
    <!-- Add Bus -->
    <div style="border: 1px red solid; height: 200px; margin-top:10px;">
    </div>
<!-- Delete bus -->    
<div style="border: 1px blue solid; height: 200px; margin-top:10px;">
</div>
</div>

edit-save-form
add-save-form

editbus
addbus

INSERT INTO geozones 
(`district_id`, `geozone_name`, `geozone_type`, `school_type`, `active`, `poly_points`, `center_point`, `covering_buses`, 
`covering_buses_pm`, `am_trip_routes`, `pm_trip_routes`, `begin_time`, `end_time`, `bus_number`, `auto`, `school_no`, `poly_points_spatial`, 
`center_point_spatial`, `created_on`, `last_updated_on`)
SELECT 
48, `geozone_name`, `geozone_type`, `school_type`, `active`, `poly_points`, `center_point`, `covering_buses`, 
`covering_buses_pm`, `am_trip_routes`, `pm_trip_routes`, `begin_time`, `end_time`, `bus_number`, `auto`, `school_no`, `poly_points_spatial`, 
`center_point_spatial`, NOW(), NOW()
FROM geozones 
WHERE district_id = 32 ORDER BY geozone_id ASC;

insert into geozones 
(`district_id`, `geozone_name`, `geozone_type`, `school_type`, `active`, `poly_points`, `center_point`, 
 `begin_time`, `end_time`, `bus_number`, `auto`, `school_no`, `poly_points_spatial`, `center_point_spatial`, `created_on`, `last_updated_on`)
select 
50, `geozone_name`, `geozone_type`, `school_type`, `active`, `poly_points`, `center_point`, 
`begin_time`, `end_time`, `bus_number`, `auto`, `school_no`, `poly_points_spatial`, `center_point_spatial`, `created_on`, `last_updated_on`
from geozones 
where district_id = 46;


navigation -> seperate page??  or same page??
	- consider back navigation to bus mgr
Page general UI
UI for add bus section




$districtList[] = array('district_id'=>'11');
			$districtList[] = array('district_id'=>'24');
			$districtList[] = array('district_id'=>'9');

Confirmation:
"Add / Delete Bus" - takes to new tab.
Ryan Answer : Same popup or new table whichever is easier 
Clicking on "Delete Bus" should delete the bus when no ESN assigned
Delete ESN bus 
	-> clear bus#, route#, etc and set Status to Unassigned 
	-> need to be removed from the list 
	-> means only running / assigned buses need to listed.
	Ryan Answer : The buses that has bus number should appear here...	


expected:
212240466



$districtList[] = array('district_id'=>'11');
			$districtList[] = array('district_id'=>'24');
			$districtList[] = array('district_id'=>'9');


ly three beneficiary can be added in a day. Please do not add more than three beneficiary in a day. However, if you wish to add more than three beneficiar


SELECT district_id,bus_number, b.odometer AS current, (b.odometer/1609.344) as current_formatted, 
b.odometer + CASE WHEN BusNumber IS NULL THEN 0 ELSE a.Accumulator0 END as new,
((b.odometer + CASE WHEN BusNumber IS NULL THEN 0 ELSE a.Accumulator0 END)/1609.344) as new_formatted
FROM wtb_app_live.vehicle_odometer b  LEFT JOIN 
(
SELECT *
FROM wtb_vehicle.daily_events_61 a )
WHERE a.`BusNumber` = 'TB07' AND a.Accumulator0 > 0 AND (a.UpdateTime >= 1560744000 AND a.UpdateTime < 1560830400) 
ORDER BY amUpdateTime DESC LIMIT 1
)a ON  a.BusNumber=b.bus_number AND a.district_id=b.district_id
WHERE b.district_id = 61 AND b.bus_number='TB07';



select odometer as current, 
(odometer + (SELECT if(count(Accumulator0) = 0, Accumulator0, 0) FROM  wtb_vehicle.daily_events_61 a WHERE a.`BusNumber` = 'TB07' AND a.Accumulator0 > 0 AND (a.UpdateTime >= 1560744000 AND a.UpdateTime < 1560830400) ORDER BY a.UpdateTime DESC LIMIT 1)) as new, 

(odometer + (SELECT if(count(Accumulator0) = 0, Accumulator0, 0) FROM  wtb_vehicle.daily_events_61 a WHERE a.`BusNumber` = 'TB07' AND a.Accumulator0 > 0 AND (a.UpdateTime >= 1560744000 AND a.UpdateTime < 1560830400) ORDER BY a.UpdateTime DESC LIMIT 1)) as new, 
(SELECT Accumulator0 FROM  wtb_vehicle.daily_events_61 a WHERE a.`BusNumber` = 'TB07' AND a.Accumulator0 > 0 AND (a.UpdateTime >= 1560744000 AND a.UpdateTime < 1560830400) ORDER BY a.UpdateTime DESC LIMIT 1) as daily_events,
(SELECT count(Accumulator0) FROM  wtb_vehicle.daily_events_61 a WHERE a.`BusNumber` = 'TB07' AND a.Accumulator0 > 0 AND (a.UpdateTime >= 1560744000 AND a.UpdateTime < 1560830400) ORDER BY a.UpdateTime DESC LIMIT 1) as count
from wtb_app_live.vehicle_odometer where district_id = 61;

select from_unixtime(1560744000), from_unixtime(1560830400);

php /var/www/wheresthebus.com/code/scripts/run.php update_odometer &>> /var/www/wheresthebus.com/logs/odometer.log
php /var/www/prepro.wheresthebus.com/code/scripts/run.php update_odometer
php /var/www/staging.wheresthebus.com/code/scripts/run.php update_odometer



*/10 * * * * /usr/bin/php /var/www/wheresthebus.com/code/scripts/zonarMonitor.php &>> /tmp_permanent/zonarMonitoring.log

UPDATE `vehicle_odometer` SET `odometer` = `odometer` + (SELECT `Accumulator0` FROM  wtb_vehicle.daily_events_61 a WHERE a.`BusNumber` = 'TB07' AND a.Accumulator0 > 0 AND (a.UpdateTime >= 1560830400 AND a.UpdateTime < 1560916800) ORDER BY `id` DESC LIMIT 1) WHERE `bus_number` = 'TB07' AND `district_id` = '61'

Check fix in prepro --
Naveen mail --
Zonar test - 
	7.14 killed
	7.22 killed "First Student - Plymouth Meeting"
	
Pre trip








TB10
Running after 4am
Got 7m - data viewer
Added to previous day result - incorrect
Looking for logic


Check its status over week end.




ps -eo cmd | grep [s]tart_zonar_process
nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/staging.wheresthebus.com/logs/zonarproces.log &

Odometer old values of district 61:
bus_number	bus_number	odometer	round(odometer/1609.344)
TB10		TB10		33503388	20818
TB07		TB07		144467869	89768

php /var/www/wheresthebus.com/code/scripts/run.php update_odometer


Zonar restart automation:
Find zonar contractors.
Check each contractor is up and running.
	- Get running contractors list
	- parse -> district_id, contractor name
	- Iterate config contractors Vs running contractor
	- Restart zonar atlease one 
Restart the zonar process if any one contractor is not running.

One sh file and one php file

40592

/usr/bin/php /var/www/wheresthebus.com/code/scripts/run.php zonar_asset_mapping >> /tmp/zonar_assetmapping.log

https://cec1383.zonarsystems.net//interface.php?username=VEO&password=CCPSCCPS&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1559809314&endtime=1559809344
https://cec1383.zonarsystems.net//interface.php?username=VEO&password=CCPSCCPS&action=showposition&operation=path&format=json&version=2&logvers=3&starttime=1559331000&endtime=1559332000
https://cec1383.zonarsystems.net//interface.php?username=VEO&password=CCPSCCPS&action=showposition&operation=path&format=json&version=2&logvers=3&tstype=load&starttime=1559331000&endtime=1559332000

 




/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping &> /tmp/zonar_assetmapping_05Jun2019.log

First Student - Plymouth Meeting
Last id :33184750


Ryan:
Invalid URL.

Suggestion : 
Show past assignments in separate section below bus list.
Only current data has bus company relationship - past dont have.

Need to update query & logic to show the past bus number and data.
https://wheresthebus.com/admin/tablet_data_viewer_new.php?bus_company=49&date=05/24/2019&district=7





javascript validation
	- alteast one
	- gray out sec diff
	- future date
where link




Integrated karthi query
Implemented new circle icons
Implemented three colors

Validation
Stamp Vd time text box




<img alt="" src="data:image/svg+xml;utf-8, <svg version=&quot;1.0&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;30&quot; width=&quot;23&quot;>  <circle cx=&quot;10&quot; cy=&quot;16&quot; r=&quot;3&quot; stroke=&quot;black&quot; stroke-width=&quot;1&quot; fill=&quot;rgb(0,0,255)&quot; />  </svg>" draggable="false" style="position: absolute; left: 0px; top: 0px; user-select: none; width: 23px; height: 30px; border: 0px; padding: 0px; margin: 0px; max-width: none; opacity: 1;">




Handle form submission -
Handle query based on filter
Handle query for All & individual bus based on 'where' clause
JS Validation select alteast one filter check box out of there.


var district = $.trim($("#district_id").val());
        var date = $.trim($("#datepicker").val());
        var bus = $.trim($("#bus_name").val());
        var missing_msgs = ($("#missing_msgs").is(":checked")) ? 1 : 0;
        var stamp_n_update = ($("#stamp_n_update").is(":checked")) ? 1 : 0;
        var comm_regain = ($("#comm_regain").is(":checked")) ? 1 : 0;
        var stamp_n_update_diff = $.trim($("#stamp_n_update_diff").val());


Change it to form submit.
Change buses to dropdown.


FB326ED9-69F6-4990-9D65-87B17882B541
A18240A5-E266-4622-9E82-8E282F83EBDA

4842024716, 4842039140









4842023639
9191DB
9191LN

1)Needs to be deleted as part of cron in synovia mapping
963C548F-640D-4DC8-8E94-E7D242EE3C03

2)1554LN need to be deleted from vehicle ids table



I have fixed the issue. There was a logical issue in the synovia vehicle import process. And, the issue is there from the beginning (based on svn log) and other developer worked on this. I fixed missing bus number 1775 issue in staging. 
Missing buses are added in 
vehicle_ids
synovia_vehicle_mapping
admin_bus_units
current_positions

1775DB needs to be removed from db. That i have done manually in production db. 
We have two different issues here.
1. Missing new bus numbers.
2. Removing existing bus when it is no longer available.

#1 is fixed. 
#2 we need to handle this in the cron.

manual entry
manual delete
staging update



/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php synovia_asset_mapping &> /var/www/staging.wheresthebus.com/logs/synovia_mapping_23May2019.txt &

7078563F-82A3-4F1C-8146-68F90509108F -- DB
7078563F-82A3-4F1C-8146-68F90509108F -- 

Last ID of First Student - Plymouth Meeting is 32532025



Check box to show only data for specific type
Text box to get number of seconds default 60 secs
Consecutive Missing Messages
Stamp vs Update > 60 Sec. - also can 60 be a parameter that can be changed?
Comm Regain Messages

Correct Text
Create check box with onchange event
Create text box with onchange event
Save use selection in cookie
Show red icons

Query changes required for all buses option

WP-1189 - 
DBA Naveen is back. I checked with him. He could not work today as he is busy and will work on this tomorrow.




monisha.barath@gmail.com
9840509449
21-Nov(11)-1989

JBL T450BT bluetooth headset
Skullcandy Uproar bluetooth headset


Preference:
Sony XB650BT Bluetooth Headset with Mic - 7,490 -> 6,599 


District 31 tablets : 180
Active tablets : 163
Sticker number tablets : 156
Active Sticker number tablets : 151

Report listing : 130
Expected listing : 151

psv1 -> 866264030552199
psv2 -> 866264030548049
psv3 -> 866264030545052
psv5 -> 866264030543305
psv8 -> 866264030563832
psv10 -> 866264030557842
psv12 -> 866264030557792
psv14 -> 866264030547512
psv15 -> 866264030553361
psv16 -> 866264030551829
psv17 -> 866264030559129
psv18 -> 866264030536978
psv20 -> 866264030556513
psv21 -> 866264030559913
psv22 -> 866264030547843
psv23 -> 866264030561927
psv24 -> 866264030540608
psv26 -> 866264030552447
psv27 -> 866264030552249
psv28 -> 866264030555721
psv29 -> 866264030557214
psv30 -> 866264030537166
psv31 -> 866264030558121
psv33 -> 866264030560986
psv34 -> 866264030556505






Network Coverage Issue
network_coverage_issues



180 tablets
131 tablets matching imei_number provided in excel - got sticker number



1day excel
1day testing


Synovia issue:
Not working only for "B382B514-909E-4395-9833-0F9FD142373B"
id 2466538 - got every null except district_id = 15 & customoer id B382B514-909E-4395-9833-0F9FD142373B






psv1 86626403055219



Naveen
Only date is selected from UI. So need consider only date part. --
Can we use direct value in where clause instead of variable. Becoz, need to execute set variable as seperate statements. --
Remove version number & its table. --
Battery, Lat & Lng -  we are taking max, we need  last record. --





Skullcandy Crusher

Barath
WP-1189 -- Need to check with DBA.
WP-1195 -- Closed
WP-1072 -- No change in estimation.

Staging DB:
-----------
admin_bus_units_11Apr2019;
current_positions_11Apr2019;
synovia_vehicle_mapping_06Mar2019;
vehicle_ids_11Apr2019;
zonar_vehicle_mapping_11Apr2019;

Production DB:
--------------
admin_bus_units_23Apr2019
current_positions_23Apr2019
vehicle_ids_23Apr2019
zonar_vehicle_mapping_23Apr2019
admin_bus_units_04Apr2019
current_positions_04Apr2019
vehicle_ids_04Apr2019
zonar_vehicle_mapping_04Apr2019


Discussed with DBA Naveen.
sticker_number column is added to school_tablet_info table.
Worked on the report.

lastReportDate
lastAttendantScanDate
lastManualEntryDate

var lastReportDate = '<?= $lastReportDate ?>';
        var lastAttendantScanDate = '<?= $lastAttendantScanDate ?>';
        var lastManualEntryDate = '<?= $lastManualEntryDate ?>';


UI selection
Date selection with clear option
Manage form parameters











-- Riteway bus companied
-- Export to excel

Headphone
1. Connectivity : Bluetooth
2. Type : On the Ear
3. Mic : I am okay with / without mic.
4. Brand : Brands like Skullcandy, Sony, etc.


SELECT `geozone_id` FROM " . def_DB_DBNAME . ".`geozones` gz WHERE gz.`district_id` = ee.`district_id` AND gz.`auto` != 1 
AND ST_CONTAINS(gz.`poly_points_spatial`,ST_GEOMFROMTEXT( CONCAT( 'POINT(', ee.Latitude/10000000, ' ', ee.Longitude/10000000, ')' ) ))

MySQL Query
SELECT * FROM `geozones` gz WHERE ST_CONTAINS(gz.`poly_points_spatial`,ST_GEOMFROMTEXT( CONCAT( 'POINT(', 40.317781, ' ', -76.00815, ')' ) ))
-- poly_points_spatial is geometry type.

In edit screen,
show milwaukee district
show only sct bus company

In add screen,
show milwaukee district
show only sct bus company

Ramesh / Suhas
What district(s) should be shown in district dropdown in add & edit tablet.
What bus company(s) should be shown in bus company dropdown in add & edit tablet.


Feed back on Lunch vendor (Cafeteria - 6th floor): 
Food quality is not good. I kindly request you to look for a better vendor even if the food cost little higher than current vendor cost.





  Poonkuzhali
  Poonkodi (word from Sangam Tamil)
  Malarvizhi
  Yazhini from the musical instrument 

Prisha - Talent given by God, Beloved, Loving, Gods gift
Bhavya - Meaning Grand or splendid
Parnika - Parnika means 'Small leaf'. It is also a name that means 'Goddess Parvati'.
Bhargavi - A name derived from the daughter of Sun in mythology
Pamela - Honey; Sweetness
Parinitha - Expert, Complete, Knowledge, Married
Pradiksha - Hope
Pramitha - Best friend, Wisdom

13. Pari -  Angel
14. Prisha - Talent given by God, Beloved, Loving, Gods gift
15. Bhavya - Meaning Grand or splendid
16. Parnika - means 'Small leaf'. It is also a name that means 'Goddess Parvati'.
17. Bhargavi - A name derived from the daughter of Sun in mythology
18. Pamela - Honey; Sweetness
19. Parinitha - Expert, Complete, Knowledge, Married
20. Pradiksha - Hope
21. Pramitha - Best friend, Wisdom

22. Padmaja - Born from lotus, Goddess Lakshmi
Charming and Conciliatory;Queen of a Women's Kingdom; Loving; Determined; Full of Love;
Pavanisha - 
Pavanyaa
Pradanya
Pranavika Expressive; Fun-loving Nature;
Pranaya - Leader
Pranika Goddess Parvati;


a) Assigned School Name **
b) IMEI number **
c) Sticker number - when we send out the tablets we sicker them with a number. Right now this is not saved in the school_tablet_info bus we will need to get this added.
d) Last Report Date **
e) Last time we received an event code 9 message from the tablet in the school_tablet_events_31 table
f) Last time we received an event code 12 messages from the school ID the teh tablet is assigned to:
g) The latest battery_level for the tablet
	-- Consider latest data
h) The last known location of the tablet (latitude, longitude - with a hyperlink to a Google map page)

Prakash:
What is 'School' in school MDT Manager?


Event Code:9	NFC Card Scan
Event Code:12	Mileaukee Route Start

Missing value and 3.7

Loadts
Mapping logic
Prasing logic


Missing values
1. odometer
2. loadts
3. fuel_counter -- Not used
4. status
5. accel

Curretn API ::
action = showposition
operation = path
format = json
version = 2
logvers = 3
tstype = load

Required API ::
action = showposition
operation = path
format = json
version = 2
logvers = 3.7
tstype = load

3.1:
Missing value : loadts, fuel_counter, status & accel

3.2:
Missing value : odometer, loadts

3.8:
Still missing above listed parameters.

3.7:
Getting the all the values except loadts value.

3.6:
Change in data format(heading & time) - still mising loadts value.

Mapping:
Heading
Log reasons


Hi, we are looking name for our daughter. It should start with tamizh letter either 1 or 2. your suggestion would be highly appreciated.

Thanks
Barath & Moni.

2+7+1+1982



SP_Planned_Bus_Assigned_Each_School
			TO
SP_Planned_Bus_Assigned_To_School

SP_Planned_School_Arrival_Each_School
			To
SP_Planned_School_Arrival_District


<<<<<<<<<<<<<<<<<<<<IMPORTANT>>>>>>>>>>>>>>>>>>>>
Update query to zonar mapping table, set manually_removed = 0 where bus number is null and manually_removed = 1
test with missed buses 3161 & 3171 and also simulate problematic buses directly in db and run the zonar asset cron





admin_bus_units_01Apr2019
admin_bus_units_06Mar2019
admin_bus_units_07Mar2019
current_positions_01Apr2019
current_positions_06Mar2019
current_positions_07Mar2019
synovia_vehicle_mapping_06Mar2019
synovia_vehicle_mapping_07Mar2019
vehicle_ids_01Apr2019
vehicle_ids_06Mar2019
vehicle_ids_07Mar2019
zonar_vehicle_mapping_01Apr2019

drop table admin_bus_units_01Apr2019;
drop table admin_bus_units_06Mar2019;
drop table admin_bus_units_07Mar2019;
drop table current_positions_01Apr2019;
drop table current_positions_06Mar2019;
drop table current_positions_07Mar2019;
drop table synovia_vehicle_mapping_06Mar2019;
drop table synovia_vehicle_mapping_07Mar2019;
drop table vehicle_ids_01Apr2019;
drop table vehicle_ids_06Mar2019;
drop table vehicle_ids_07Mar2019;
drop table zonar_vehicle_mapping_01Apr2019;

* find - in which case & where those buses got manually_removed = 1 and inserted_into_vehicle = 1
* confrim - resetting manually_removed is solution.
* manuall remove bus from bus manager  - run the cron - check whether deleted buses are added back.

check where and all manually_removed is used.

set manually_removed = 0
manually_removed = 1 in bus number assignment where bus number is null.

we were missing those buses in realtime page as manually_removed = 1 and skipped in admin unit groups.


getBusNumberListByLocation
getBusNumberListByContractorName




I added valid buses to East Hartford from zonar_mapping table in staging db. 
But, they do not appear in realtime as they don't have entries in vehicle_ids table.

If it is very urgent, i can spend some more time to look into the zonar process to make it work.

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping > /tmp/zonar_assetmapping_03Apr2019.log

If it is very urgent, i can spend some time to look into the process and to make it work.

12015,12016,12017,12018,12019,13020,15006,15007,15008,15009,15010,15011 bad,15012,15013,15019,15020,15021,15022,15023,15024,15025,15028,15029,15030,15031,15032,15033,15034,15073,15074,21001A,21012,21013,21014,24001,24002,24003,24004,24005,24006,24007,24008,24009,24011,24012,24013,24014,24015,24016,24017,24019,2419,12040,2469,2475,2325,2481,2489,21001,27021,27022,3219,12042,2849,2852,2853,2854,2857,2944,2992,320,321,3218,12015,12016,12017,12018,12019,15006,15007,15008,15009,15010,15011,15012,15013,15019,15020,15021,15022,15023,15024,15025,15026,15027,15028,15029,15030,15031,15032,15033,15034,15073,15074,21001,21012,21013,21014,2298,2299,24001,24002,24003,24004,24005,24006,24007,24008,24009,24011,24012,24013,24014,24015,24016,24017,24018,24019,24020,27021,27022,2824,2830,2831,2833,2836,2838,2843,2844,2845,2846,2847,2849,2850,2851,2852,2853,2854,2855,2856,2857,2860,2861,2873,2969,320,321,3218,3219,3810,3920,24018,15054,15053,15011,2298,13006,18012,18013,12039,12041,15026,15027
3921,24020,11029,11030,2467,2479,2482,2487,2490,2819,2855,11026,2996,3004,1258,1277,11023,3920,1262,1249,1251,1253,1256,1259,1260,1255,1265,1272,1273,1274,1276,1306,3922,15091,2917,2934,3701,2936,2931,2933,2920,3918,3953,3983,3991,3703,3702,27057,3987,3992,27056,11035,27037L,1267,27038L,3925,27055,12025,12026,12027,12029,1252,26042L,27052,13013,1241,22000,12054,27054,1242,17092,27039,11025,12028,1305,27036L,27053,2900,15090

current code
modifid code
current status

25-Mar-2019 
APP
A) Both(www & 'no www') app server - dynamic url(def_PATH_TO_SERVICE) works for www(--) and NOT working for 'no www'(--).
B) Both(www & 'no www') app server - old code - NOT working for www and working for 'no www'. 
PHP
C) Both(www & 'no www') php server - dynamic url(def_PATH_TO_SERVICE) works for www(--) and works 'no www'(--).
D) Both(www & 'no www') php server - old code - NOT working for www(--) and NOT working for 'no www'(--).

code/public/admin/tablet_student_report.php
code/public/admin/route_login_report.php















Complete that sample php file for web, php cli and sh cli
is this file permission issue? error log file content differes between console and web views!!

=============TRY IT OUT=================
1. create php file A equivalent to macroworker.php
2. Have shell_exec() in A.
3. run A as background process
You should see a 'sh -c php ....' and 'php ......'








Check old data date
Check clean up cron
06 00 * * * echo "$(find /var/www/wheresthebus.com/zonar_data -mtime +3 -delete)"
06 00 * * * echo "$(find /var/www/wheresthebus.com/synovia_data -mtime +3 -delete)"


zonar oldest record 19_03_23_00_06_01_dist_id:43:_Prince Georges County.txt
Synovia oldest record 19_03_23_00_06_03_dist_id__15__LBW.xml

ssh -i WTB-AWS-CentOS.pem centos@172.31.2.91


How to log from sh running php file
	- does it need error log enable in php ini file.
	- If yes, try this in staging first.
check shell_exec in php doc
	- No diff between shell_exec() & exec() & system() & passthru()
try catch - error types
Why it got crashed?
Why only 3 macroWorker have logs? are others active and running?


district 31 - Ply mouth - last db id 29966728

18.210.255.144

Automatic model.
Both(www & 'no www') app server - dynamic url(def_PATH_TO_SERVICE) works for www and not working for 'no www'.
Both(www & 'no www') php server - dynamic url(def_PATH_TO_SERVICE) works for www and 'no www' as well.
Both(www & 'no www') php server - old code - not working for www and 'no www' as well.









create ticket zonar 
checking zonar fix -

Get all the tasks done in last financial year.
Filter out
Formate
Split and fill in the form





Daily events - One route column.
Bus route info db table - If they can use bus_route_info table instead of having multiple routes in daily_event table.
Slack time UI - Multiple routes -  Benefit.








11.45


District_id & contractor_name as key memcache for one minute --
Find the right place to keep the memache code -
Route value in insert
Check in staging
Confirm Synovia bus status

Getting bus number for each contractors

$this->contractorName
$this->districtId

bus route array declaration
Pushing route value - get Json result 
Fetching route value - insert sql






I have listed below points for the discussion with Shilpa. Please check and merge yours and send to vijay
Prakash :
1) Delta data import for
	a) Students
	b) Route
	c) Turn by turn data
	d) Driver
2) AWS SNS Emails
3) Bus Health Items - PreTrip Report
4) UI Pages To Support School View Tablets (WP-736)
5) Driver images on the tablet
6) UDP 1 and UDP 2 restart
7) Active MQ check
8) Workers 
Barath :
9) District time zone change from php UI
10) Route update in daily_events table (WP-1140)
11) Log files path of UDP & Workers
12) Mail notifications(important & ignore)
13) Access to UDP Server (Vijendra)
14) Location of java code in UDP Server


Access to UDP server
What needs to be done on UDP when district time zone is changed from school admin page. 
	- I believe we need to restart the UDP & workers.
How the route assignment is done by UDP.
	- SELECT MobileID, BusNumber, route, district_id FROM vehicle_ids where non_udp_data = 0.
	- Route number are updated in hash map every minute by UDP.


https://tamil.gizbot.com/scitech/heres-what-might-happen-if-north-korea-launched-nuclear-weapon-021152.html?utm_source=oi-hp-col-1&utm_medium=dsktop&utm_campaign=newlinks
https://tamil.oneindia.com/news/chennai/tamilachi-thangapandiyan-is-beautiful-candidate-vote-her-says-udhyanidhi-stalin-344507.html
https://tamil.oneindia.com/news/chennai/dmk-admk-women-candidates/articlecontent-pf361588-344516.html


/*Barath Mar-19-2019 WP-1136*/
INSERT INTO `status_tests` (`ident`, `description`, `display_order`) VALUES('macro_report_group59','After group 58','215.7');
INSERT INTO `status_tests` (`ident`, `description`, `display_order`) VALUES('macro_report_group60','After group 59','215.8');
/*Barath Mar-19-2019 END*/




new groups
status test config entry

group63





issue
sorting on plan time
testing empty results



Assignments --
Result array formation --
Arrivals to result array --
Averages in result array --
Test in prepro --
	- different districts --
	- Admin unit filter --
Debugging --
Tuning - Array struct, avg cal, assiging arrivals

Plan time column --
date('h:i A', $valArray['stop_time_sec'])

School dropdown issue --
UI issue --

Check all the files promoted earlier
Code tune









Vijay Update.
Printouts.



Joe:
What is the contractor name of this district? give example
I have used "SJ County"
What is the admin unit name? give example.
I have used "SJ County"
Location filter? Home(count) & unknown(count)
Fleet numbers are assigned to bus number those have GPS ids
' is removed from bus number
Any filter anyother buses?

No bus filter.

Need to working on following logic when there is an update on location, contractor name,
UpdateBusNumbersInMappingTable()
UpdateBusAdminUnits()
Vehicle id table management end of run()

SJ County

Stop zonar --
release code --
Db updates --
run zonar asset --
start zonar --

updates in staging
Production release
tested
screen shot

New update is done.

Zonar is set up for the new district 60 in production. I tested this in the production and it is working fine. 

Realtime page:


Current position:
Started pulling realtime data.






Part 1
Vehcile asset
	- Config file
	- Just check location filter --
	- Download asset --
	- Clean up invalid data(empty gps id, etc) --
	- Bus number logic --
	- Admin unit
	
Part 2
GPS data tracking
	- 

Check why two section for insert vehcile_ids based on district id
Remove ' from bus number

php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping &> /tmp/zonar_assetmapping_10Mar2019.log

http://prepro.wheresthebus.com/admin/all_school_planned_arrival_time_report.php?district=24&startDate=02%2F18%2F2019&endDate=02%2F19%2F2019&action=Submit&daypart=both&adminUnits=&schoolType=All&timeWindow=45&earlylateHid=0&early=0&optimal=0&marginal=0



WP-1126 Setup Zonar Import for District 60
WP-1107 zonar_data and synovia_data








Check we are able create new file when error occurs

Vijendra
Delete file/folder by keyword - whole system folders.
Delete file/folder by last updated time.

Check - able to create a fine when error happens?
Check in the logging code file(s)

how yday's create district release did not affect run.php in app server






29134042 - plymothing last proccessed id.



Update on records_processed :
These are the records, we saved after doing the filtering on the buses we want to save.

Please also look into the code about how often the job runs
-- The job runs every minute. This is the lowest time interval that we can set to scheduled job as per linux documents.
I can check is there any possibilities.

i will check this in code. Give me few minitues.

[15][cust_guid]
[cust_code]
[service_method]
[fleet_guid]
	[fleet_guid_1]
	[fleet_guid_2]
	[fleet_guid_3]


Check new key in utitlity for gps
	-- Working fine
Compare old and new key in utility for gps
	-- Same
Compare old and new key in utility for vehicle asset
	-- Same
Find way to update guid in mapping table
	-- 
Find way to start gps data collection to start with new key
	-- 
Release
db table backups --
check-in --
Stop synovia service --
release  code --
do db update --
start synovia service --
test 




2282345 - s0105 last call
2284449 - updated ICSB new guid manually
2285091 - starts with fleet_guid as P5 in s0113

 




Synovia upedate:
Need new wsdl?
	-- Yes
Check new wsdl from utility and staging app
	-- working with utility
	-- 
Check s0105 Vs s0113 response
	-- Same including next id
Check s0003 for vehicle asset - working fine new api updates.
	--
do code changes in local and run in staging

*/1 * * * *  php /var/www/staging.wheresthebus.com/code/scripts/run.php synovia_data_import &> /tmp/synoviaImportLog.txt
*/1 * * * *  php /var/www/staging.wheresthebus.com/code/scripts/run.php synovia_data_reducer






Update 
Discuss wtih DBA. working on SP changes. working on php code assuming the sql results.
Working on rewriting logical parts.
Will work on export to excel once every it is done.

reporting no arrivals?
-- Yes

Not following :
No arrivals
Assigned route popup

Work
Bring plan arrival report code

Find way to report card format route vs bus vs plantime
Average calculations
Add new plan time column


$assignedBusesBySchool
$assigneBusesCount
$plannedTimesArr






gsxvtogmrnrrthze




Checking current implementation
One entry - One route Vs one bus
Multiple entries - One route Vs one bus

Need to check all school plan time.





This is not api key, this is customer GUID - this should be unique id and not supposed to change once it is generated by Synovia.

Confirm new key of ICSB
	-- Yes
Check gps data pull with new key belongs to ICSB
	-- To check this compare vehicle asset of both old & new keys
		-- Vehicle asset - Same in both keys
	-- 
	-- Not getting data with new key
	-- We are getting data with old key
Check impact of key change in config file
	-- Old key referred in synovia mapping table
	-- Validating gps data with mapping table on key

synovia mapping table liked with customer guid. Also, need to check fleet_id and mobile_id GUIDs once synovia system is stable.
If they confirm only new key will be used, then need to work on this first in staging. 

Looks like, synovia is still working on their api services. I think, we can wait till synovia system becomes stable.




LBW:
Dairyland Bus
Lakeside South
Lakeside North

ICSB:
Wisconsin Central


tracked db rec id 2266972



synovia system was down yesterday
Our application started collecting data once synovia system was up
2891WC - data received till 2/27/2019 7:16:05 AM - thats why no pm data in history.

in what time duration synovia was down
start from 12AM to 1.45PM EST

PM data 
DB - 56219
LN - 95426
LS - 17352

Restart Synovia
1.Stop download cron
2.assigne emtpy array to $getNextIDQuery
3.call download class from sperate file once
4.undo code change
5.enable download cron






not working - prod db copied to staging - during aws

ALTER TABLE tablet_info DROP INDEX ix_ti_imei_number

866264030286533










2019-02-19 06:50:29 -> Curl error on handle dist_id:31:_First Student - Plymouth Meeting: timed out before SSL handshake

add return value of sleep to log
check apache error log and php error log
If issue with Sleep then why it always starts with district 31 Plymouth Meeting?
run a test file with sleep(30) in app server
	--Work normaly  
Capture php error as it not happening currently

sleep is not considered in max execution time.

Next:
check apache logs
Enable error_reporting(E_ALL)
Add sleep return value in zonar log
Enable php error loging


dist_id:31:_First Student - Lower Moreland
28432413

dist_id:31:_First Student - Plymouth Meeting
28432236

dist_id:31:_First Student - William Penn
28432431

dist_id:31:_Sague
28432815









http - works only without www
https - works only with www

Dynamic url:
worked with https://www.wheresthebus......
worked with https://whersthebus.....


find


40,000
30,000
15,000






Riteway has existing buses from district 15 zonar import. --
Check how current 46 data is shown district 15.

Qucik fix
Clear exisitng RW buses in district 15.
Add all the 46 buses to district 15 Riteway.
Check 46 bus data in district 15 relatime.

Delete bus number from district 15
1308RW, 1346RW, 1665RW




Run the zonar import once

Check the bus number format logic for this contractor
	- cheked at high level
do we have any filter to import some buses
	- No
Check what bus numbers format we are currently getting
Db backup
	- Done
	
'm3159-931599','m3160-931609','m3161-931619','m3162-931629'

clear vehicle
set manuall delete to 0
set null to m-series
rerun the zonar


code check in 
test --
reply Ryan 
 -- two buses left
cron - remove district 15 condition






kill
copy current log
clear
upload log
restart



nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/staging.wheresthebus.com/logs/zonarproces_06Feb2019.log &

Tyring to connect to ActiveMqtcp
PHP Warning





Zonar data download : 
Initial files count : 1113380


[wtbuser@ip-172-31-1-204 /]$ nohup php /var/www/wheresthebus.com/code/scripts/zonarProcess.php 2>&1 >> /var/www/wheresthebus.com/logs/zonarproces.log &
[1] 7772
[wtbuser@ip-172-31-1-204 /]$ nohup: ignoring input and redirecting stderr to stdout


AZITHRAL 250MG TAB - 10 units pack - MRP 110.97
MONDESLOR TAB - 10 units pack - MRP 134.10
ZERODOL P TAB - 12 units pack - MRP 47.47



Why manual delete got set?
Not sure.

How to get back the buses?
- set manually_removed = 0 and inserted_vehicle_ids = 0 
- run the zonar import bus process

Why we are missing from vehicle_ids table and admin_units?

Are these buses in vehicle_ids?
- No

Recovery
Investigate



0002DH, 3055DH, 3212DH, 3248DH, 3250DH, 3285DH, 3286DH, 3287DH, 3288DH, 3474DH, 3481DH, 3495DH, 3496DH, 3509DH, 3510DH, 3620DH, 3628DH, 3629DH, 3630DH, 3631DH, 3636DH, 3637DH, 3638DH, 3639DH, 3641DH, 3642DH, 3643DH, 3645DH, 3646DH, 3647DH, 3648DH, 3650DH, 3651DH, 3652DH, 3978DH, 3993DH, 3999DH



Emp ID : 108759
Observation:
1. Sometime, event it is not working with www & without www.
2. Getting, error in curl response. need to check.
3. 'Without WWW' works with http and 'With WWW' works with https





Files changes
automatic_model_creation.php --
AutomaticModelCreation Class file 
route_admin.php --

https://www.wheresthebus.com/admin/automatic_model_creation.php?district=50&date=01/24/2019&dayPart=AM&automodel=true
No WWW:
/admin/automatic_model_creation.php?district=50&date=01/24/2019&dayPart=AM&automodel=true

With WWW:



New
010017

old
010002


old
080045






No zonar import means - should be hanled in code.
add/remove buses in zonar import - handled in code - so that, bus will not be imported from zonar.
Db column should be for other purpose.







010002 -> 030004

Debug in produciton
Match staging code to prod and test in staging
	automatic_model_creation.php code is same.
	AutomaticModelCreation.php code is same.
	common.php code is same.
	
Proceed further logic in staging.






Autimatic model issue:
Check the buses are getting listed when we select model date and AM/PM?






List of tables involves in automatic model creations ::
districts
admin_bus_units
macro_models -- mid table 56K records
geozones
daily_events
routes
model_routes -- big table 22L records
settings
stops -- mid 1L records
----------------
model_update_log


List incorrect drivers.
Clear driver images & modified column.
Assign correct images if it is available in server.





Not an issue from save driver images WP-739. All reported images are updated after oct 2018

May be from UI / employee import cron.


Report images in server?



sh tiger_states_mt.sh &> /tmp/tiger_states_mt_11Jan2019.txt &
1655

INSERT INTO tiger.loader_platform(os, declare_sect, pgbin, wget, unzip_command, psql, path_sep, loader, environ_set_command, county_process_command) SELECT 'peter', declare_sect, pgbin, wget, unzip_command, psql, path_sep, loader, environ_set_command, county_process_command FROM tiger.loader_platform WHERE os = 'sh';

UPDATE tiger.loader_platform
SET declare_sect = 'TMPDIR="${staging_fold}/temp/"
UNZIPTOOL=unzip
WGETTOOL="/usr/bin/wget"
export PGBIN=/usr/bin
export PGPORT=5432
export PGHOST=localhost
export PGUSER=wtbuser
export PGPASSWORD=pg#5751O182TBfN
export PGDATABASE=geotiger
PSQL=${PGBIN}/psql
SHP2PGSQL=${PGBIN}/shp2pgsql
cd ${staging_fold}'
WHERE os = 'wtbuser';

\copy (select loader_generate_script(ARRAY['MT'], 'wtbuser')) to '/home/wtbuser/tiger/tiger_states_mt.sh' with binary;




Check where to manually set the model date.
Check rames doc once.




Test MT.
Test other district.
Test from application.
Test geocoding and reverse geocoding.
Shilpa confirm.

40.329206, -75.999034
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-75.999034 40.329206)',4269),true) As r;
SELECT g.rating, ST_X(g.geomout) As lon, ST_Y(g.geomout) As lat, (addy).address As stno, (addy).streetname As street, (addy).streettypeabbrev As styp,
(addy).location As city, (addy).stateabbrev As st, (addy).zip 
FROM geocode('205 Cecil Ave, West Lawn, PA 19609') As g;




46.410132, -105.836476
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-105.836476 46.410132)',4269),true) As r;

47.730049, -116.945006 -- No results
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-116.945006 47.730049)',4269),true) As r;
SELECT g.rating, ST_X(g.geomout) As lon, ST_Y(g.geomout) As lat, (addy).address As stno, (addy).streetname As street, (addy).streettypeabbrev As styp,
(addy).location As city, (addy).stateabbrev As st, (addy).zip 
FROM geocode('1935 Palmer St, Miles City, MT 59301') As g;

47.730057, -116.938525 -- No results
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-116.938525 47.730057)',4269),true) As r;

47.966182, -116.867861 -- No results
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-116.867861 47.966182)',4269),true) As r;

47.676630, -116.774466 -- No results
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-116.774466 47.676630)',4269),true) As r;

48.276093, -116.562032 -- No results
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-116.562032 48.276093)',4269),true) As r;

46.862033, -113.993728
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-113.993728 46.862033)',4269),true) As r;

46.009784, -112.541676
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-112.541676 46.009784)',4269),true) As r;

46.408969, -105.836911
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-105.836911 46.408969)',4269),true) As r;

48.545757, -109.679881
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-109.679881 48.545757)',4269),true) As r;

48.513698, -111.857058
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-111.857058 48.513698)',4269),true) As r;

47.102285, -104.706083
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-104.706083 47.102285)',4269),true) As r;

48.997758, -111.963791
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-111.963791 48.997758)',4269),true) As r;

46.241591, -114.159755
SELECT pprint_addy(r.addy[1]) As st1,pprint_addy(r.addy[2]) As st2,pprint_addy(r.addy[3]) As st3,array_to_string(r.street, ',') As cross_streets
FROM reverse_geocode(ST_GeomFromText('POINT(-114.159755 46.241591)',4269),true) As r;
SELECT g.rating, ST_X(g.geomout) As lon, ST_Y(g.geomout) As lat, (addy).address As stno, (addy).streetname As street, (addy).streettypeabbrev As styp,
(addy).location As city, (addy).stateabbrev As st, (addy).zip 
FROM geocode('423 Desmet St, Hamilton, MT 59840') As g;





0561 = 1684/1685
	1684 - No data in daily_events table.
	1685 - Data available in daily_events table.

1731 = 1210/1533
	1210 - Data available in daily_events table.
	1533 - No data in daily_events table.
----------------------------------

++0557 = 1675
	No data in daily_events table.
	
0561 = 1684/1685
	1684 - No data in daily_events table.
	1685 - Data available in daily_events table.
	
--0566 = 1952
	No data in daily_events table.
	
++0568 = 1753
	Data available in daily_events table.
	
--0569 = 1955
	No data in daily_events table.
	
1731 = 1210/1533
	1210 - Data available in daily_events table.
	1533 - No data in daily_events table.
	
--1762 = 803
	No data in daily_events table.
	
1748 - the only route which should not have a bus assignment






We have following buses in
0557 = 1675
0561 = 1684/1685 
0568 = 1753

Cron missing data
bus_route_info_AM
bus_route_info_PM

0200FW

0557 = 1675 
	-- Available Admin unit & vehicle_ids
	-- NOT available in bus_route_info **
	
0561 = 1684/1685 
	-- Available Admin unit & vehicle_ids
	-- NOT available in bus_route_info **
	
0566 = 1952 
	-- NOT available in admin unit list & vehicle_ids & synovia mapping table
	-- NOT available in bus_route_info
	
0568 = 1753 
	-- Available Admin unit & vehicle_ids
	-- Available in bus_route_info with route 568 without leading zero **
	
0569 = 1955 
	-- NOT available in admin unit list & vehicle_ids & synovia mapping table
	-- NOT available in bus_route_info
	
1731 = 1210/1533 
	-- WORKING FINE
	
1762 = 803 
	-- NOT in admin unit list & vehicle_ids & synovia mapping table
	-- NOT available in bus_route_info
	-- Available in tablet_info
	
1748 - the only route which should not have a bus assignment


Vehicle_ids missing buses
0566 = 1952 
0569 = 1955 
1762 = 803 



'code/scripts/run.php' 'code/includes/classes/MacroCronHistory.php'





    District 43 - PG County --
    District 50 - Milwaukee South (Riteway) --
    District 53 - Brandywine -- 
    District 54 - Indian River --
    District 55 - New Canaan --
    District 56 - Appoquinimink --
    District 57 - Gloucester --
    District 58 - Montgomery --

/*Barath Sep-12-2018 WP-897 Create a new macro groups for district 45, 48, 49*/
INSERT INTO `status_tests` (`ident`, `description`, `display_order`) VALUES('macro_report_group45','After group 42','214.5');
INSERT INTO `status_tests` (`ident`, `description`, `display_order`) VALUES('macro_report_group48','After group 45','214.6');
INSERT INTO `status_tests` (`ident`, `description`, `display_order`) VALUES('macro_report_group49','After group 48','214.7');
/*Barath Nov-22-2017 END*/ 


users_12_09_2018
drop table users_12_09_2018;

geozones_02Nov2018
drop table geozones_02Nov2018;

vehicle_ids_12Dec2018
vehicle_ids_20Dec2018
vehicle_ids_o8092018
vehicle_ids_27Dec2018
vehicle_ids_29Oct2018
vehicle_ids_12Nov2018
vehicle_ids_27Sep2018
vehicle_ids_04Oct2018
vehicle_ids_18Oct2018
drop table vehicle_ids_12Dec2018, vehicle_ids_20Dec2018, vehicle_ids_o8092018, vehicle_ids_27Dec2018, vehicle_ids_29Oct2018, vehicle_ids_12Nov2018, 
vehicle_ids_27Sep2018, vehicle_ids_04Oct2018, vehicle_ids_18Oct2018;

zonar_vehicle_mapping_18Oct2018
zonar_vehicle_mapping_20Dec2018
zonar_vehicle_mapping_27Dec2018
zonar_vehicle_mapping_29Oct2018
zonar_vehicle_mapping_12Dec2018
drop table zonar_vehicle_mapping_18Oct2018, zonar_vehicle_mapping_20Dec2018, zonar_vehicle_mapping_27Dec2018, zonar_vehicle_mapping_29Oct2018, zonar_vehicle_mapping_12Dec2018;

current_positions_04Oct2018
current_positions_12Dec2018
current_positions_27Sep2018
current_positions_29Oct2018
current_positions_08092018
current_positions_20Dec2018
current_positions_18Oct2018
current_positions_27Dec2018
drop table current_positions_04Oct2018, current_positions_12Dec2018, current_positions_27Sep2018, current_positions_29Oct2018, current_positions_08092018,
current_positions_20Dec2018, current_positions_18Oct2018, current_positions_27Dec2018;

tracked_vehicle_status_16Oct2018
drop table tracked_vehicle_status_16Oct2018

synovia_vehicle_mapping_08092018
synovia_vehicle_mapping_04Oct2018
synovia_vehicle_mapping_27Sep2018
drop table synovia_vehicle_mapping_08092018, synovia_vehicle_mapping_04Oct2018, synovia_vehicle_mapping_27Sep2018;

driver_details_21Dec2018
driver_details_11Oct2018
driver_details_10Oct2018
drop table driver_details_21Dec2018, driver_details_11Oct2018, driver_details_10Oct2018;

admin_bus_units_08092018
admin_bus_units_12Dec2018
admin_bus_units_18Oct2018
admin_bus_units_20Dec2018
admin_bus_units_27Dec2018
admin_bus_units_27Sep2018
admin_bus_units_04Oct2018
admin_bus_units_29Oct2018
drop table -----

driver_rfid_21Dec2018
drop table driver_rfid_21Dec2018;

Additional tables:
driver_details_05Oct2018_2
driver_details_31Oct18
driver_details_31Oct18_1
driver_details_3Dec18
driver_rfid_31Oct18
driver_rfid_31Oct18_1
driver_rfid_3Dec18
subbus_assignment_7Dec18
vehicle_ids_1
vehicle_ids_7Dec18
drop table driver_details_05Oct2018_2, driver_details_31Oct18, driver_details_31Oct18_1, driver_details_3Dec18, driver_rfid_31Oct18, driver_rfid_31Oct18_1
driver_rfid_3Dec18, subbus_assignment_7Dec18, vehicle_ids_1, vehicle_ids_7Dec18;

Staging DB:
admin_bus_units_03Dec2018
admin_bus_units_03Nov2018
admin_bus_units_05Oct2018
admin_bus_units_10Dec2018
admin_bus_units_12Nov2018
admin_bus_units_19Dec2018
admin_bus_units_20Dec2018
admin_bus_units_25Sep2018
admin_bus_units_27Oct2018
current_positions_03Dec2018
current_positions_03Nov2018
current_positions_05Oct2018
current_positions_10Dec2018
current_positions_12Nov2018
current_positions_19Dec2018
current_positions_20Dec2018
current_positions_27Oct2018
driver_details_31Oct18
driver_rfid_31Oct18
synovia_vehicle_mapping_12Nov2018
synovia_vehicle_mapping_25Sep2018
synovia_vehicle_mapping_temp_12Nov2018
vehicle_ids_03Dec2018
vehicle_ids_03Nov2018
vehicle_ids_05Oct2018
vehicle_ids_10Dec2018
vehicle_ids_12Nov2018
vehicle_ids_19Dec2018
vehicle_ids_20Dec2018
vehicle_ids_25Sep2018
vehicle_ids_27Oct2018
zonar_vehicle_mapping_03Dec2018
zonar_vehicle_mapping_03Nov2018
zonar_vehicle_mapping_05Oct2018
zonar_vehicle_mapping_10Dec2018
zonar_vehicle_mapping_19Dec2018
zonar_vehicle_mapping_20Dec2018
zonar_vehicle_mapping_27Oct2018
zonar_vehicle_mapping_First_Student___William_Penn_05Oct2018
user_child_buses_13102017
user_permissions_Aug19_2017

drop table admin_bus_units_03Dec2018, admin_bus_units_03Nov2018, admin_bus_units_05Oct2018, admin_bus_units_10Dec2018, admin_bus_units_12Nov2018,
admin_bus_units_19Dec2018, admin_bus_units_20Dec2018, admin_bus_units_25Sep2018, admin_bus_units_27Oct2018, current_positions_03Dec2018,
current_positions_03Nov2018, current_positions_05Oct2018, current_positions_10Dec2018, current_positions_12Nov2018, current_positions_19Dec2018,
current_positions_20Dec2018, current_positions_27Oct2018, driver_details_31Oct18, driver_rfid_31Oct18, synovia_vehicle_mapping_12Nov2018,
synovia_vehicle_mapping_25Sep2018, synovia_vehicle_mapping_temp_12Nov2018, vehicle_ids_03Dec2018, vehicle_ids_03Nov2018, vehicle_ids_05Oct2018,
vehicle_ids_10Dec2018, vehicle_ids_12Nov2018, vehicle_ids_19Dec2018, vehicle_ids_20Dec2018, vehicle_ids_25Sep2018, vehicle_ids_27Oct2018,
zonar_vehicle_mapping_03Dec2018, zonar_vehicle_mapping_03Nov2018, zonar_vehicle_mapping_05Oct2018, zonar_vehicle_mapping_10Dec2018,
zonar_vehicle_mapping_19Dec2018, zonar_vehicle_mapping_20Dec2018, zonar_vehicle_mapping_27Oct2018, 
zonar_vehicle_mapping_First_Student___William_Penn_05Oct2018;





Check CURLOPT_TIMEOUT option
Check any other curl timeout option can help here
Check the issue in google.

Check log of normal operations
	-- start & end time can be same or 1/2 sec less during nornal opearations -- from /tmp/zonar_incident_27Dec2018/zonarlog_15_Durham.log
Check 3 secs in CURLOPT_CONNECTTIMEOUT affects regular operation. -- Justify if not with valid reference urls





Zonar API call for district 26.
Realtime data when buses drive.

'code/scripts/zonarProcess.php' 'code/includes/classes/ZonarAssetMapper.php' 'code/includes/classes/ZonarDownloadDataNew.php' 'code/includes/classes/ZonarWriteDataToDBNew.php' 'code/includes/classes/ZonarSynoviaDataCheck.php'


sh /var/www/staging.wheresthebus.com/code/scripts/startMacroZonarWorkers.sh
nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php  2>&1 >> /var/www/staging.wheresthebus.com/logs/zonarproces.log &
ps -elf | grep start_zonar
pkill -f start_zonar
cat /dev/null | tee macroWorker8*

18_08_27_06_06_31_dist_id:24:_FirstStudent.txt
18_08_27_06_10_09_dist_id:37:_FirstStudent.txt

No db entry in zonar data import table for district 37 untill 24

Outstanding
> Take backup of db tables -- 
> Change Admin unit name and handle in asset mapping code 
> Handle in data feed cron 
> Test once
> Update the ticket

>Current position gets unwanted buses for district 55

Production Release :
> Config file change -- 
> Admin unit creation -- 
> Run asset mapping cron run --
> Restart GPS process --
> Check for Zonar/Synovia data feed email notification --
> Enable zonar asset cron in crontab --
/usr/bin/php /var/www/wheresthebus.com/code/scripts/run.php zonar_asset_mapping >> /tmp/zonar_assetmapping.log
> Enable zonar notification email cron in crontab --
> Check icon creation -- 


WEDNESDAY:
Promote and test district 55 zonar GPS data feed in staging.

Staging setup - Zonar GPS:
> Pretha created macroWorker2.php and macroWorker7.php
> Run the command to find gearman running ports. 
	ps -elf | grep gearman 
> We may have to use macroWorker8.php / macroWroker.php for zonar
> Run startWorker.sh / startMacroZonarworkers.sh





- Currently, we have only Dattco contractor & its crendentials for district 26 & 55
- Got 47 buses - both 26 and 55
http://staging.wheresthebus.com/admin/__db_admin.php?server=172.31.2.224&username=wtbuser&db=wtb_app_staging&select=zonar_vehicle_mapping&columns%5B0%5D%5Bfun%5D=&columns%5B0%5D%5Bcol%5D=&where%5B0%5D%5Bcol%5D=district_id&where%5B0%5D%5Bop%5D=%3D&where%5B0%5D%5Bval%5D=26&where%5B1%5D%5Bcol%5D=gps_id&where%5B1%5D%5Bop%5D=%21%3D&where%5B1%5D%5Bval%5D=&where%5B2%5D%5Bcol%5D=location&where%5B2%5D%5Bop%5D=%3D&where%5B2%5D%5Bval%5D=New+Canaan&where%5B4%5D%5Bcol%5D=contractor_name&where%5B4%5D%5Bop%5D=%3D&where%5B4%5D%5Bval%5D=Dattco&where%5B41%5D%5Bcol%5D=&where%5B41%5D%5Bop%5D=%3D&where%5B41%5D%5Bval%5D=&order%5B0%5D=contractor_name&desc%5B0%5D=1&order%5B1%5D=&limit=500&text_length=100


Updates:
config file
Admin Unit db table
Zonar asset mapping file

TOMORROW WORK
>> setup zonar GPS in staging
>> Code change for district 55  - ref - 24 & 37



"weburl"=>"https://dat1154.zonarsystems.net/",
"username"=>"datt0583",
"password"=>"welcome1"

https://dat1154.zonarsystems.net/interface.php?username=datt0583&password=welcome1&action=showopen&operation=showassets&format=xml

leading 0

district 26 disabled from zonar



'0952','1901','1061','1111','1853','0565','1958','0955','1907','1802','1467','1412','0800','0814','1962','1703','1101','1659','0767','1520','1250','1965','1409','1651','1154','1704','1423','0958','1905','1045','0966','1860','1863','0816','1464','0956','1862','0755','0684','1042','0923','1909','0853','1754','0953','1526','1552','1857','1955','1255','1254','1956','1855','1113','1026','0761','0982','1807','0907','1708','0864','1966','1660','0954','1405','1515','0969','1468','0950','1851','0901'

Truncate table.
More buses to tracker 5 not just 100 buses.
-- Need to confirm this is causing issue before implementing
-- For one day, will make district 16 like other district trackers

Individual school report - plan time - STABLE in production - otherwise need to fix issue in individual report as well.

Next, task??


INSERT INTO `tracker_run_details` (`trackerId`, `district_id`, `TrackerNumer`, `bus_list`, `status_reading`, `status_processing`) VALUES
(1,	16,	1,	'1,2',	NULL,	NULL),
(2,	16,	2,	'3,4',	NULL,	NULL),
(3,	18,	2,	'6,7',	NULL,	NULL);

//$clearTrackerLog = "truncate table tracker_run_details ";
$clearTrackerLog = "delete from tracker_run_details where district_id = '{$this->district}'";

code/public/admin/status_test_config.php
code/scripts/check_tracker_status.sh
code/scripts/run.php
code/includes/classes/SynoviaAssetMapper.php

'code/public/admin/status_test_config.php' 'code/scripts/check_tracker_status.sh' 'code/scripts/run.php' 'code/includes/classes/SynoviaAssetMapper.php'




Question
Remove 5 trackers concepts for Austin and run like other districts?
Revert immediatly if we face any issues with that?


Observation :
12-Dec-2018 - 0616 ran only for PM trip and NO log entries and NO bus number in tracking bus list & non-tracking bus list as well.
tracker_run_details - that is, multiple trackers within a district - application only to District 16.

Clarifications:
How - Bus Number list array works for a tracker?
How - Bus Numbers are framed - on what basis?
When - Bus Numbers are cleared? **
When - emptying the tracker_run_details happens? **
Check - 0616 in logs & bus number list during its PM trip
Check - reason behind multiple trackers for district 16 (mail & jira)
After AM trip - trackers are paused or killed - before PM trip


Observation :
13-Dec-2018 - 0616 ran both AM and PM and tracked - 0610 is available in tracable list.

Suspect :
Clear bus array after AM trip
Clear tracker_run_details only when district 16 ends
Handle all the remaining buses in tracker number 5

'0955

clearQueue-0955
No entry for PM trip - 06 & 07

clearQueue-0616
entry for AM & PM trip - 06

0616 - gets into a new tracker log when there is pulled out.

clearQueue-0955
vehicle_id="0764"


clearQueue-0616
process-0616
vehicle_id="0616"
'0616
0616'





13-Dec-2018 09:01:21: We are getting new Events at 18-12-13 09:01:21<br/>



mysql -u wtbuser -p wtb_vehicle < /tmp/12.sql
77486474

WP-980
 




dist_id:31:_First Student - William Penn
dist_id:31:_First Student - Plymouth Meeting.txt
dist_id:31:_First Student - Lower Moreland.txt




District : 22
Year : 2017
Month : December
Buses : All the buses

File name : 12.sql.gz 
File size : 66.4MB











------------------
WORK FROM HERE::::
------------------
IMPORTANT
Take separate count of FW and F5 buses in all the important tables like mapping, vehicle, current position, admin units.
And, test in staging.



Merging F5 to FW
> Clear district 15's F5 buses current position table.
> 

















Handling location
Considering specific bus number
Bus number formating
Admin unit




cat /dev/null | tee tracker*.*


Clarification :
0764 did not run on 12/03. 
https://wheresthebus.com/admin/data_viewer.php?bus=0764&date=12/03/2018&district=16

0955 ran on its own route 0955 and not on 0764.  
https://wheresthebus.com/admin/data_viewer.php?bus=0955&date=12/03/2018&district=16

0616:


I checked 12/03 PM trip logs for above two buses. There is no entry. 

vehicle_id="0955"


vehicle_id="0764" 
	- is found only for AM trip and no pm trip
	- Last tracker update at 11:04am 0n 03Dec
	
vehicle_id="0616"
	- is not found at all in the log(no am & no pm)
	- Last tracker update 11-Nov
	- No last event time

postgis2_94-client

Case-1
No loadBusData
12 seconds
<screen shot>
Note : with master file icon, no 15 secs refresh
No prob bus, idle, late start, unassigned buses count, latest server time.

Case-2
With loadBusData()
No showBuses()
No prob bus, idle, late start, unassigned buses count, latest server time.
12 seconds
<screen shot>
Note : with master file icon, no 15 secs refresh
No prob bus, idle, late start, unassigned buses count, latest server time.

Case-3
With loadBusData()
With showBuses()
No prob bus, idle, late start, unassigned buses count, latest server time.
128 seconds
showBuses() run time - 21 secs
<screen shot>
Note : with master file icon, no 15 secs refresh
No prob bus, idle, late start, unassigned buses count, latest server time.

Case-4
With loadBusData()
With showBuses()
With Only Map update
No bus table updates
10 seconds - sometimes 120 secs
showBuses() run time - 1 sec
<screen shot>
Note : with master file icon, no 15 secs refresh
No prob bus, idle, late start, unassigned buses count, latest server time.

Case-5
With loadBusData()
With showBuses()
With Only Bus table update
No map updates
9 seconds - sometimes 120 secs
showBuses() run time - 2 secs
<screen shot>
Note : with master file icon, no 15 secs refresh
No prob bus, idle, late start, unassigned buses count, latest server time.

http://prepro.wheresthebus.com/district/BusFilter.php?district=31&busno=null&init=1&sortby=bus&isTabletDistrict=1&isMilwaukeeLayoutDistrict=0&IsMDTChcked=0&isBannerDisplay=0&_=1543313149944
http://prepro.wheresthebus.com/district/BusFilter.php?district=31&busno=null&init=0&sortby=bus&isTabletDistrict=1&isMilwaukeeLayoutDistrict=0&IsMDTChcked=0&isBannerDisplay=0&_=1543313164949
http://prepro.wheresthebus.com/district/BusFilter.php?district=31&busno=null&init=0&sortby=bus&isTabletDistrict=1&isMilwaukeeLayoutDistrict=0&IsMDTChcked=0&isBannerDisplay=0&_=1543313224950

https://wheresthebus.com/rider.php?bid=0807&child_id=688915&uid=d57f339b-6865-11e6-838f-f23c9173ec9c&debug=1&admin=1&t=1541567294&sub=0501
http://app.wheresthebus.com/admin/trans_admin_new.php?district=16
http://app.wheresthebus.com/district/BusRealtime.php?district=16

empty tracker table
truncate table tracker_run_details
kill district 16 trackers
restart trakcers
sh /var/www/wheresthebus.com/code/scripts/check_tracker_status.sh

DROP TABLE IF EXISTS tiger_data.MT_place;
\copy (select loader_generate_script(ARRAY['MT'], 'wtbuser')) to '/home/wtbuser/tiger/tiger_states_mt.sh' with binary;

DROP INDEX tiger_data.idx_mt_place_soundex_name;
DROP INDEX tiger_data.tiger_data_MT_place_the_geom_gist;

Process ID : 16448

sh tiger_states_mt.sh &> /tmp/tiger_import_mt_02Nov2018.txt &


/usr/bin/psql -c "CREATE SCHEMA tiger_staging;"
psql: FATAL:  database "wtbuser" does not exist

/usr/bin/shp2pgsql -D -c -s 4269 -g the_geom   -W "latin1" tl_2015_30_place.dbf tiger_staging.mt_place
bash: /usr/bin/shp2pgsql: No such file or directory

ps -elf | grep check_tracker
kill -9 11264
pkill -f check_tracker
sh /var/www/wheresthebus.com/code/scripts/check_tracker_status.sh

https://wheresthebus.com/rider.php?uid=a17cdcdb-196c-11e8-8ad7-f23c9173ec9c&admin=1&debug=1
https://wheresthebus.com/rider.php?uid=1772079f-cff3-11e8-9ca4-0a58b35fe338&admin=1&debug=1
https://wheresthebus.com/rider.php?uid=8a9cddd1-d068-11e8-9ca4-0a58b35fe338&admin=1&debug=1


App server - 18.209.85.129 - login works - Sudo does not work
PHP server - 34.238.91.1 - login works - Sudo works
Produciton MySQL server - 18.204.144.65 - login works - Sudo does not work
Tiger1 server - 34.199.108.27 - login works - Sudo does not work
Tiger2 server - 34.230.181.32 - login works - Sudo does not work
Staging Server - 35.168.241.142 - login works - Sudo does not work
Staging MySQL - 52.71.151.215 - login works - Sudo does not work

* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker1_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker4_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker5_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker6_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker7_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker9_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker10_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker11_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker12_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker13_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker14_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker15_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker17_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker18_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker19_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker20_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker22_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker23_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker24_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker25_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker26_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker27_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker28_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker29_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker30_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker31_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker32_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker33_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker34_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker35_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker36_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker37_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker38_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker39_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker47_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker48_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker49_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker50_log.txt
* * * * * cat /dev/null > /var/www/wheresthebus.com/logs/tracker52_log.txt

wtb_app_live::
admin_bus_units_01Feb2019
admin_bus_units_02Feb2019
admin_bus_units_04Feb2019
admin_bus_units_08Feb2019
admin_bus_units_11Feb2019
admin_bus_units_19Feb2019
admin_bus_units_25Jan2019
bus_companies_19Feb2019
current_positions_01Feb2019
current_positions_02Feb2019
current_positions_04Feb2019
current_positions_08Feb2019
driver_details_16Jan2019
driver_details_16Jan2019_updated
driver_details_17Jan2019
driver_details_20Feb2019
driver_details_25Jan2019
driver_details_upload_16Jan2019
driver_details_upload_16Jan2019_updated
driver_details_upload_25Jan2019
driver_rfid_20Feb2019
tablet_info_19Feb2019
vehicle_ids_01Feb2019
vehicle_ids_02Feb2019
vehicle_ids_02Jan2019
vehicle_ids_04Feb2019
vehicle_ids_08Feb2019
vehicle_ids_11Feb2019
vehicle_ids_22Jan2019
vehicle_ids_25Jan2019
zonar_vehicle_mapping_01Feb2019
zonar_vehicle_mapping_02Feb2019
zonar_vehicle_mapping_04Feb2019
zonar_vehicle_mapping_08Feb2019
zonar_vehicle_mapping_25Jan2019
---------------------------------
wtb_vehicle::
daily_events_12_Fort_Mill_Jun29_2016
daily_events_16_debug
---------------------------------
wtb_staging::
admin_bus_units_02Feb2019
admin_bus_units_11Feb2019
admin_bus_units_04Dec2018
bus_companies_11Feb2019
bus_companies_12Feb2019
current_positions_04Dec2018
current_positions_02Feb2019
current_positions_11Feb2019
districts_09Jan2019
driver_login_12Feb2019
tablet_info_12Feb2019
tablet_session_12Feb2019
vehicle_ids_02Feb2019
vehicle_ids_04Dec2018
vehicle_ids_11Feb2019
zonar_vehicle_mapping_02Feb2019
synovia_vehicle_mapping_04Dec2018

/usr/bin/php /var/www/staging.wheresthebus.com/code/scripts/run.php zonar_asset_mapping &> /tmp/zonar_assetmapping_11Apr2019.log &
nohup php /var/www/staging.wheresthebus.com/code/scripts/zonarProcess.php 2>&1 &>> /var/www/staging.wheresthebus.com/logs/zonarproces.log &


http://ecapp0155.southindia.cloudapp.azure.com/pcwithcandidate/



Suresh :
Party
Age
Education
Occupation
Achievements
https://suvidha.eci.gov.in/uploads/affidavit/2019/PC/S22/8/S2220190326105129.pdf

47,520 + 19,040 = 66560

11,30,000 - 10,17,143 = 1,12,857

10,17,143 ??

10,92,443 ??


























